<!DOCTYPE html> <html> <head> <meta charset=utf-8> <meta name=viewport content="maximum-scale=1,minimum-scale=1,user-scalable=0,width=device-width,initial-scale=1"/> <meta name=format-detection content="telephone=no,email=no,date=no,aItemress=no"> <title>title</title> <link rel=stylesheet type=text/css href=../../css/aui20/aui.2.0.css /> <style type=text/css>body{background-color:#fff}.chbox{position:absolute;top:5px;right:5px;z-index:99}</style> </head> <body> <div class="aui-content aui-margin-b-15"> <ul class="aui-list aui-media-list"> <li class=aui-list-item> <div class=aui-list-item-inner> <div class="aui-row aui-row-padded" id=list> <div class="aui-col-xs-3 aui-text-center" tapmode onclick=usercamera()> <i class="aui-iconfont aui-icon-camera" style=font-size:35px></i> <p>使用相机</p> </div> </div> </div> </li> </ul> </div> </body> <script src=../../script/api.js></script> <script src=../../script/conn.js></script> <script>function loaddate(){showp("相册准备中",""),UIMediaScanner.scan({type:"all",count:30,sort:{key:"time",order:"desc"},thumbnail:{w:100,h:100}},function(i){if(i){for(var e=$api.byId("list"),a="",t=0,n=i.list.length;t<n;t++){var s=i.list[t];a+='<div class="aui-col-xs-3">',a+=1==limit?'<img src="'+s.thumbPath+'" tapmode onclick="openbigimg(\''+s.path+"')\">":'<img src="'+s.thumbPath+'" tapmode onclick="openbigimg(\''+s.path+'\')"><input type="checkbox" date-img="'+s.path+'" class="aui-checkbox chbox" tapmode="" name="checkbox" onclick="checksel()">',a+="</div>"}$api.append(e,a),api.hideProgress()}})}function loadmorepic(){showp("图片加载中",""),UIMediaScanner.fetch(function(i,e){if(i){for(var a=$api.byId("list"),t="",n=0,s=i.list.length;n<s;n++){var r=i.list[n];t+='<div class="aui-col-xs-3">',t+=1==limit?'<img src="'+r.thumbPath+'" tapmode onclick="openbigimg(\''+r.path+"')\">":'<img src="'+r.thumbPath+'" tapmode onclick="openbigimg(\''+r.path+'\')"><input type="checkbox" date-img="'+r.path+'" class="aui-checkbox chbox" tapmode="" name="checkbox" onclick="checksel()">',t+="</div>"}$api.append(a,t)}else api.toast({msg:"没有更多图片了"});api.hideProgress()})}function openbigimg(i,e){if(1==limit&&!e)return sendimg(i,0),!1;isIOS?(showp("图片处理中...",""),UIMediaScanner.transPath({path:i[0]},function(i,e){i&&(imageBrowser.openImages({showList:!1,imageUrls:[i.path]}),api.hideProgress())})):imageBrowser.openImages({showList:!1,imageUrls:i})}function usercamera(){api.getPicture({sourceType:"camera",encodingType:"jpg",destinationType:"url",mediaValue:"pic",quality:100,saveToPhotoAlbum:!0},function(i,e){i&&i.data?sendimg(i.data,1):api.toast({msg:"没有选择，或者选择出错"})})}function checksel(){showp("图像处理中...","请稍候");var i=$api.domAll("input[type=checkbox]"),e=0;imgarr=[];for(var a=0,t=i.length;a<t;a++){if(i[a].checked){if(e++,1==limit&&e>1)return api.alert({msg:"只能选择一张图片"}),i[a].checked=!1,api.hideProgress(),!1;var n=$api.attr(i[a],"date-img");imgarr.push(n),api.sendEvent({name:"dis"})}api.sendEvent({name:"alcheck",extra:{num:e}})}api.hideProgress()}function sendimg(i,e){showp("图像处理中...","请稍候"),isIOS&&0==e?UIMediaScanner.transPath({path:i},function(i,e){if(i){var a=i.path;api.sendEvent({name:"getimgarr",extra:{img:a,sid:sid}}),api.closeWin(),api.hideProgress()}}):(api.sendEvent({name:"getimgarr",extra:{img:i,sid:sid}}),api.closeWin(),api.hideProgress())}var UIMediaScanner=null,imageBrowser=null,isIOS=!1,limit=null,sid=null,imgarr=new Array;apiready=function(){limit=api.pageParam.limit,sid=api.pageParam.sid,isIOS="ios"==api.systemType,UIMediaScanner=api.require("UIMediaScanner"),imageBrowser=api.require("imageBrowser"),api.parseTapmode(),loaddate(),api.addEventListener({name:"scrolltobottom",extra:{threshold:0}},function(i,e){loadmorepic()}),api.addEventListener({name:"openview"},function(i,e){imgarr.length>0&&openbigimg(imgarr,1)}),api.addEventListener({name:"postok"},function(i,e){})}</script> </html>