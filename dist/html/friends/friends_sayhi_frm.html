<!DOCTYPE html> <html> <head> <meta charset=utf-8> <meta name=viewport content="maximum-scale=1,minimum-scale=1,user-scalable=0,width=device-width,initial-scale=1"/> <meta name=format-detection content="telephone=no,email=no,date=no,aItemress=no"> <title></title> <link rel=stylesheet type=text/css href=../../css/api.css /> <link rel=stylesheet type=text/css href=../../css/aui.css /> <link rel=stylesheet type=text/css href=../../css/aui-skin.css /> <link rel=stylesheet type=text/css href=../../css/tea.css /> <style type=text/css></style> </head> <body> <section class=aui-content-padded id=app v-cloak> <div class=aui-card-list style="width:100%;height:7.5rem;box-shadow:#d6e0ea 0 0 10px"> <textarea class=aui-padded-15 style=width:100%;height:80% maxlength=15 placeholder=请输入您要说的话 v-model=desc @input=descInput @keyup.enter=postSayhi></textarea> <span class="aui-font-size-14 aui-pull-right aui-margin-r-15">{{desc.length}}/15</span> </div> </section> </body> <script src=../../script/api.js></script> <script src=../../script/aui-toast.js></script> <script src=../../script/tea.js></script> <script src=../../script/conn.js></script> <script src=../../script/vue.min.js></script> <script type=text/template id=template> </script> <script>function init(){dom={},vm=new Vue({el:"#app",data:{desc:"",friendInfo:{}},methods:{descInput:function(){console.log(this.desc)},postSayhi:function(){""!=this.desc?sendRequest():alert("请输入内容")}}}),getFriendInfo(),initModule(),initEventListener()}function initModule(){}function initEventListener(){}function getData(){}function getFriendInfo(){api.ajax({url:website+"friendship.php?action=infobyid",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{friid:api.pageParam.friendID}}},function(e,n){vm.friendInfo=e})}function sendMsg(){var e={username:$api.getStorage("nickname"),userphoto:$api.getStorage("img")};api.sendEvent({name:"sendMsgStart",extra:{msgType:"text",chatType:"PRIVATE",chatId:vm.friendInfo.ID,content:vm.desc,extra:JSON.stringify(e)}})}function sendRequest(){tea.showp("好友请求","发送中"),api.ajax({url:website+"friendship.php?action=sendfrimsg",method:"post",timeout:30,data:{values:{token:$api.getStorage("token"),fritoken:vm.friendInfo.token,msg:vm.desc}}},function(e,n){return api.hideProgress(),e?"ok"==e.succ?(api.sendEvent({name:"msgOK"}),api.closeToWin({name:"friends_local_win"}),!0):void api.toast({msg:e.msg,duration:2e3,location:"middle"}):(tea.toast("ajax"),!1)})}var dom={},vm=null;apiready=function(){init()}</script> </html>