<!DOCTYPE html> <html> <head> <meta charset=utf-8> <meta name=viewport content="maximum-scale=1,minimum-scale=1,user-scalable=0,width=device-width,initial-scale=1"/> <meta name=format-detection content="telephone=no,email=no,date=no,aItemress=no"> <title></title> <link rel=stylesheet type=text/css href=../../css/api.css /> <link rel=stylesheet type=text/css href=../../css/aui.css /> <link rel=stylesheet type=text/css href=../../css/aui-skin.css /> <link rel=stylesheet type=text/css href=../../css/tea.css /> <style type=text/css>body,html{width:100%;height:100%;overflow:auto}</style> </head> <body> <header id=header class="aui-bar aui-bar-nav aui-bar-light"> <a class="aui-btn aui-pull-left" tapmode onclick=closeWin()> <span class="aui-iconfont aui-icon-left tea-text-title"></span> </a> <div class="aui-title tea-text-title">标题</div> </header> <section id=main></section> <footer id=footer></footer> </body> <script src=../../script/api.js></script> <script src=../../script/tea.js></script> <script src=../../script/conn.js></script> <script src=../../script/doT.min.js></script> <script type=text/template id=template></script> <script>function initDOM(){}function initVar(){userJson.username=$api.getStorage("nickname"),userJson.userphoto=$api.getStorage("img")}function initHTML(){var e=$api.dom(".aui-title");$api.text(e,api.pageParam.chatName)}function initEventListener(){uiChatBox.addEventListener({target:"inputBar",name:"move"},function(e,t){setChatInit("chat_frm",e.panelHeight+e.inputBarHeight+(_isIOS()?0:10))}),uiChatBox.addEventListener({target:"inputBar",name:"change"},function(e,t){setChatInit("chat_frm",e.panelHeight+e.inputBarHeight+(_isIOS()?0:10))}),uiChatBox.addEventListener({target:"recordBtn",name:"press"},function(e,t){var a=api.cacheDir+"/"+_getNowFormatDate()+"/",i=_newGuid()+".amr";api.startRecord({path:a+i}),api.showProgress({title:"语音录制中...",text:"松开发送",modal:!1})}),uiChatBox.addEventListener({target:"recordBtn",name:"press_cancel"},function(e,t){api.hideProgress(),api.stopRecord(function(e,t){if(e){if(e.duration<1)return void api.toast({msg:"录音时间过短"});userJson.duration=e.duration,_sendEvent("sendMsgStart",{msgType:"voice",chatType:api.pageParam.chatType,chatId:api.pageParam.chatId,content:e.path,extra:JSON.stringify(userJson)})}})}),_addEventListener("closeKeyboard",function(){uiChatBox.closeKeyboard()})}function initModule(){uiMediaScanner=api.require("UIMediaScanner"),imageFilter=api.require("imageFilter"),initUIChatBox()}function getData(){}function updateHTML(){}function sendEvent(){}function closeWin(){api.sendEvent({name:"clearUnread",extra:{chatId:api.pageParam.chatId,chatType:api.pageParam.chatType}}),api.closeWin()}function openFrame(){api.openFrame({name:"chat_frm",url:"./chat_frm.html",rect:{x:0,y:headerH,w:"auto",h:api.winHeight-headerH-footerH-(_isIOS()?50:44)},pageParam:{chatType:api.pageParam.chatType,chatId:api.pageParam.chatId,chatName:api.pageParam.chatName},bgColor:"#f2f5f8",bounces:!1,allowEdit:!0})}function setChatInit(e,t){api.setFrameAttr({name:e,rect:{x:0,y:headerH,w:api.winWidth,h:api.winHeight-headerH-t}}),setTimeout(function(){api.sendEvent({name:"scrollButton",extra:{}})},300)}function initUIChatBox(){(uiChatBox=api.require("UIChatBox")).open({placeholder:"",maxRows:4,emotionPath:"widget://image/chatBox/emotion",texts:{recordBtn:{normalTitle:"按住说话",activeTitle:"松开结束"},sendBtn:{title:"发送"}},styles:{inputBar:{borderColor:"#ededed",bgColor:"#ffffff"},inputBox:{borderColor:"#B3B3B3",bgColor:"#FFFFFF"},emotionBtn:{normalImg:"widget://image/chatBox/chatBox_face1.png"},extrasBtn:{normalImg:"widget://image/chatBox/chatBox_add1.png"},keyboardBtn:{normalImg:"widget://image/chatBox/chatBox_key1.png"},speechBtn:{normalImg:"widget://image/chatBox/voice.png"},recordBtn:{normalBg:"#fff",activeBg:"#ededed",color:"#666",size:14},indicator:{target:"both",color:"#c4c4c4",activeColor:"#9e9e9e"},sendBtn:{titleColor:"#fff",bg:"#3399ff",activeBg:"#46a91e",titleSize:14}},extras:{titleSize:10,titleColor:"#a3a3a3",btns:[{title:"图片",normalImg:"widget://image/chatBox/chatBox_album1.png",activeImg:"widget://image/chatBox/chatBox_album2.png"},{title:"拍照",normalImg:"widget://image/chatBox/chatBox_cam1.png",activeImg:"widget://image/chatBox/chatBox_cam2.png"}]}},function(e,t){if(e){if("clickExtras"==e.eventType)switch(e.index){case 0:uiMediaScanner.open({type:"picture",column:4,classify:!0,max:9,sort:{key:"time",order:"desc"},texts:{stateText:"已选*项",cancelText:"取消",finishText:"完成"},styles:{bg:"#fff",mark:{icon:"",position:"bottom_left",size:20},nav:{bg:"#b23e4b",stateColor:"#fff",stateSize:18,cancelBg:"rgba(0,0,0,0)",cancelColor:"#fff",cancelSize:18,finishBg:"rgba(0,0,0,0)",finishColor:"#fff",finishSize:18}}},function(e){if(e){if(!e.list)return;for(var t=0;t<e.list.length;t++){var a=e.list[t],i=a.path;a.thumbPath;_isIOS()?uiMediaScanner.transPath({path:i},function(e){_imgCompress(imageFilter,e.path,.5,.5,a.suffix,function(e){_sendEvent("sendMsgStart",{msgType:"image",chatType:api.pageParam.chatType,chatId:api.pageParam.chatId,content:e,extra:JSON.stringify(userJson)})})}):_imgCompress(imageFilter,i,.5,.5,a.suffix,function(e){_sendEvent("sendMsgStart",{msgType:"image",chatType:api.pageParam.chatType,chatId:api.pageParam.chatId,content:e,extra:JSON.stringify(userJson)})})}}});break;case 1:api.getPicture({sourceType:"camera",encodingType:"jpg",destinationType:"url",mediaValue:"pic",quality:50,saveToPhotoAlbum:!0},function(e,t){if(e&&e.data){var a=e.data;_imgCompress(imageFilter,a,.5,.5,_getExt(a),function(e){_sendEvent("sendMsgStart",{msgType:"image",chatType:api.pageParam.chatType,chatId:api.pageParam.chatId,content:e,extra:JSON.stringify(userJson)})})}else _toast("没有选择，或者选择出错")});break;case 2:api.toast({msg:"发红包功能暂时不可用"})}"send"==e.eventType&&""!=e.msg&&_sendEvent("sendMsgStart",{msgType:"text",chatType:"PRIVATE",chatId:api.pageParam.chatId,content:e.msg,extra:JSON.stringify(userJson)})}else tea.toast("ajax")})}apiready=function(){header=$api.byId("header"),$api.fixStatusBar(header),headerH=$api.offset(header).h,footer=$api.byId("footer"),footerH=$api.offset(footer).h,initModule(),initDOM(),initVar(),initHTML(),initEventListener(),openFrame(),getData()};var header,footer,headerH,footerH,uiChatBox=null,uiMediaScanner=null,imageFilter=null,bMap=null,userJson={}</script> </html>