<!DOCTYPE html> <html> <head> <meta charset=utf-8> <meta name=viewport content="maximum-scale=1,minimum-scale=1,user-scalable=0,width=device-width,initial-scale=1"/> <meta name=format-detection content="telephone=no,email=no,date=no,aItemress=no"> <title></title> <link rel=stylesheet type=text/css href=../../css/api.css /> <link rel=stylesheet type=text/css href=../../css/aui.css /> <link rel=stylesheet type=text/css href=../../css/aui-skin.css /> <link rel=stylesheet type=text/css href=../../css/tea.css /> <style type=text/css>body,html{height:100%}.flex-center{display:flex;display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;justify-content:center!important;align-items:center!important}.justify-content-star{justify-content:flex-start!important;-webkit-justify-content:flex-start!important}.accept-btn{width:2.5rem;height:1.55rem;border-radius:30px;text-align:center;line-height:1.55rem}.tea-text-light-red{color:#f66!important}.dele-btn{width:2.95rem;height:100%;position:absolute;top:0;right:-2.95rem;display:flex;align-items:center}.swipeleft{transform:translateX(-16%);-webkit-transform:translateX(-16%)}.level{width:1.5rem;height:.8rem;line-height:.8rem;margin-left:-1px;border-top-right-radius:30px;border-bottom-right-radius:30px;text-align:center;font-size:.5rem!important}.red{border:1px solid #f66;color:#f66}.blue{border:1px solid #5cadff;color:#5cadff}</style> </head> <body> <div id=app class="aui-content aui-margin-b-15" v-cloak> <ul v-show=list.length id=list class="aui-list aui-media-list"> <li v-for="(value,index) in list" tapmode @click=openInfo(value) class="aui-list-item swiper-container" style=padding:0> <div class=swiper-wrapper> <div class="aui-media-list-item-inner swiper-slide content"> <div class=aui-list-item-media style="padding:.75rem .5rem"> <img :src=" value.img ? website + value.img : '../../image/avatar.png' "> </div> <div class=aui-list-item-inner style="padding:.75rem 0"> <div class="aui-list-item-text justify-content-star"> <div class="aui-ellipsis aui-list-item-title aui-font-size-14" style=max-width:50%>{{ value.nickname }}</div> <i :class="value.sex == 'male' ? 'tea-icon-men tea-text-blue' : 'tea-icon-women tea-text-light-red' " class="aui-iconfont aui-margin-l-5 aui-font-size-16"></i> <span :class="value.sex == 'male' ? 'blue' : 'red' " class="tea-font-size-11 level">{{ value.tx }}</span> </div> <div v-show=value.profile class=aui-list-item-text style=margin-bottom:2px> <p class="aui-ellipsis aui-font-size-14">{{ value.profile }}</p> </div> <div v-if="value.status == 0 || value.status == 1" class="aui-list-item-text justify-content-star"> <i class="aui-iconfont aui-icon-location" style=font-size:.5rem></i> <p class="aui-ellipsis tea-font-size-11 aui-margin-l-5">{{ distanceBlur(value.distance,value.city) }}</p> </div> <div v-else class="aui-list-item-text justify-content-star"> <i class="aui-iconfont aui-icon-date" style=font-size:.5rem></i> <p class="aui-ellipsis tea-font-size-11 aui-margin-l-5">{{ intervalTime(value.lasttime) }}</p> </div> </div> <div class="aui-list-item-media aui-border-l flex-center" style="padding:0;margin:.75rem 0"> <div v-if="value.status == 1" class="tea-text-light-gray aui-font-size-14">等待加入</div> <div v-else-if="value.status == 2" class="aui-text-white tea-bg-blue accept-btn" tapmode @click.stop=acceptRequest(value,index)>接受</div> <div v-else-if="value.status == 3" class="tea-text-light-gray aui-font-size-14">已添加</div> <div v-else class="tea-text-blue aui-font-size-14" tapmode @click.stop=opneWinSayhi(value.ID)>打招呼</div> </div> </div> <div class="aui-bg-danger aui-text-white aui-text-center swiper-slide dele-btn aui-list-item-center">删除</div> </div> </li> </ul> <p v-show=!list.length class=aui-text-center>您附近暂无车友或检查是否开启定位功能</p> </div> </body> <script src=../../script/api.js></script> <script src=../../script/aui-toast.js></script> <script src=../../script/tea.js></script> <script src=../../script/conn.js></script> <script src=../../script/doT.min.js></script> <script src=../../script/vue.min.js></script> <script src=../../script/swiper-3.4.2.min.js></script> <script type=text/template id=template> </script> <script>function init(){dom={},data={},vm=new Vue({el:"#app",data:{website:website,location:[0,0],list:[]},methods:{openInfo:function(t){api.openWin({name:"user_info_win",url:"../location/user_info_win.html",pageParam:{friendID:t.ID,pageType:"location"},vScrollBarEnabled:!1})},opneWinSayhi:function(t){api.openWin({name:"friends_sayhi_win",url:"./friends_sayhi_win.html",bounces:!1,pageParam:{friendID:t}})},acceptRequest:function(t,e){adoptFriend(t.accept_id,e)},swiperDele:function(){this.list,this.$nextTick(function(){new Swiper(".swiper-container",{slidesPerView:"auto",initialSlide:0,resistanceRatio:.1,slideToClickedSlide:!0})})},intervalTime:function(t){return t>=86400?Math.floor(t/86400)+"天前":t>=3600&&t<86400?Math.floor(t/3600)+"小时前":t>=60&&t<3600?Math.floor(t/60)+"分钟前":"刚刚"},distanceBlur:function(t,e){return Number(t)<1e3?t.toString()+"m":Number(t)>5e4?t=e:(t=t.toString()).slice(0,-3)+"km"}},computed:{}}),getLocation(),updateHTML(),initModule(),initEventListener()}function initModule(){"0"==$api.getStorage("is_set_sex")&&api.confirm({title:"",msg:"请选择您的性别",buttons:["女","男"]},function(t,e){1==t.buttonIndex&&settingSex("female"),2==t.buttonIndex&&settingSex("male")})}function initEventListener(){api.addEventListener({name:"msgOK"},function(t,e){api.toast({msg:"发送成功",duration:3e3,location:"middle"}),getLocation()}),api.addEventListener({name:"updataList"},function(t,e){getLocation()})}function getData(){}function updateHTML(){}function getLocation(){tea.showp("定位中...","请稍候..."),api.require("bMap").getLocation({accuracy:"100m",autoStop:!0,filter:1},function(t,e){return t?t.status?(vm.location=[t.lon,t.lat],getFriends(),!0):t.status?void api.toast({msg:e.msg,duration:2e3,location:"middle"}):(api.hideProgress(),alert("定位失败，请检查设备是否打开定位功能"),!1):(api.hideProgress(),tea.toast("ajax"),!1)})}function getFriends(t){1==t&&(t="female"),2==t&&(t="male"),3==t&&(t=""),api.ajax({url:website+"nearby.php?action=near",method:"post",timeout:30,dataType:"json",data:{values:{ID:$api.getStorage("ID"),longitude:vm.location[0],latitude:vm.location[1],sex:t}}},function(t,e){return api.hideProgress(),t?1==t.succ?(vm.list=t.data,!0):(0==t.succ&&(vm.list=[]),void api.toast({msg:t.msg,duration:2e3,location:"middle"})):(tea.toast("ajax"),!1)})}function adoptFriend(t,e){tea.showp("数据加载中...","请稍候..."),api.ajax({url:website+"friendship.php?action=agrequest",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{ID:t}}},function(t,i){if(api.hideProgress(),!t)return tea.toast("ajax"),!1;"ok"==t.succ&&(vm.list[e].status=3)})}function settingSex(t){api.ajax({url:website+"user_api.php?action=edit",method:"post",timeout:30,data:{values:{ID:$api.getStorage("ID"),sex:t}}},function(e,i){return e?1==e.succ?($api.setStorage("sex",t),$api.setStorage("is_set_sex","1"),!0):void 0:(tea.toast("ajax"),!1)})}var dom={},data={},vm=null;apiready=function(){init()}</script> </html>