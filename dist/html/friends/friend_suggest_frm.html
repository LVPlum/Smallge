<!DOCTYPE html> <html> <head> <meta charset=utf-8> <meta name=viewport content="maximum-scale=1,minimum-scale=1,user-scalable=0,width=device-width,initial-scale=1"/> <meta name=format-detection content="telephone=no,email=no,date=no,aItemress=no"> <title></title> <link rel=stylesheet type=text/css href=../../css/api.css /> <link rel=stylesheet type=text/css href=../../css/aui.css /> <link rel=stylesheet type=text/css href=../../css/aui-skin.css /> <link rel=stylesheet type=text/css href=../../css/tea.css /> <style type=text/css></style> </head> <body> <div id=app v-cloak> <ul v-if=list.length class="aui-list aui-media-list"> <li v-for="(value,index) in list" class="aui-list-item aui-list-item-middle" @click=openWinFriendInfo(value)> <div class=aui-media-list-item-inner> <div class=aui-list-item-media style=width:3rem> <img :src=" value.img ? website+value.img : '../../image/nologo.png' " class=aui-img-round> </div> <div class=aui-list-item-inner> <div class=aui-list-item-text> <div class="aui-list-item-title aui-font-size-14">{{ value.conname }}</div> </div> <div class=aui-list-item-text>小马哥昵称: {{ value.nickname }}</div> </div> <div class=aui-list-item-media tapmode @click.stop=addFriend(value,index)> <div v-if="value.hadd == 0" class="aui-label aui-label-info tea-bg-blue aui-text-white">添加好友</div> <div v-else class=aui-list-item-text>等待通过</div> </div> </div> </li> </ul> <div v-else> <p class=aui-text-center>您的手机通讯录中没有任何人已经加入过小马哥</p> <p class=aui-text-center>点击右上角的"邀请"去邀请好友加入小马哥</p> </div> </div> </body> <script src=../../script/api.js></script> <script src=../../script/aui-toast.js></script> <script src=../../script/fastclick.min.js></script> <script src=../../script/tea.js></script> <script src=../../script/conn.js></script> <script src=../../script/vue.min.js></script> <script src=../../script/share.js></script> <script type=text/template id=template> </script> <script>function init(){dom={},vm=new Vue({el:"#app",data:{website:website,list:[]},methods:{addFriend:function(e,t){0==e.hadd?sendRequest(e.token,t):this.openWinFriendInfo(e)},openWinFriendInfo:function(e){api.openWin({name:"user_info_win",url:"../location/user_info_win.html",pageParam:{friendID:e.userid,pageType:"suggest"},vScrollBarEnabled:!1})}},computed:{}}),initModule(),initEventListener()}function initModule(){tea.showp("数据加载中","请稍候"),api.require("contacts").queryByPage({pageIndex:0},function(e,t){getData(e)})}function initEventListener(){api.addEventListener({name:"updataList"},function(e,t){initModule()})}function getData(e){api.ajax({url:website+"friendship.php?action=fricommlist",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{content:e,dm:api.deviceModel,ID:$api.getStorage("ID"),token:$api.getStorage("token")}}},function(e,t){return api.hideProgress(),e?e?(vm.list=e,!0):void 0:(tea.toast("ajax"),!1)})}function sendRequest(e,t){tea.showp("请求发送中","请稍候"),api.ajax({url:website+"friendship.php?action=sendfrimsg",method:"post",timeout:30,data:{values:{token:gettoken($api.getStorage("telphone")),fritoken:e}}},function(e,i){return api.hideProgress(),e?"ok"==e.succ?(vm.list[t].hadd=1,api.sendEvent({name:"updataDot",extra:{key1:"value",key2:"value"}}),!0):void api.toast({msg:e.msg,duration:2e3,location:"middle"}):(tea.toast("ajax"),!1)})}var dom={},vm=null;apiready=function(){init()}</script> </html>