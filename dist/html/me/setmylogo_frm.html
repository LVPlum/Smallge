<!DOCTYPE html> <html> <head> <meta charset=utf-8> <meta name=viewport content="maximum-scale=1,minimum-scale=1,user-scalable=0,width=device-width,initial-scale=1"/> <title></title> <link rel=stylesheet type=text/css href=../../css/aui18/aui.css /> <link rel=stylesheet type=text/css href=../../css/aui18/common.css /> </head> <style type=text/css>body{background-color:#f4f4f4;padding-top:20px}img{width:100%;height:auto;position:absolute;top:50%;margin-top:-50%}</style> <body> <img src="" id=mylogo> </body> <script src=../../script/api.js></script> <script src=../../script/aui-toast.js></script> <script src=../../script/tea.js></script> <script src=../../script/conn.js></script> <script src=../../script/vue.min.js></script> <script type=text/template id=template> </script> <script>function newUpLogo(a,e){tea.showp("图像处理中...","请稍候...",!0),api.ajax({url:website+"user_api.php?action=upheadimg",method:"post",timeout:30,dataType:"json",data:{values:{ID:ID},files:{"upfile[]":[a,e]}}},function(a,e){return api.hideProgress(),a?1==a.succ?(api.toast({msg:"头像更改成功"}),$api.setStorage("img",a.bimg),$api.rmStorage("bimg"),$api.rmStorage("mylogo"),api.sendEvent({name:"save_personal_data",extra:{img:a.bimg}}),updataRongyun(a.bimg),!0):void 0:(tea.toast("ajax"),!1)})}function updataRongyun(a){api.ajax({url:website+"rong/index2.php?action=getrongtoken",method:"post",timeout:30,dataType:"json",data:{values:{ID:ID,nickname:nickname,img:a}}},function(a,e){return a?200==a.code?($api.setStorage("rongtoken",a.token),!0):void api.toast({msg:"错误码："+a.code,duration:2e3,location:"middle"}):(tea.toast("ajax"),!1)})}var telphone=null,nickname=null,token=null,ID=null;apiready=function(){api.parseTapmode();var a=$api.byId("mylogo");a.src=$api.getStorage("img"),telphone=$api.getStorage("telphone"),nickname=$api.getStorage("nickname"),token=$api.getStorage("token"),ID=$api.getStorage("ID"),api.addEventListener({name:"photo"},function(e,t){var o=$api.getStorage("mylogo"),n=$api.getStorage("bimg");a.src=o,newUpLogo(o,n)})}</script> </html>