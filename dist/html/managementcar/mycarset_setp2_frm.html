<!DOCTYPE html> <html> <head> <meta charset=utf-8> <meta name=viewport content="maximum-scale=1,minimum-scale=1,user-scalable=0,width=device-width,initial-scale=1"/> <title></title> <link rel=stylesheet type=text/css href=../../css/aui_old.css /> <link rel=stylesheet type=text/css href=../../css/common.css /> </head> <style type=text/css></style> <body> <p class=aui-padded-10>请点击下面的+号上传您的行驶证照片，日常使用中，小马哥会根据您的行驶证自动为您处理很多事情，我们保证绝对不会向第三方泄漏您的信息，当然，如果您不想上传，也可以直接点下一步来跳过这个步骤</p> <div class=aui-content> <ul class="aui-list-view aui-grid-view" id=imgslist> <li class="aui-list-view-cell aui-img" id=addpic> </li> </ul> </div> <div class=aui-content> <ul class="aui-list-view aui-grid-view" id=imgadd> <li class="aui-list-view-cell aui-img aui-col-xs-4" id=addimg> <img class=aui-img-object src=../../image/add.jpg> </li> </ul> </div> </body> <script src=../../script/conn.js></script> <script src=../../script/api.js></script> <script src=../../script/zepto.min.js></script> <script src=../../script/hammer.min.js></script> <script>function showjd(){api.showProgress({style:"default",animationType:"fade",title:"图片处理中...",text:"请稍候...",modal:!1})}function loadimg(){showp("图片加载...","稍候..."),api.ajax({url:website+"getmycar.php?action=carinfo",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{ID:api.pageParam.id}}},function(i,e){i?i.errmsg||(null!=i.xszimg&&($api.html($api.byId("addpic"),'<li class="aui-list-view-cell aui-img"><img class="aui-img-object" src="'+i.xszimg+'" style="width:400px;height:200px;"></li>'),$api.setStorage("xsz_img",i._xszimg)),api.hideProgress()):(api.hideProgress(),api.alert({msg:"错误码："+e.code+"；错误信息："+e.msg+"网络状态码："+e.statusCode}))})}function uploadFile(i,e,a,t){api.ajax({url:i,method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{userid:e},files:{upfile:a}}},function(i,e){i?1==i.statu?t(i.path):0==i.statu&&alert("上传失败"):api.alert({msg:"错误码："+e.code+"；错误信息："+e.msg+"；网络状态码："+e.statusCode})})}function NewGuid(){function i(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return i()+i()+"-"+i()+"-"+i()+"-"+i()+"-"+i()+i()+i()}function getNowFormatDate(){var i=new Date,e=i.getFullYear(),a=i.getMonth()+1,t=i.getDate();return a>=1&&a<=9&&(a="0"+a),t>=0&&t<=9&&(t="0"+t),e+"-"+a+"-"+t}function getExt(i){return i.substring(i.lastIndexOf(".")+1)}function imgCompress(i,e,a,t,s){var o=api.cacheDir+"/"+getNowFormatDate()+"/",n=NewGuid()+"."+t;imageFilter.compress({img:i,quality:e,scale:e,save:{album:!1,imgPath:o,imgName:n}},function(i,e){i?s(o+n):alert(JSON.stringify(e))})}function openImageBrowser(i){imageBrowser.openImages({imageUrls:i,showList:!1,activeIndex:0})}var uiMediaScanner=null,imageFilter=null,imageBrowser=null,isIOS=!1;apiready=function(){api.parseTapmode(),uiMediaScanner=api.require("UIMediaScanner"),imageFilter=api.require("imageFilter"),imageBrowser=api.require("imageBrowser"),isIOS="ios"==api.systemType,"edit"==api.pageParam.type&&loadimg()},Zepto(function(i){var e=$api.getStorage("ID");i("#imgadd").on("tap","#addimg",function(){api.actionSheet({title:"选择来源",buttons:["相机拍摄","浏览相册"]},function(a,t){switch(a.buttonIndex){case 1:api.getPicture({sourceType:"camera",encodingType:"jpg",destinationType:"url",mediaValue:"pic",quality:50,saveToPhotoAlbum:!0},function(a,t){if(a&&a.data){var s=a.data;showjd(),imgCompress(s,.5,.5,getExt(s),function(a){var t='<li class="aui-list-view-cell aui-img aui-col-xs-4"><img class="aui-img-object" src="'+a+'" style="width:400px;height:200px;"></li>';i("#addpic").html(t),uploadFile(website+"upxs.php",e,a,function(i){$api.setStorage("xsz_img",i),api.hideProgress()})})}else api.toast({msg:"没有选择，或者选择出错"})});break;case 2:uiMediaScanner.open({type:"picture",column:4,classify:!0,max:1,sort:{key:"time",order:"desc"},texts:{stateText:"已选*项",cancelText:"取消",finishText:"完成"},styles:{bg:"#fff",mark:{icon:"",position:"bottom_left",size:20},nav:{bg:"#b23e4b",stateColor:"#fff",stateSize:18,cancelBg:"rgba(0,0,0,0)",cancelColor:"#fff",cancelSize:18,finishBg:"rgba(0,0,0,0)",finishColor:"#fff",finishSize:18}}},function(a){if(a)for(var t=0;t<a.list.length;t++)!function(s){var o=a.list[t],n=o.path;o.thumbPath;isIOS?uiMediaScanner.transPath({path:n},function(a){showjd(),imgCompress(a.path,.5,.5,o.suffix,function(a){i("#addpic").html('<li class="aui-list-view-cell aui-img"><img class="aui-img-object" src="'+a+'" style="width:400px;height:200px;"></li>'),uploadFile(website+"upxs.php",e,a,function(i){$api.setStorage("xsz_img",i),api.hideProgress()})})}):(showjd(),imgCompress(n,.5,.5,o.suffix,function(a){i("#addpic").html('<li class="aui-list-view-cell aui-img"><img class="aui-img-object" src="'+a+'" style="width:400px;height:200px;"></li>'),uploadFile(website+"upxs.php?",e,a,function(i){$api.setStorage("xsz_img",i),api.hideProgress()})}))}()})}})})})</script> </html>