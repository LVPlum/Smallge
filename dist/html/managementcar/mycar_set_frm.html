<!DOCTYPE html> <html> <head> <meta charset=utf-8> <meta name=viewport content="maximum-scale=1,minimum-scale=1,user-scalable=0,width=device-width,initial-scale=1"/> <title></title> <link rel=stylesheet type=text/css href=../../css/aui_old.css /> <link rel=stylesheet type=text/css href=../../css/common.css /> </head> <style type=text/css>.aui-content .aui-form .aui-input-row .cp{display:inline;width:25%;overflow:auto;border:1px dashed #cacaca}.aui-content .aui-form .aui-input-row .nu{width:75%}input[type=text]{text-transform:uppercase}.rf{color:red}</style> <body> <p class="aui-padded-10 aui-text-center" id=title>新增一辆我的汽车，带<span class=rf>*</span>号的为必填</p> <div class="aui-content aui-card"> <div class=aui-form> <div class=aui-input-row> <span class=aui-input-addon><span class=rf>*</span>车牌号码</span> <input type=text class="aui-input cp" id=cph value=京A readonly=readonly onclick=cplocal() /> <input type=text class="aui-input nu" id=cpm maxlength=5 placeholder=填入后5个字母或数字 oninput="value=value.toUpperCase()"/> </div> <div class=aui-input-row> <span class=aui-input-addon><span class=rf>*</span>车型</span> <div class=aui-pull-right> <input class=aui-radio type=radio id=radio1 name=cartype value=1><div class=aui-radio-name>蓝牌</div> <input class=aui-radio type=radio id=radio2 name=cartype value=2><div class=aui-radio-name>黄牌</div> </div> </div> <div class=aui-input-row> <span class=aui-input-addon><span class=rf>*</span>行驶证所有人</span> <input type=text class=aui-input id=xszr placeholder=这辆车的车行驶证所有人 /> </div> <div class=aui-input-row> <span class=aui-input-addon><span class=rf>*</span>手机号码</span> <input type=tel class=aui-input id=tel placeholder=和这辆车关联的手机号码 /> </div> <div class=aui-input-row> <span class=aui-input-addon>上传行驶证</span> <input type=text class=aui-input id=xs placeholder=上传这台车的行驶证照片 /> <div class=aui-img id=addpic> </div> </div> <div class=aui-input-row> <span class=aui-input-addon>审车到期时间</span> <input type=text class=aui-input id=tipsc maxlength=18 placeholder=可以设置到期自动提醒 readonly=readonly /> </div> <div class=aui-input-row> <span class=aui-input-addon>保险到期时间</span> <input type=text class=aui-input id=tipbx maxlength=18 placeholder=可以设置到期自动提醒 readonly=readonly /> </div> <div class=aui-input-row> <span class=aui-input-addon></span> <div class=aui-pull-right> <input class=aui-checkbox type=checkbox id=checkvip name=cartype value=1><div class=aui-radio-name>加入VIP</div> </div> </div> </div> </div> <div class=aui-btn-row> <div class="aui-btn aui-btn-block aui-btn-danger" id=po tapmode onclick=postdate()>确定提交</div> </div> </body> <script src=../../script/api.js></script> <script src=../../script/conn.js></script> <script src=../../script/zepto.min.js></script> <script src=../../script/hammer.min.js></script> <script>function checkcp(){var a=$api.val($api.byId("cph"))+$api.val($api.byId("cpm")).toUpperCase(),i=$api.val($api.byId("xszr")),e=$api.val($api.byId("ckr")),t=$api.val($api.byId("ckrs")),s=$api.val($api.byId("tel")),p=getcartype();return""==a||null==$api.val($api.byId("cpm"))?(api.toast({msg:"车牌号码有误，请检查后再试"}),!1):$api.val($api.byId("cpm")).length<5?(api.toast({msg:"车牌后面的数字不能少于5位"}),!1):""==i?(api.toast({msg:"行驶证所有人不能为空"}),!1):""==s?(api.toast({msg:"手机号码不能为空"}),!1):null==p||"undefined"==p?(api.toast({msg:"车型没有选择，请选择车型!"}),!1):($api.setStorage("cpm",a),$api.setStorage("xszr",i),$api.setStorage("ckr",e),$api.setStorage("ckrs",t),$api.setStorage("cartype",p),void api.openWin({name:"mycarset_setp2",url:"mycarset_setp2_win.html",pageParam:{id:api.pageParam.id,type:api.pageParam.type},vScrollBarEnabled:!1}))}function loaddate(){id=api.pageParam.id,showp("读取数据...","稍候..."),api.ajax({url:website+"getmycar.php?action=carinfo",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{ID:id}}},function(a,i){a?a.errmsg||($api.val($api.byId("cph"),a.carnum.substr(0,2)),$api.val($api.byId("cpm"),a.carnum.substr(2)),$api.val($api.byId("xszr"),a.xszr),$api.val($api.byId("tel"),a.tel),$api.val($api.byId("xs"),a._xszimg),$api.val($api.byId("tipsc"),a.scextime+"  提前"+a._scremind+"天提醒"),$api.val($api.byId("tipbx"),a.bxextime+"  提前"+a._bxremind+"天提醒"),bxextime=a.bxextime,bxremind=a._bxremind,scextime=a.scextime,scremind=a._scremind,xsz_img=a._xszimg,"1"==a._cartype?$api.attr($api.byId("radio1"),"checked","checked"):$api.attr($api.byId("radio2"),"checked","checked"),api.hideProgress()):(api.hideProgress(),api.alert({msg:"错误码："+i.code+"；错误信息："+i.msg+"网络状态码："+i.statusCode}))})}function cplocal(){api.openWin({name:"cpselect_win",url:"./cpselect_win.html",vScrollBarEnabled:!1})}function getcartype(){var a=document.getElementsByName("cartype");for(i=0;i<a.length;i++)if(a[i].checked)return a[i].value}function uploadFile(a,i,e,t){api.ajax({url:a,method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{userid:i},files:{upfile:e}}},function(a,i){a?1==a.statu?t(a.path):0==a.statu&&alert("上传失败"):api.alert({msg:"错误码："+i.code+"；错误信息："+i.msg+"；网络状态码："+i.statusCode})})}function NewGuid(){function a(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}function getNowFormatDate(){var a=new Date,i=a.getFullYear(),e=a.getMonth()+1,t=a.getDate();return e>=1&&e<=9&&(e="0"+e),t>=0&&t<=9&&(t="0"+t),i+"-"+e+"-"+t}function getExt(a){return a.substring(a.lastIndexOf(".")+1)}function imgCompress(a,i,e,t,s){var p=api.cacheDir+"/"+getNowFormatDate()+"/",n=NewGuid()+"."+t;imageFilter.compress({img:a,quality:i,scale:i,save:{album:!1,imgPath:p,imgName:n}},function(a,i){a?s(p+n):alert(JSON.stringify(i))})}function openImageBrowser(a){imageBrowser.openImages({imageUrls:a,showList:!1,activeIndex:0})}function postdate(){if("edit"==api.pageParam.type)var a="editcar",i=api.pageParam.id;else var a="addcar",i=$api.getStorage("ID");var e=$api.val($api.byId("cph"))+$api.val($api.byId("cpm")).toUpperCase(),t=$api.val($api.byId("xszr")),s=$api.val($api.byId("tel")),p=scextime,n=bxextime,r=scremind,l=bxremind,c=getcartype();return""==e||null==$api.val($api.byId("cpm"))?(api.toast({msg:"车牌号码有误，请检查后再试"}),!1):$api.val($api.byId("cpm")).length<5?(api.toast({msg:"车牌后面的数字不能少于5位"}),!1):""==t?(api.toast({msg:"行驶证所有人不能为空"}),!1):""==s?(api.toast({msg:"手机号码不能为空"}),!1):/^1[3|4|5|7|8][0-9]\d{4,8}$/.test(s)?null==c||"undefined"==c?(api.toast({msg:"车型没有选择，请选择车型!"}),!1):void api.ajax({url:website+"?action="+a,method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{ID:i,ntime:p,btime:n,sctips:r,bxtips:l,cpm:e,xszr:t,cartype:c,xszimg:xsz_img,tel:s}}},function(a,i){a?"ok"==a.succ?(api.sendEvent({name:"saveok"}),$api.byId("checkvip").checked?(api.openWin({name:"joinvip_scar_win",url:"../vip/vip_join_win.html",vScrollBarEnabled:!1}),setTimeout(function(){api.sendEvent({name:"addoldcar",extra:{car:e,carid:a.carid,tel:s,cartype:c}})},500)):api.closeWin(),api.hideProgress()):(api.alert({msg:a.ermsg}),api.hideProgress()):(api.hideProgress(),api.alert({msg:"错误码："+i.code+"；错误信息："+i.msg+"网络状态码："+i.statusCode}))}):(api.toast({msg:"手机号码格式不对"}),!1)}var uiMediaScanner=null,imageFilter=null,imageBrowser=null,xsz_img=null,bxextime=null,bxremind=null,scextime=null,scremind=null,isIOS=!1;apiready=function(){api.parseTapmode(),api.addEventListener({name:"selectzm"},function(a,i){var e=$api.byId("cph"),t=a.value.zm1+a.value.zm2;$api.val(e,t)}),api.addEventListener({name:"addntime"},function(a,i){scextime=a.value.n1;var e=0==(scremind=a.value.n2)?"":"  提前"+scremind+"天提醒";$api.val($api.byId("tipsc"),scextime+e)}),api.addEventListener({name:"addbtime"},function(a,i){bxextime=a.value.n1;var e=0==(bxremind=a.value.n2)?"":"  提前"+bxremind+"天提醒";$api.val($api.byId("tipbx"),bxextime+e)}),uiMediaScanner=api.require("UIMediaScanner"),imageFilter=api.require("imageFilter"),imageBrowser=api.require("imageBrowser"),isIOS="ios"==api.systemType,"edit"==api.pageParam.type&&($api.text($api.byId("title"),"修改车辆内容"),$api.html($api.byId("po"),"确定修改"),loaddate())},Zepto(function(a){a("#tipsc").on("tap",function(){api.openWin({name:"settipsc_win",url:"settipsc_win.html",vScrollBarEnabled:!1})}),a("#tipbx").on("tap",function(){api.openWin({name:"settipbx_win",url:"settipbx_win.html",vScrollBarEnabled:!1})});var i=$api.getStorage("ID");a("#xs").on("tap",function(){api.actionSheet({title:"选择来源",buttons:["相机拍摄","浏览相册"]},function(e,t){switch(e.buttonIndex){case 1:api.getPicture({sourceType:"camera",encodingType:"jpg",destinationType:"url",mediaValue:"pic",quality:50,saveToPhotoAlbum:!0},function(e,t){if(e&&e.data){var s=e.data;showp("图片处理中...","请稍候..."),imgCompress(s,.5,.5,getExt(s),function(e){var t='<li class="aui-list-view-cell aui-img aui-col-xs-4"><img class="aui-img-object" src="'+e+'" style="width:400px;height:200px;"></li>';a("#xs").remove(),a("#addpic").html(t),uploadFile(website+"upxs.php",i,e,function(a){xsz_img=a,api.hideProgress()})})}else api.toast({msg:"没有选择，或者选择出错"})});break;case 2:uiMediaScanner.open({type:"picture",column:4,classify:!0,max:1,sort:{key:"time",order:"desc"},texts:{stateText:"已选*项",cancelText:"取消",finishText:"完成"},styles:{bg:"#fff",mark:{icon:"",position:"bottom_left",size:20},nav:{bg:"#b23e4b",stateColor:"#fff",stateSize:18,cancelBg:"rgba(0,0,0,0)",cancelColor:"#fff",cancelSize:18,finishBg:"rgba(0,0,0,0)",finishColor:"#fff",finishSize:18}}},function(e){if(e)for(var t=0;t<e.list.length;t++)!function(s){var p=e.list[t],n=p.path;p.thumbPath;isIOS?uiMediaScanner.transPath({path:n},function(e){showp("图片处理中...","请稍候..."),imgCompress(e.path,.5,.5,p.suffix,function(e){a("#xs").remove(),a("#addpic").html('<li class="aui-list-view-cell aui-img"><img class="aui-img-object" src="'+e+'" style="width:200px;height:100px;"></li>'),uploadFile(website+"upxs.php",i,e,function(a){xsz_img=a,api.hideProgress()})})}):(showp("图片处理中...","请稍候..."),imgCompress(n,.5,.5,p.suffix,function(e){a("#xs").remove(),a("#addpic").html('<li class="aui-list-view-cell aui-img"><img class="aui-img-object" src="'+e+'" style="width:200px;height:100px;"></li>'),uploadFile(website+"upxs.php?",i,e,function(a){xsz_img=a,api.hideProgress()})}))}()})}})})})</script> </html>