<!DOCTYPE html> <html> <head> <meta charset=utf-8> <meta name=viewport content="maximum-scale=1,minimum-scale=1,user-scalable=0,width=device-width,initial-scale=1"/> <meta name=format-detection content="telephone=no,email=no,date=no,aItemress=no"> <title></title> <link rel=stylesheet type=text/css href=../../css/api.css /> <link rel=stylesheet type=text/css href=../../css/aui.css /> <link rel=stylesheet type=text/css href=../../css/aui-skin.css /> <link rel=stylesheet type=text/css href=../../css/tea.css /> <style type=text/css>.btn-code{width:7rem}footer{margin:2.5rem 1.125rem}</style> </head> <body> <div id=app v-cloak> <ul class="aui-list aui-form-list aui-list-noborder"> <li class="aui-list-item tea-bg-default"> <div class=aui-list-item-inner> <div class=aui-list-item-title style=height:2.625rem;line-height:2.625rem> 请输入手机 <span class=tea-text-blue>{{ tel.replace(/(\d{3})\d{4}(\d{4})/, "$1****$2") }}</span> 收到的验证码 </div> </div> </li> <li class=aui-list-item> <div class=aui-list-item-inner> <div class=aui-list-item-input> <input id=code type=tel placeholder=请输入短信验证码 maxlength=6 v-model=code> </div> <div class="btn-code tea-border-l aui-text-center aui-font-size-14 tea-text-default" :class="{'tea-text-red' : time == 0}" @click=sendCode tapmode> {{ time == 0? '重新发送' : time + '秒后重发' }} </div> </div> </li> </ul> <footer> <div class="aui-btn aui-btn-block tea-btn-submit" :class="{'tea-active' : !errorMsg}" @click=sumbit()>提交</div> </footer> </div> </body> <script src=../../script/api.js></script> <script src=../../script/fastclick.min.js></script> <script src=../../script/conn.js></script> <script src=../../script/vue.min.js></script> <script src=../../script/md5.min.js></script> <script src=../../script/account.js></script> <script src=../../script/tea.js></script> <script type=text/template id=template> </script> <script>function init(){ajax={reset:function(){api.ajax({url:website+"user_api.php?action=forgot",method:"post",timeout:30,data:{values:{tel:vm.tel,smscode:vm.code}},dataType:"json",returnAll:!1},function(e,t){e?2==e.succ?api.openWin({name:"password_set_win",url:"../account/password_set_win.html",bounces:!1,pageParam:{type:"reset",tel:vm.tel,code:vm.code}}):api.toast({msg:e.msg,duration:2e3,location:"middle"}):tea.toast("ajax")})},register:function(){api.showProgress({style:"default",animationType:"fade",title:"努力加载中...",text:"先喝杯茶...",modal:!1}),$api.post(website+"user_api.php?action=register",{values:{tel:vm.tel,smscode:vm.code}},function(e){return api.hideProgress(),e?1==e.succ?(account.loginSucc(e.data,"register"),!0):2==e.succ?(alert("该号码已注册，请直接登陆"),api.pageParam.type="login",api.openWin({name:"login_other_win",url:"../account/login_other_win.html",pageParam:{tel:vm.tel}}),!1):void api.toast({msg:e.msg,duration:2e3,location:"middle"}):(tea.toast("ajax"),!1)})},login:account.loginByCode},updateHTML(),initModule(),initEventListener()}function initModule(){var e=$api.offset($api.byId("code")),t=api.require("UIInput");t.open({rect:{x:e.l,y:e.t+1,w:e.w,h:e.h-1},styles:{bgColor:"#fff",size:16,color:"#333",placeholder:{color:"#ccc"}},autoFocus:!0,maxRows:1,placeholder:"请输入短信验证码",keyboardType:"number",fixedOn:api.frameName},function(e,a){e&&t.value(function(e,a){e&&(e.msg.length>6&&t.value({msg:e.msg.substr(0,6)}),vm.code=e.msg)})})}function initEventListener(){}function updateHTML(){}function getSingle(e){var t;return function(){return t||(t=e.apply(this,arguments))}}var dom={},vm=null,ajax=null;apiready=function(){vm=new Vue({el:"#app",data:{tel:api.pageParam.tel,code:"",time:0,count:60,sending:!1},methods:{sumbit:function(){if(vm.errorMsg)return api.toast({msg:vm.errorMsg,duration:2e3,location:"middle"}),!1;ajax[api.pageParam.type]()},sendCode:function(){api.showProgress({style:"default",animationType:"fade",title:"努力加载中...",text:"先喝杯茶...",modal:!1}),api.ajax({url:website+"smscode.php",method:"post",timeout:30,data:{values:{ID:$api.getStorage("ID"),token:$api.getStorage("token"),tel:vm.tel,temp:3,templateSMS:vm.formatSMS(),systemType:api.systemType,systemVersion:api.systemVersion,deviceId:api.deviceId,deviceModel:api.deviceModel,deviceName:api.deviceName,operator:api.operator,connectionType:api.connectionType}},returnAll:!1},function(e,t){if(api.hideProgress(),e)if(1==e.succ){if(api.toast({msg:"发送成功",duration:2e3,location:"middle"}),vm.sending)return;vm.sending=!0,vm.time=vm.count;var a=setInterval(function(){if(0==vm.time)return clearInterval(a),void(vm.sending=!1);vm.time-=1},"1000")}else vm.sending=!1,api.toast({msg:"验证码发送失败",duration:2e3,location:"middle"});else tea.toast("ajax")})},formatSMS:function(){switch(api.pageParam.type){case"login":return"158243";case"register":return"16463";case"borrow":return"118895";case"reset":return"24468";default:return"118895"}}},computed:{errorMsg:function(e){var t=new tea.checkRule;return t.add(this.code,[{condition:"isCode",errorMsg:"请输入四位验证码"}]),t.start()}}}),init(),vm.sendCode()}</script> </html>