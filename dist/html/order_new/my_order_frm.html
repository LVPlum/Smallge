<!DOCTYPE html> <html> <head> <meta charset=utf-8> <meta name=viewport content="maximum-scale=1,minimum-scale=1,user-scalable=0,width=device-width,initial-scale=1"/> <meta name=format-detection content="telephone=no,email=no,date=no,aItemress=no"> <title></title> <link rel=stylesheet type=text/css href=../../css/api.css /> <link rel=stylesheet type=text/css href=../../css/aui.css /> <link rel=stylesheet type=text/css href=../../css/aui-skin.css /> <link rel=stylesheet type=text/css href=../../css/swiper-3.4.2.min.css /> <link rel=stylesheet type=text/css href=../../css/tea.css /> <style type=text/css>.aui-btn{margin-left:.5rem;width:3.65rem;height:1.5rem;line-height:1.5rem;color:#666;background-color:#fff;border:1px solid #ccc;border-radius:.25rem}.btn-blue{color:#39f;border-color:#09f}.dele-btn{width:2.75rem;height:100%;position:absolute;top:0;left:100%;display:flex;align-items:center}.swipeleft{transform:translateX(-16%);-webkit-transform:translateX(-16%)}.aui-list-item-media{width:auto!important}.aui-list-item-arrow{position:relative;padding-right:.9rem}.aui-list-item-arrow:before{right:.1rem;z-index:99}.aui-iconfont:before{font-size:2rem;line-height:1}.flex-start{-webkit-align-self:flex-start;align-self:flex-start}</style> </head> <body> <div id=app> <section v-if="orderNum == 0" class=tea-nothing> <img src=../../image/nothing_img.png> <p>您还没有任何定单哦~</p> </section> <div class="aui-content aui-margin-b-15"> <ul class="aui-list aui-media-list swiper-container" v-for="(item, index) in list" :id=index v-show="isShow(item.item, item.list.status)"> <li class=swiper-wrapper> <div class="aui-list-item aui-padded-15 swiper-slide" @click="openWinDetail(item, index)"> <div class=aui-media-list-item-inner> <div class="aui-list-item-media aui-padded-0 aui-padded-r-10"> <div class=aui-iconfont :class=type[item.item].icon :style=" 'color:' + type[item.item].color"></div> </div> <div class="aui-list-item-inner aui-padded-0 aui-padded-b-5"> <div class=aui-list-item-text> <div class="aui-list-item-title aui-margin-b-10" style=max-width:70%> <div class="aui-ellipsis-1 aui-list-item-arrow"> <span class="aui-font-size-16 tea-font-weight-bold">{{type[item.item].title}}</span> <span class=aui-font-size-14 v-if="item.item == 'exempt'">(六年免检)</span> </div> <div class="aui-font-size-12 tea-text-gray aui-ellipsis-1">{{item.list.addtime}}</div> </div> <div class="aui-list-item-right flex-start aui-font-size-14 tea-text-blue">{{formatStatus(item.list.status, item.item)}}</div> </div> <div class="aui-list-item-title tea-text-default aui-font-size-14 aui-ellipsis-1 aui-ellipsis"> <span>{{type[item.item].carnum(item.list)}}</span> <span>{{type[item.item].desc(item.list)}}</span> </div> <div class="aui-list-item-title aui-font-size-14 tea-font-weight-bold aui-margin-t-5"> <span class="aui-ellipsis aui-ellipsis-1">{{type[item.item].price(item.list)}}</span> </div> </div> </div> <div class="aui-info aui-padded-0 aui-margin-0"> <div></div> <buttons :type=item.item :status=item.list.status :money=item.list.money @click.native="action(event, item, index)"></buttons> </div> </div> <div v-if="item.list.status == 12" class="aui-bg-danger aui-text-white aui-text-center swiper-slide dele-btn aui-list-item-center" @click=delOrder(index)> 删除 </div> </li> </ul> </div> </div> </body> <script src=../../script/api.js></script> <script src=../../script/fastclick.min.js></script> <script src=../../script/swiper-3.4.2.min.js></script> <script src=../../script/conn.js></script> <script src=../../script/vue.min.js></script> <script src=../../script/tea.js></script> <script type=text/template id=template> </script> <script>function init(){getData(),initModule(),initEventListener()}function initModule(){}function initEventListener(){api.addEventListener({name:"refreshOrder"},function(t,e){getData()}),api.addEventListener({name:"loginOk"},function(t,e){getData()}),api.setRefreshHeaderInfo({visible:!0,loadingImg:"widget://image/refresh.png",bgColor:"#f4f4f4",textColor:"#fff",textDown:"下拉刷新...",textUp:"松开刷新...",showTime:!0},function(t,e){getData()}),api.addEventListener({name:"delOrder"},function(t,e){vm.delOrder(t.value.index)}),api.addEventListener({name:"setOrderType"},function(t,e){vm.orderType=t.value.type,vm.status=0}),api.addEventListener({name:"setStatusIndex"},function(t,e){vm.status=t.value.index})}function getData(){api.showProgress({title:"数据加载中...",text:"请稍候",modal:!1}),api.ajax({url:website+"order_api.php?action=list",method:"post",timeout:30,data:{values:{ID:$api.getStorage("ID"),token:$api.getStorage("token"),item:void 0,status:0}},dataType:"json",returnAll:!1},function(t,e){return api.hideProgress(),api.refreshHeaderLoadDone(),t?1==t.succ?(vm.list=t.data,vm.$nextTick(function(){vm.list.forEach(function(t,e){1==t.list.status&&(mySwiper[e]=new Swiper("#"+e,{slidesPerView:"auto",initialSlide:0,resistanceRatio:.7,freeMode:!0,freeModeSticky:!0,autoplayStopOnLast:!0}))})}),!0):0==t.succ?(vm.list=[],!0):201==t.succ?(vm.list=[],!1):void 0:(tea.toast("ajax"),!1)})}var dom={},vm=null,mySwiper={};apiready=function(){vm=new Vue({el:"#app",data:{mask:!0,list:[],statusList:["全部","已完成","未完成"],status:0,orderType:"all",type:{check:{title:"网约审车",icon:"tea-icon-check",color:"#41a4ec",carnum:function(t){return t.carnum},desc:function(t){return t.checkstation},price:function(t){return t.business}},exempt:{title:"网约审车",icon:"tea-icon-check",color:"#41a4ec",carnum:function(t){return t.carnum},desc:function(t){return t.checkstation},price:function(t){return"¥"+tea.formatMoney(t.money)}},insure:{title:"车辆保险",icon:"tea-icon-insure",color:"#ff855e",carnum:function(t){return t.carnum},desc:function(t){return t.insurer},price:function(t){return t.money?"¥"+tea.formatMoney(t.money):"审核中"}},tel:{title:"话费充值",icon:"tea-icon-tel",color:"#ff855e",carnum:function(t){return t.tel},desc:function(t){return t.recharge_money},price:function(t){return"¥"+tea.formatMoney(t.money)}},agency:{title:"找代办",icon:"tea-icon-agency",color:"#00be9b",carnum:function(t){return""},desc:function(t){return t.agency_name},price:function(t){return t.business}},join:{title:"加盟申请",icon:"tea-icon-agency",color:"#00be9b",carnum:function(t){return""},desc:function(t){return t.agency_name},price:function(t){return t.shop_address}},vip:{title:"VIP",icon:"tea-icon-vip",color:"#ffc50f",carnum:function(t){return t.carnum},desc:function(t){return""},price:function(t){return"¥"+tea.formatMoney(t.money)}},etc:{title:"ETC",icon:"tea-icon-etc",color:"#4874dc",carnum:function(t){return t.carnum},desc:function(t){return""},price:function(t){return"¥"+tea.formatMoney(t.money)}},oil:{title:"超值加油",icon:"tea-icon-oil",color:"#f5b35e",carnum:function(t){return t.carnum},desc:function(t){return""},price:function(t){return"¥"+tea.formatMoney(t.money)}}}},components:{buttons:{template:'<div><span class="aui-btn" :class="item.klass" v-for="(item, index) in activeBtns" :data-action="item.action">{{item.text}}</span></div>',props:["type","status","money"],data:function(){return{btns:{pay:{action:"pay",text:"去支付",klass:"btn-blue"},cancel:{action:"cancel",text:"取消",klass:""},comment:{action:"comment",text:"评价",klass:"btn-blue"}}}},computed:{activeBtns:function(){var t=[];return this.money&&2==this.status&&t.push(this.btns.pay),1==this.status&&t.push(this.btns.comment),t}}}},methods:{isShow:function(t,e){return("all"==this.orderType||this.orderType==t)&&(0==this.status||this.status==e)},formatStatus:function(t,e){switch(t){case 1:return"已完成";case 2:return~["check","join","etc","agency"].indexOf(e)?"已提交":"未完成";default:return"未知状态"}},delOrder:function(t){mySwiper[t].slideTo(0,100,!1),api.confirm({msg:"确认删除订单吗？",buttons:["确定","取消"]},function(e,n){1==e.buttonIndex&&(api.showProgress({title:"订单删除中...",text:"请稍候...",modal:!0}),api.ajax({url:website+"api.php?action=delorder",method:"post",timeout:30,data:{values:{ID:$api.getStorage("ID"),token:$api.getStorage("token"),order_id:vm.list[t].order_id,order_type:vm.list[t].order_type}},dataType:"json",returnAll:!1},function(e,n){if(api.hideProgress(),!e)return tea.toast("ajax"),!1;0==e.success&&(vm.list.splice(t,1),getData(),api.closeWin({name:"order_detail_win"})),api.toast({msg:e.message,duration:2e3,location:"bottom"})}))})},test:function(t){api.prompt({buttons:["确定","取消"]},function(e,n){var i=e.text;vm.list[t].status=i})},openWinDetail:function(t,e){api.openWin({name:"order_detail_win",url:"./order_detail_win.html",bounces:!1,pageParam:{id:t.list.id,type:t.item,status:t.list.status,insureCheck:t.list.insure_check,money:t.list.money,index:e}})},action:function(t,e,n){var i=t.target;switch($api.attr(i,"data-action")){case"pay":api.openWin({name:"pay_win",url:"../pay/pay_win.html",pageParam:{orderId:e.list.id,deposit:e.list.money}});break;case"comment":api.openWin({name:"comment_win",url:"./comment_win.html",bounces:!1,pageParam:{orderId:e.list.id,orderType:e.item}});break;default:return!1}}},computed:{orderNum:function(){var t=0;return this.list.forEach(function(e){vm.isShow(e.item,e.list.status)&&t++},this),t}},watch:{}}),init()}</script> </html>