<!DOCTYPE html> <html lang=en> <head> <meta charset=utf-8> <meta name=viewport content="maximum-scale=1,minimum-scale=1,user-scalable=0,width=device-width,initial-scale=1"/> <meta name=format-detection content="telephone=no,email=no,date=no,address=no"> <title>登录注册</title> <script src=../../script/Flexible-fontSize.js></script> <link rel=stylesheet href=../../css/aui-slide.css /> <link rel=stylesheet type=text/css href=../../css/api.css /> <style>*{margin:0;padding:0}body,html{width:100%;height:100%;background-color:#fff;overflow:hidden}input{outline:0;-webkit-appearance:none}ul{list-style:none}header{width:100%;height:20.6rem;position:relative}.login-bg{width:100%;height:100%;background:url(../../image/denglu.png) no-repeat;background-size:cover;-webkit-background-size:cover;-moz-background-size:cover;-o-background-size:cover}.login-Content{width:100%;height:4.6rem;background-color:#000;opacity:.6;position:absolute;left:0;right:0;bottom:0;overflow:hidden}.login{width:50%;height:100%;position:relative;line-height:4.6rem;font-size:1.6rem;float:left;text-align:center;color:#fff}.login-active{color:#39f!important}.login-active:before{content:' ';width:0;height:0;position:absolute;left:8.8rem;bottom:.6rem;margin:-.6rem -.3rem;border:solid transparent;border-width:.6rem;border-bottom-color:#fff;z-index:99}nav{width:100%;height:6.4rem;font-size:1.6rem;text-align:center;margin:0 auto;color:#333;display:none;border:1px solid #ededed;overflow:hidden}nav>div{width:100%;height:100%;position:relative;margin:0 auto;text-align:center}.nav-title{line-height:1;font-size:1.6rem;margin:3.8rem auto 1rem auto;display:inline-block}section{width:100%;height:auto;color:#333}.section-frm-item-inner{width:29.6rem;height:auto;margin:0 auto;text-align:center}.login-margin-t-58{margin-top:2.9rem!important}.section-li{width:100%;height:5.5rem;line-height:5.5rem;position:relative;border-bottom:1px solid #ccc}.section-li>input{width:100%;height:2rem;line-height:2rem;margin-top:1.75rem;font-size:1.6rem;color:#333;border:none}.section-right-text{width:100%;color:#39f;font-size:1.4rem;text-align:right;margin-top:1rem}#confirmPwd,#confirmUserName,#newPwd,#yanZhengMa{display:none}#confirmUserName{margin-bottom:8.5rem}.yanZhengMa_btn{position:absolute;top:0;right:0;margin:auto 0;font-size:1.4rem;color:#39f}.login-btn{width:100%;height:4rem;text-align:center;line-height:4rem;font-size:1.6rem;color:#fff;background-color:#39f;border:none;border-radius:99px;overflow:hidden}.login-btn>p{text-align:center;font-size:1.6rem;margin:-2px;padding:2px;color:#fff;border:none;border-radius:99px;background-color:#39f}.section-li-active:before{content:'+86';font-size:1.6rem;color:#333;margin-left:-4rem;margin-right:1rem}.section-li-active>input{width:auto}.icon-arrows-r:after,.icon-arrows-r:before{content:' ';width:0;height:0;position:absolute;left:1.5rem;border:solid transparent}.icon-arrows-r:after{bottom:2rem;margin:-1.1rem 0;border-width:1.1rem;border-right-color:#fff}.icon-arrows-r:before{bottom:2rem;margin:-1rem 0;border-width:1rem;border-right-color:#333}.clear{width:3rem;height:100%;line-height:5.5rem;font-size:2.2rem;font-weight:100;text-align:center;color:#333;position:absolute;top:0;right:2.5rem;bottom:0;opacity:.3;display:none}.clear-r{right:9rem}footer{width:100%;height:4rem;line-height:4rem;margin:0 auto;text-align:center;position:fixed;left:0;right:0;bottom:4rem;overflow:hidden}footer>p{font-size:1.4rem;color:#ccc;display:inline-block}.disabled{pointer-events:none}</style> </head> <body> <header id=header> <div class=login-bg id=login-bg></div> <ul class=login-Content> <li id=denglu class="login login-active"> <p>登录</p> </li> <li id=zhuce class=login> <p>注册</p> </li> </ul> </header> <nav id=nav> <div> <span id=nav_arrows class=icon-arrows-r></span> <span class=nav-title id=navTitle_text>忘记密码</span> </div> </nav> <section> <ul class="section-frm-item-inner login-margin-t-58"> <li id=phone class=section-li> <span id=clear_phone_val class=clear>&times;</span> <input id=phone_val type=tel placeholder=请输入手机号码 maxlength=11 tapmode oninput=isNumber(this),clear_inptValBtn(this)> </li> <li id=yanZhengMa class=section-li> <span id=clear_yanZhengMa_val class="clear clear-r">&times;</span> <input id=yanZhengMa_val type=tel placeholder=请输入验证码 maxlength=6 tapmode oninput=isNumber(this),clear_inptValBtn(this)> <p class=yanZhengMa_btn id=yanZhengMa_btn>获取验证码</p> </li> <li id=pwd class=section-li> <input id=pwd_val type=password placeholder=请输入密码(不少于6位) tapmode onkeyup=isInputPwdNull(this,event)> </li> <li id=newPwd class=section-li> <span class=clear>&times;</span> <input id=newPwd_val type=password placeholder=请设置您的新密码(不少于6位) tapmode oninput=isInputPwdNull(this,event)> </li> <li id=confirmPwd class=section-li> <span class=clear>&times;</span> <input id=confirmPwd_val type=password placeholder=请再次确认您的新密码(不少于6位) tapmode oninput=isInputPwdNull(this,event)> </li> <li id=confirmUserName class=section-li> <span id=clear_confirmUserName_val class=clear>&times;</span> <input id=confirmUserName_val type=text placeholder=请设置您的昵称 maxlength=15 tapmode oninput=clear_inptValBtn(this)> </li> <li id=wanJiMiMa class=section-right-text> <span id=wanJiMiMa_text>忘记密码？</span> </li> <li id=submit class="login-margin-t-58 login-btn"> <p id=submit_text>登录</p> </li> </ul> </section> <script src=../../script/api.js></script> <script src=../../script/base.js></script> <script src=../../script/conn.js></script> <script>function show(a){a.style.display="block"}function hide(a){a.style.display="none"}function isNumber(a){a.value=a.value.replace(/[^\d]/g,"")}function clear_inptVal(){$api.val(yanZhengMa_val,""),$api.val(pwd_val,""),$api.val(newPwd_val,""),$api.val(confirmPwd_val,""),$api.val(confirmUserName_val,"")}function clear_inptValBtn(a){"phone_val"==a.id?0!==a.value.length?show(clear_phone_val):hide(clear_phone_val):"yanZhengMa_val"==a.id?0!==a.value.length?show(clear_yanZhengMa_val):hide(clear_yanZhengMa_val):"confirmUserName_val"==a.id?0!==a.value.length?show(clear_confirmUserName_val):hide(clear_confirmUserName_val):(hide(clear_phone_val),hide(clear_yanZhengMa_val),hide(clear_confirmUserName_val))}function getCode(){var a=$api.val(phone_val);if(isVerifyPhoneNum(a)){var e=website+"sendsmscode.php?checknum=3",i={phonenum:a};api.showProgress({title:"正在获取..",text:"请稍后",modal:!1}),_ajax(e,i,function(a){a.errmsg||("no"==a.succ?api.toast({msg:a.msg}):new setCountdown(phone_val,yanZhengMa_btn,clear_phone_val).init(),api.hideProgress())})}else api.toast({msg:"请输入正确的手机号码"})}function setCountdown(a,e,i){window.timeOut=null;var n=this;this._timer=120,this.PhoneNumElem=a,this.codeBtnElem=e,this.init=function(){if(!(n._timer>1))return n.codeBtnElem.innerHTML="获取验证码",e.style.color="#3399ff",n.PhoneNumElem.disabled=!1,$api.removeCls(n.codeBtnElem,"disabled"),void $api.removeCls(i,"disabled");n._timer--,n.PhoneNumElem.disabled=!0,$api.addCls(n.codeBtnElem,"disabled"),$api.addCls(i,"disabled"),e.style.color="#999",window.clearTimeout(timeOut),timeOut=setTimeout(function(){n.init()},1e3),n.codeBtnElem.innerHTML=n._timer+"s后重发"}}function gotoDengLuYe(){show(header),show(phone),show(wanJiMiMa),show(pwd),hide(nav),hide(newPwd),hide(confirmPwd),hide(confirmUserName),hide(yanZhengMa),$api.html(submit_text,"登录"),$api.removeCls(phone,"section-li-active"),$api.addCls(denglu,"login-active"),$api.removeCls(zhuce,"login-active")}function gotoZhuCeYe(){$api.html(navTitle_text,"忘记密码"),show(header),show(phone),show(yanZhengMa),hide(nav),hide(wanJiMiMa),hide(pwd),hide(newPwd),hide(confirmPwd),hide(confirmUserName),$api.html(submit_text,"下一步"),$api.addCls(phone,"section-li-active"),$api.addCls(zhuce,"login-active"),$api.removeCls(denglu,"login-active")}function clickSubmit_denglu(a){var e=$api.trim($api.val(phone_val)),i=$api.trim($api.val(pwd_val));isVerifyPhoneNum(e)?0===i.length?api.toast({msg:"请输入您的登录密码"}):a(e,i):api.toast({msg:"请输入正确的手机号码"})}function clickSub_VerifyPhoneAndYanZhengMa(a){var e=$api.trim($api.val(phone_val)),i=$api.trim($api.val(yanZhengMa_val));isVerifyPhoneNum(e)?0===i.length?api.toast({msg:"请输入您获取的验证码"}):a(e,i):api.toast({msg:"请输入正确的手机号码"})}function setPwd(a,e){var i=$api.val(a),n=$api.val(confirmPwd_val);0===i.length?api.toast({msg:"请输入您的密码"}):i.length<6?api.toast({msg:"密码不能少于6位"}):0===n.length?api.toast({msg:"请再次输入您的确认密码"}):n!==i?api.toast({msg:"您两次输入的密码不一致"}):e(i,n)}function _ajax(a,e,i){api.ajax({url:a,method:"post",timeout:30,dataType:"json",cache:!1,returnAll:!1,data:{values:e}},function(a,e){a&&i(a)})}function isInputPwdNull(a,e){return 13==e.keyCode&&submit.click(),a.value=a.value.replace(/^ +| +$/g,"")}apiready=function(){var a=$api.byId("header"),e=$api.byId("nav"),i=$api.byId("nav_arrows"),n=$api.byId("navTitle_text"),t=$api.byId("denglu"),o=$api.byId("zhuce"),p=$api.byId("phone"),s=$api.byId("phone_val"),l=$api.byId("yanZhengMa"),d=$api.byId("yanZhengMa_val"),r=$api.byId("yanZhengMa_btn"),c=$api.byId("wanJiMiMa"),h=$api.byId("wanJiMiMa_text"),m=$api.byId("submit"),g=$api.byId("submit_text"),v=$api.byId("clear_phone_val"),u=$api.byId("clear_yanZhengMa_val"),$=$api.byId("clear_confirmUserName_val"),_=$api.byId("pwd"),f=$api.byId("pwd_val"),w=$api.byId("newPwd"),y=$api.byId("newPwd_val"),b=$api.byId("confirmPwd"),P=$api.byId("confirmPwd_val"),k=$api.byId("confirmUserName"),I=$api.byId("confirmUserName_val");$api.addEvt(t,"click",function(a){fnStopPropagation(a),clear_inptVal(),clear_inptValBtn(this),gotoDengLuYe()}),$api.addEvt(o,"click",function(a){fnStopPropagation(a),clear_inptVal(),clear_inptValBtn(this),gotoZhuCeYe()}),$api.addEvt(h,"click",function(i){fnStopPropagation(i),clear_inptVal(),hide(a),show(e),$api.html(g,"下一步,重置密码"),$api.addCls(p,"section-li-active"),show(l),hide(_),hide(c)}),$api.addEvt(v,"click",function(a){fnStopPropagation(a),$api.val(s,""),hide(v)}),$api.addEvt(u,"click",function(a){fnStopPropagation(a),$api.val(d,""),hide(u)}),$api.addEvt($,"click",function(a){fnStopPropagation(a),$api.val(I,""),hide($)}),$api.addEvt(i,"click",function(a){fnStopPropagation(a),clear_inptVal();var e=$api.trim($api.text(n));clear_inptVal(),"忘记密码"==e?gotoDengLuYe():"重置密码"==e?gotoDengLuYe():"设置密码"==e?gotoZhuCeYe():"设置昵称"==e&&gotoZhuCeYe()}),$api.addEvt(r,"click",function(a){fnStopPropagation(a),getCode()}),$api.addEvt(m,"click",function(i){fnStopPropagation(i),clear_inptValBtn(this);var t=$api.trim($api.text(g));if("登录"==t)clickSubmit_denglu(function(a,e){var i=website+"?action=login",n={username:a,password:e};api.showProgress({title:"登录中..",text:"请稍后",modal:!1}),_ajax(i,n,function(a){api.hideProgress(),"no"==a.loginstr?api.toast({msg:a.errmsg}):($api.setStorage("ID",a.ID),$api.setStorage("nickname",a.nickname),$api.setStorage("telphone",a.telphone),$api.setStorage("token",a.token),$api.setStorage("img",a.img),$api.setStorage("active",a.active),_ajax(website+"rong/index2.php?action=getrongtoken",{ID:a.ID,nickname:a.nickname,img:a.img},function(a){a.errmsg||($api.setStorage("rongtoken",a.token),api.hideProgress(),clear_inptVal(),api.sendEvent({name:"save_personal_data",extra:{}}),api.sendEvent({name:"loginSuccess",extra:{key:" value"}}),setTimeout(function(){api.closeToWin({name:"main_win",animation:{type:"none"}})},1e3))}))})});else if("下一步"==t)"设置密码"==$api.trim($api.text(n))?setPwd(f,function(){$api.html(n,"设置昵称"),show(k),hide(_),hide(b),$api.html(g,"完成")}):clickSub_VerifyPhoneAndYanZhengMa(function(i,t){api.showProgress({title:"请求中..",text:"请稍后",modal:!1}),_ajax(website+"verifysms.php",{phonenum:i,smscode:t},function(i){"no"==i.succ?api.toast({msg:i.msg}):(hide(a),show(e),$api.html(n,"设置密码"),hide(p),hide(l),show(_),show(b)),api.hideProgress()})});else if("下一步,重置密码"==t)clickSub_VerifyPhoneAndYanZhengMa(function(){var i=website+"verifysms2.php",t={phonenum:$api.val(s),smscode:$api.val(d)};api.showProgress({title:"请求中..",text:"请稍后",modal:!1}),_ajax(i,t,function(i){i.errmsg||("no"==i.succ?api.toast({msg:i.msg}):(hide(a),show(e),$api.html(n,"重置密码"),hide(p),hide(l),hide(_),show(w),show(b),$api.html(g,"完成")),api.hideProgress())})});else if("完成"==t)if("重置密码"==$api.trim($api.text(n)))setPwd(y,function(a,e){var i=website+"chsysset.php?action=repassword",n={pass1:a,pass2:e,telphone:$api.val(s)};api.showProgress({title:"请求中..",text:"请稍后",modal:!1}),_ajax(i,n,function(a){1==a.succ?(api.toast({msg:"修改成功"}),setTimeout(function(){gotoDengLuYe()},1500)):api.toast({msg:a.msg}),api.hideProgress()})});else{var o=$api.trim($api.val(I));if(0===o.length)api.toast({msg:"设置昵称不能为空"});else{var r=$api.val(s),c=($api.val(f),$api.val(P)),h=api.deviceId,m=api.deviceModel,v=api.deviceName,u=gettoken(r),$=website+"?action=skipreg",x={nickname:o,telphone:r,password:c,token:u,deviceId:h,deviceModel:m,deviceName:v};api.showProgress({title:"数据提交中..",text:"请稍后",modal:!1}),_ajax($,x,function(a){a.errmsg?(api.hideProgress(),api.toast({msg:"请求超时,请联系管理员"})):($api.setStorage("nickname",a.nickname),$api.setStorage("telphone",a.telphone),$api.setStorage("token",a.token),$api.setStorage("ID",a.ID),$api.setStorage("img",a.img),_ajax(website+"rong/index2.php?action=getrongtoken",{ID:a.ID,nickname:a.nickname,img:a.img},function(a){a.errmsg||($api.setStorage("rongtoken",a.token),api.hideProgress(),clear_inptVal(),api.sendEvent({name:"loginSuccess",extra:{key:" value"}}),api.closeToWin({name:"main_win",animation:{type:"flip",subType:"from_bottom",duration:500}}))}))})}}})}</script> </body> </html>