<!DOCTYPE html> <html> <head> <meta charset=utf-8> <meta name=viewport content="maximum-scale=1,minimum-scale=1,user-scalable=0,width=device-width,initial-scale=1"/> <meta name=format-detection content="telephone=no,email=no,date=no,aItemress=no"> <title></title> <link rel=stylesheet type=text/css href=../../css/api.css /> <link rel=stylesheet type=text/css href=../../css/aui.css /> <link rel=stylesheet type=text/css href=../../css/aui-skin.css /> <link rel=stylesheet type=text/css href=../../css/tea.css /> <style type=text/css>footer{margin:2.5rem 1.125rem}.aui-btn-block{color:#fff;background-color:#ed7474;height:2.5rem;line-height:2.5rem;border-radius:1.25rem}</style> </head> <body> <div id=app v-cloak> <ul class="aui-list aui-form-list"> <li class="aui-list-item tea-bg-default"> <div class=aui-list-item-inner> <div class=aui-list-item-title style=height:2.625rem;line-height:2.625rem> 设置新登录密码 </div> </div> </li> <li class=aui-list-item> <div class=aui-list-item-inner> <div class=aui-list-item-input> <input id=password type=password placeholder=新登录密码，6-16位字符 maxlength=16 v-model=password> </div> </div> </li> <li class=aui-list-item> <div class=aui-list-item-inner> <div class=aui-list-item-input> <input id=repassword type=password placeholder=请再次输入密码 maxlength=16 v-model=repassword @keyup.enter=submit> </div> </div> </li> </ul> <footer> <div class="aui-btn aui-btn-block" :class="{'tea-active' : isOK}" @click=sumbit()>提交</div> </footer> </div> </body> <script src=../../script/api.js></script> <script src=../../script/tea.js></script> <script src=../../script/conn.js></script> <script src=../../script/vue.min.js></script> <script src=../../script/md5.min.js></script> <script type=text/template id=template> </script> <script>function init(){dom={password:$api.byId("password")},updateHTML(),initModule(),initEventListener()}function initModule(){var e=api.require("UIInput");!function(a,o,t){var s=$api.byId(a),i=$api.offset(s);e.open({rect:{x:i.l,y:i.t+1,w:i.w,h:i.h-2},styles:{bgColor:"#fff",size:16,color:"#333",placeholder:{color:"#ccc"}},autoFocus:t,maxRows:1,placeholder:o,keyboardType:"default",inputType:"password",fixedOn:api.frameName},function(o,t){o&&e.value(function(o,t){o&&(o.msg.length>16&&(api.toast({msg:"达到长度上限",duration:2e3,location:"middle"}),e.value({msg:o.msg.substr(0,16)})),vm[a]=o.msg)})})}("password","新登录密码，6-16位字符",!0)}function initEventListener(){}function updateHTML(){}var dom={},vm=null;apiready=function(){vm=new Vue({el:"#app",data:{tel:api.pageParam.tel,code:api.pageParam.code,password:"",repassword:"",isOK:!1},methods:{sumbit:function(){var e=vm.check();if(vm.password!==vm.repassword&&(e="两次密码不一致"),e)return api.toast({msg:e,duration:2e3,location:"middle"}),!1;api.showProgress({style:"default",animationType:"fade",title:"努力加载中...",text:"请稍候...",modal:!0}),api.ajax({url:website+"user_api.php?action=forgot",method:"post",timeout:30,data:{values:{tel:vm.tel,smscode:vm.code,password:vm.password}},dataType:"json",returnAll:!1},function(e,a){if(api.hideProgress(),e)switch(e.succ){case 1:api.toast({msg:"密码重置成功",duration:2e3,location:"middle"}),setTimeout(function(){api.closeToWin({name:"login_win"})},2e3);break;default:api.toast({msg:e.msg,duration:2e3,location:"middle"})}else tea.toast("ajax")})},check:function(e){var a=new tea.checkRule;return a.add(vm.password,[{condition:"isNoEmpty",errorMsg:"密码不可为空"},{condition:"minLength:6",errorMsg:"密码长度不够"}]),a.start()}},watch:{password:{handler:function(e,a){vm.password.length>5&&vm.repassword.length>5&&vm.password==vm.repassword?vm.isOK=!0:vm.isOK=!1},deep:!0},repassword:{handler:function(e,a){vm.password.length>5&&vm.repassword.length>5&&vm.password==vm.repassword?vm.isOK=!0:vm.isOK=!1},deep:!0}}}),init()}</script> </html>