<!DOCTYPE html> <html> <head> <meta charset=utf-8> <meta name=viewport content="maximum-scale=1,minimum-scale=1,user-scalable=0,width=device-width,initial-scale=1"/> <meta name=format-detection content="telephone=no,email=no,date=no,aItemress=no"> <title>title</title> <link rel=stylesheet type=text/css href=../../css/api.css /> <link rel=stylesheet type=text/css href=../../css/aui.css /> <link rel=stylesheet type=text/css href=../../css/aui-skin.css /> <link rel=stylesheet type=text/css href=../../css/tea.css /> <style type=text/css>body,html{overflow-x:hidden;overflow-y:auto;background:0 0}section{padding-top:.25rem;width:100%;height:100%;background-color:#fff;border-radius:.25rem;position:relative}footer{position:relative;width:100%;padding:.75rem}footer .aui-btn{display:block;width:90%;margin:0 auto;height:2.2rem;line-height:2.2rem;border-radius:1.1rem}.aui-list-item.show{border:none;background-size:100% 0!important}</style> </head> <body> <section class="tea-bg-white tea-border-radius-10"> <div class="aui-content-padded aui-margin-l-0 aui-margin-b-15"> <ul class="aui-list aui-form-list aui-list-noborder aui-list-in"> <li class="aui-list-item aui-list-item-arrow" tapmode onclick=openFrameCity()> <div class=aui-list-item-label-icon> <i class="aui-iconfont aui-icon-location"></i> </div> <div class=aui-list-item-inner> <div class=aui-list-item-title>选择城市</div> <div id=area class=aui-list-item-right>北海</div> </div> </li> <li class=aui-list-item> <div class=aui-list-item-label-icon> <i class="aui-iconfont aui-icon-pencil"></i> </div> <div class=aui-list-item-inner> <div class="aui-list-item-title tea-text-star-red-after">选择车型</div> <label tapmode onclick=selectType(1)><label id=c-radio class="aui-radio aui-checked" type=radio name=car_type></label> 轿车</label> <label tapmode onclick=selectType(2)><label id=v-radio class=aui-radio type=radio name=car_type></label> 货车</label> </div> </li> <li class=aui-list-item> <div class=aui-list-item-label-icon> <i class="aui-iconfont aui-icon-phone"></i> </div> <div class=aui-list-item-inner> <div class="aui-list-item-title tea-text-star-red-after">手机号码</div> <label style=max-width:60%> <input id=telphone style=width:auto type=tel placeholder=请输入车主手机 oninput=changePhone(this)> </label> </div> </li> <li id=business class="aui-list-item aui-list-item-arrow tea" tapmode onclick=agencyToggle(this)> <div class=aui-list-item-label-icon> <i class="aui-iconfont aui-icon-edit"></i> </div> <div class=aui-list-item-inner> <div class=aui-list-item-title>代办项目</div> </div> </li> <li id=car-business class="aui-list-item aui-hide"></li> <li id=truck-business class="aui-list-item aui-hide"></li> <li class="aui-list-item aui-list-item-arrow" tapmode onclick=openWinDateSelect()> <div class=aui-list-item-label-icon> <i class="aui-iconfont aui-icon-date"></i> </div> <div class=aui-list-item-inner> <div class=aui-list-item-title>预约时间</div> <div id=time class=aui-list-item-right></div> </div> </li> </ul> </div> <footer> <div class="aui-btn tea-active" tapmode onclick=openWinAgencies()>选择代办机构</div> </footer> </section> </body> <script src=../../script/api.js></script> <script src=../../script/aui-popup.js></script> <script src=../../script/tea.js></script> <script src=../../script/conn.js></script> <script src=../../script/doT.min.js></script> <script type=text/template id=car-template> <div class="aui-list-item-inner aui-padded-15 aui-padded-t-5 aui-padded-l-0">
        <div id="businessList" class="aui-row aui-row-padded">
            {{ var i = 0; for(var prop in it){ }}
            <div class="aui-col-xs-6 tea-text-gray aui-ellipsis-1" tapmode onclick="selectBusiness({{=i}},{{=prop}})">
                <span class="aui-text-left" style="width: 10%;">{{=i + 1}}</span>

                <div class="aui-btn aui-ellipsis-1 {{=(values.carBusinessArr.indexOf(i) > -1 ? 'tea-active': '')}}" style="width: 85%;">
                    {{=it[prop]}}
                </div>


            </div>
            {{ i++;} }}
        </div>
    </div> </script> <script type=text/template id=truck-template> <div class="aui-list-item-inner aui-padded-15 aui-padded-t-5 aui-padded-l-0">
        <div id="businessList" class="aui-row aui-row-padded">
            {{ var i = 0; for(var prop in it){ }}
            <div class="aui-col-xs-6 tea-text-gray aui-ellipsis-1" tapmode onclick="selectBusiness({{=i}},{{=prop}})">
                <span class="aui-text-left" style="width: 10%;">{{=i + 1}}</span>


                <div class="aui-btn aui-ellipsis-1 {{=(values.truckBusinessArr.indexOf(i) > -1 ? 'tea-active': '')}}" style="width: 85%;">
                    {{=it[prop]}}
                </div>

            </div>
            {{ i++;} }}
        </div>
    </div> </script> <script>function showPopup(){popup.show(document.getElementById("top-right")),api.sendEvent({name:"maskInAgency",extra:{maskIn:!0}})}function initDOM(){dom.mask=$api.byId("mask"),dom.time=$api.byId("time"),dom.area=$api.byId("area"),dom.business=$api.byId("business"),dom.carBusiness=$api.byId("car-business"),dom.truckBusiness=$api.byId("truck-business"),dom.telphone=$api.byId("telphone")}function initVar(){data=api.pageParam.data,values.type=1,data.areas=[],data.areaIdArr=[];for(var e in data.area){var a=data.area[e];for(var e in a){var s=a[e];for(var e in s)data.areas.push(s[e]),data.areaIdArr.push(e)}}values.areaIndex=0,values.carBusinessArr=[parseInt(Object.keys(data.c_business)[0])],values.truckBusinessArr=[parseInt(Object.keys(data.v_business)[0])],values.telphone=tea.getStorage("telphone"),values.book_time="",void 0!==(order=api.pageParam.order)&&updateVar()}function initEventListener(){api.addEventListener({name:"selectretime"},function(e,a){e&&($api.byId("time").innerHTML=e.value.strtime,values.book_time=e.value.realtime)}),api.addEventListener({name:"areaSelect"},function(e,a){e&&(values.areaIndex=e.value.areaIndex,dom.area.innerHTML=data.areas[values.areaIndex])})}function initModule(){}function getData(){updateHTML()}function updateDOM(){}function updateVar(){values.type=order.car_type;var e=order.area.qu;values.areaIndex=data.areaIdArr.indexOf(e),values.telphone=order.telphone,values.book_time="1970-01-01 08:00:00"==order.booktime?"":order.booktime;var a=[];for(var s in order.business)a.push(order.business[s].id);1!=values.type?values.truckBusinessArr=a:values.carBusinessArr=a}function initHTML(){dom.area.innerHTML=data.areas[values.areaIndex],$api.val(dom.telphone,values.telphone),dom.time.innerHTML=values.book_time,1!=values.type&&(values.type=1,selectType(2)),void 0!==order&&agencyToggle(dom.business)}function updateHTML(){tea.doT(data.c_business,"car-template",dom.carBusiness),dom.carBusinessBtn=$api.domAll(dom.carBusiness,".aui-btn"),tea.doT(data.v_business,"truck-template",dom.truckBusiness),dom.truckBusinessBtn=$api.domAll(dom.truckBusiness,".aui-btn")}function sendEvent(){}function closeWin(){api.closeWin()}function openFrameCity(){api.sendEvent({name:"areaChange",extra:{areaIndex:values.areaIndex}}),api.openFrame({name:"agency_city_frm",url:"./agency_city_frm.html",rect:{x:0,y:0,w:"auto",h:"auto"},pageParam:{areas:data.areas,areaIndex:values.areaIndex},bounces:!1,bgColor:"rgba(0,0,0,0.6)",vScrollBarEnabled:!0,hScrollBarEnabled:!0})}function agencyToggle(e){tea.toggle(e,"show"),1==values.type?tea.toggle(dom.carBusiness):tea.toggle(dom.truckBusiness)}function openWinDateSelect(){api.openWin({name:"dateSelect",url:"../unit/date_select_win.html",pageParam:{winName:"agency_win"}})}function openWinAgencies(){1==values.type?values.business=values.carBusinessArr:values.business=values.truckBusinessArr,values.area=data.areaIdArr[values.areaIndex],testValues(values)&&($api.setStorage("agency",values),api.ajax({url:website+"api_q.php?action=get_daiban_agency",method:"post",data:{values:values}},function(e,a){e&&api.openWin({name:"agencies_win",url:"./agencies_win.html",pageParam:{data:tea.objToArr(e),order:order}})}))}function selectType(e){if(e!=values.type){var a=$api.byId("c-radio"),s=$api.byId("v-radio");tea.toggle(a,"aui-checked"),tea.toggle(s,"aui-checked"),values.type=e,$api.hasCls(dom.business,"show")&&(tea.toggle(dom.carBusiness),tea.toggle(dom.truckBusiness))}}function selectBusiness(e,a){1==values.type?setBusiness(dom.carBusinessBtn,values.carBusinessArr,e,a):setBusiness(dom.truckBusinessBtn,values.truckBusinessArr,e,a)}function changePhone(e){values.telphone=$api.val(e)}function setBusiness(e,a,s,t){var n=e[s];if($api.hasCls(n,"tea-active"))if(a.length>1){$api.removeCls(n,"tea-active");var i=a.indexOf(t);i>-1&&a.splice(i,1)}else api.toast({msg:"至少要选择一个业务~",duration:2e3,location:"middle"});else $api.addCls(n,"tea-active"),a.push(t)}function testValues(e){return values.telphone=tea.toNum(values.telphone),!!tea.checkPhone(e.telphone)||(api.toast({msg:"请输入格式正确的11位手机号码~",duration:2e3,location:"middle"}),!1)}var popup=new auiPopup;apiready=function(){initDOM(),initVar(),initHTML(),initEventListener(),initModule(),getData()};var dom={},data,values={},order</script> </html>