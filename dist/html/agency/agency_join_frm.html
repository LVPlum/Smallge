<!DOCTYPE html> <html> <head> <meta charset=utf-8> <meta name=viewport content="maximum-scale=1,minimum-scale=1,user-scalable=0,width=device-width,initial-scale=1"/> <meta name=format-detection content="telephone=no,email=no,date=no,aItemress=no"> <title>title</title> <link rel=stylesheet type=text/css href=../../css/api.css /> <link rel=stylesheet type=text/css href=../../css/aui.css /> <link rel=stylesheet type=text/css href=../../css/aui-skin.css /> <link rel=stylesheet type=text/css href=../../css/tea.css /> <style type=text/css>body,html{height:100%;background:0 0}.tea-btn-title{display:inline;zoom:1;margin:0 auto;padding:.5rem 1rem;height:1.7rem;line-height:1.7rem;font-size:.7rem;color:#333;background-color:#e5f5ff;border-right:6px solid #39f;border-left:6px solid #39f}.aui-icon-close:before{font-size:.7rem;padding:.1rem;margin-left:.25rem;border:1px solid #999;border-radius:50%}.aui-list-item.show{border:none;background-size:100% 0!important}.aui-list-item-inner.tea{width:5rem;padding-right:0}.aui-list-item-inner.aui-text-right{width:4rem!important;padding-right:0!important}img{width:3rem!important;height:3rem!important}.aui-list .aui-list-item-media{width:5rem}.aui-list-item-media.tea{padding-right:1.5rem}.aui-media-list-item-inner{-webkit-justify-content:space-between;justify-content:space-between}#car-business .tea-acitve{background-color:#f93!important}</style> </head> <body> <div class="tea-bg-white tea-border-radius-10"> <section class="aui-margin-b-15 aui-padded-t-10"> <div class="aui-text-center aui-margin-b-10"> <div class=tea-btn-title>加盟条件</div> </div> <div class="aui-content-padded aui-margin-l-0"> <ul class="aui-list aui-form-list aui-list-in"> <li class=aui-list-item> <div class=aui-list-item-inner> <div class="aui-list-item-label tea-red-star-after"> <span class=tea-text-star-red-after>机构名称</span> </div> <div class=aui-list-item-input> <input id=agency-name type=text placeholder=请输入机构名称 oninput=input(0)> </div> </div> </li> <li id=lisence-box class="aui-list-item show"> <div class=aui-list-item-inner> <div class="aui-list-item-label tea-red-star-after"> <span id=business-license class=tea-text-star-red-after>营业执照</span> </div> <span tapmode onclick=selectLicense(1)><label class="aui-radio aui-checked" data-type=1></label>有</span> <span tapmode onclick=selectLicense(0)><label class=aui-radio data-type=0></label>无</span> <span tapmode onclick=selectLicense(2)><label class=aui-radio data-type=2></label>办理中</span> </div> </li> </ul> <ul class="aui-list aui-media-list aui-list-in"> <li id=lisence-upload class=aui-list-item> <div class=aui-media-list-item-inner> <div class="aui-list-item-inner tea"> </div> <div class=aui-media-list-item-media> <div class=aui-media-list-item-inner> <div class="aui-list-item-media tea"> <img class=aui-hide src=../../image/lisence.png tapmode onclick=event.stopPropagation(),openBigImg(0)> <i class="aui-iconfont aui-icon-close tea-big aui-hide" tapmode onclick=delImg(0)></i> </div> <div class="aui-list-item-inner aui-text-right tea" tapmode onclick=openWinMedia(0)> <span class="tea-text-blue aui-font-size-14">点击上传 ></span> </div> </div> </div> </div> </li> <li class=aui-list-item> <div class=aui-media-list-item-inner> <div class="aui-list-item-inner tea"> <span class=tea-text-star-red-after>店铺照片</span> </div> <div class=aui-media-list-item-media> <div class=aui-media-list-item-inner> <div class="aui-list-item-media tea"> <img class=aui-hide src=../../image/lisence.png tapmode onclick=event.stopPropagation(),openBigImg(1)> <i class="aui-iconfont aui-icon-close aui-hide tea-big" tapmode onclick=delImg(1)></i> </div> <div class="aui-list-item-inner aui-text-right tea" tapmode onclick=openWinMedia(1)> <span class="tea-text-blue aui-font-size-14">点击上传 ></span> </div> </div> </div> </div> </li> <li class=aui-list-item> <div class=aui-media-list-item-inner> <div class="aui-list-item-inner tea"> <span class=tea-text-star-red-after>2寸法人照片</span> </div> <div class=aui-media-list-item-media> <div class=aui-media-list-item-inner> <div class="aui-list-item-media tea"> <img class=aui-hide src=../../image/lisence.png tapmode onclick=event.stopPropagation(),openBigImg(2)> <i class="aui-iconfont aui-icon-close aui-hide tea-big" tapmode onclick=delImg(2)></i> </div> <div class="aui-list-item-inner aui-text-right tea" tapmode onclick=openWinMedia(2)> <span class="tea-text-blue aui-font-size-14">点击上传 ></span> </div> </div> </div> </div> </li> </ul> <ul class="aui-list aui-form-list aui-list-in"> <li class=aui-list-item> <div class=aui-list-item-inner> <div class="aui-list-item-label tea-red-star-after"> <span class=tea-text-star-red-after>手机号码</span> </div> <div class=aui-list-item-input> <input id=telphone type=tel placeholder=请输入法人手机号码 oninput=input(1)> </div> </div> </li> <li class=aui-list-item> <div class=aui-list-item-inner> <div class="aui-list-item-label tea-red-star-after"> <span class=tea-text-star-red-after>服务电话</span> </div> <div class=aui-list-item-input> <input id=service-call type=tel placeholder=请输入服务电话 oninput=input(2)> </div> </div> </li> <li class=aui-list-item> <div class=aui-list-item-inner> <div class="aui-list-item-label tea-red-star-after"> <span class=tea-text-star-red-after>店铺地址</span> </div> <div class=aui-list-item-input> <input id=shop-address type=text placeholder=请输入店铺地址 oninput=input(3)> </div> </div> </li> </ul> </div> </section> <section> <div class="aui-text-center aui-margin-10"> <div class=tea-btn-title>选择您的擅长</div> </div> <ul class="aui-list aui-list-noborder"> <li id=car-business class=aui-list-item> <div class="aui-list-item-inner aui-padded-15 aui-padded-t-5"> </div> </li> <li id=truck-business class="aui-list-item aui-hide"></li> <li class=aui-list-item> <div class="aui-list-item-inner aui-padded-r-15 aui-padded-t-5"> <div class="aui-row aui-row-padded" style=width:100%> <div class="aui-col-xs-6 tea-text-gray aui-ellipsis-1" tapmode onclick=selectType(0)> <span class=aui-text-left style=width:10%></span> <div class="aui-btn aui-ellipsis-1 tea-active type" style=width:85%> 轿车业务 </div> </div> <div class="aui-col-xs-6 tea-text-gray aui-ellipsis-1" tapmode onclick=selectType(1)> <span class=aui-text-left style=width:10%></span> <div class="aui-btn aui-ellipsis-1 type" style=width:85%> 货车业务 </div> </div> </div> </div> </li> </ul> <div class=aui-margin-l-15> <span><i class=aui-iconfont> <div class=aui-icon-info></div> </i></span> <span><p>请不要选择您不擅长的项目，造成客户对您差评</p></span> </div> <div class=aui-padded-15 tapmode onclick=postApply()> <div class="aui-btn tea-active aui-btn-block aui-btn-outlined aui-btn-sm tea-btn-radius">提交申请</div> </div> </section> </div> </body> <script src=../../script/api.js></script> <script src=../../script/fastclick.min.js></script> <script src=../../script/conn.js></script> <script src=../../script/doT.min.js></script> <script src=../../script/tea.js></script> <script type=text/template id=car-template> <div class="aui-list-item-inner aui-padded-r-15 aui-padded-t-5 ">
        <div class="aui-row aui-row-padded">
            {{ var i = 0; for(var prop in it){ }}
            <div class="aui-col-xs-6 tea-text-gray aui-ellipsis-1" tapmode onclick="selectBusiness({{=i}},{{=prop}})">
                <span class="aui-text-left" style="width: 10%;">{{=i + 1}}</span>
                <div class="aui-btn aui-ellipsis-1 {{=(values.carBusinessArr.indexOf(parseInt(prop)) > -1 ? 'tea-active': '')}}" style="width: 85%;">
                    {{=it[prop]}}
                </div>
            </div>
            {{ i++;} }}
        </div>
    </div> </script> <script type=text/template id=truck-template> <div class="aui-list-item-inner aui-padded-r-15 aui-padded-t-5 ">
        <div class="aui-row aui-row-padded">
            {{ var i = 0; for(var prop in it){ }}
            <div class="aui-col-xs-6 tea-text-gray aui-ellipsis-1" tapmode onclick="selectBusiness({{=i}},{{=prop}})">
                <span class="aui-text-left" style="width: 10%;">{{=i + 1}}</span>
                <div class="aui-btn aui-ellipsis-1 {{=(values.truckBusinessArr.indexOf(i) > -1 ? 'tea-active': '')}}" style="width: 85%;">
                    {{=it[prop]}}
                </div>
            </div>
            {{ i++;} }}
        </div>
    </div> </script> <script>function initDOM(){dom.lisenceBox=$api.byId("lisence-box"),dom.lisenceUpload=$api.byId("lisence-upload"),dom.business=$api.byId("business"),dom.carBusiness=$api.byId("car-business"),dom.truckBusiness=$api.byId("truck-business"),dom.inputs=$api.domAll("input"),dom.radios=$api.domAll(".aui-radio"),dom.imgs=$api.domAll("img"),dom.close=$api.domAll(".aui-icon-close"),dom.imgBox=$api.domAll("img-box"),dom.type=$api.domAll(".type")}function initVar(){values.lisence=1,values.imgLocal0=null,values.imgLocal1=null,values.imgLocal2=null,values.business_license_image=null,values.legal_person_image=null,values.shop_image=null,values.types=[0];for(var e=0;e<dom.inputs.length;e++){var a=$api.attr(dom.inputs[e],"id").replace(/-/g,"_");values[a]=""}void 0!==$api.getStorage("telphone")&&(values.telphone=$api.getStorage("telphone"),$api.val(dom.inputs[1],values.telphone))}function initEventListener(){api.addEventListener({name:"getimgarr"},function(e,a){var s=e.value.imgId;values["imgLocal"+s]=e.value.img,postImg(s),$api.attr(dom.imgs[s],"src",e.value.img),$api.removeCls(dom.imgs[s],"aui-hide"),$api.removeCls(dom.close[s],"aui-hide")})}function initModule(){imageFilter=api.require("imageFilter"),imageBrowser=api.require("imageBrowser")}function getData(){api.showProgress({style:"default",animationType:"fade",title:"努力加载中...",text:"请稍候...",modal:!1}),api.ajax({url:website+"api_q.php?action=get_agent_business",method:"post",data:{}},function(e,a){e?(api.hideProgress(),updateVar(e),void 0!==(order=api.pageParam.order)&&updateOrderVar(),updateHTML(e)):tea.toast("ajax")})}function updateDOM(){}function updateVar(e){data=e,values.carBusinessArr=[parseInt(Object.keys(data.c_business)[0])],values.truckBusinessArr=[parseInt(Object.keys(data.v_business)[0])]}function updateOrderVar(){values.lisence=order.business_license,"null"!=order.business_license_image&&(values.imgLocal0=website+"agent_apply_img/"+order.business_license_image,values.business_license_image=order.business_license_image),"null"!=order.legal_person_image&&(values.imgLocal1=website+"agent_apply_img/"+order.legal_person_image,values.legal_person_image=order.legal_person_image),"null"!=order.shop_image&&(values.imgLocal2=website+"agent_apply_img/"+order.shop_image,values.shop_image=order.shop_image),values.agency_name=order.agency_name,values.telphone=order.telphone,values.service_call=order.service_call,values.shop_address=order.shop_address;var e=[];tea.isEmpty(order.c_business)?selectType(0):(e.push(0),values.carBusinessArr=getBusinessArr(order.c_business)),tea.isEmpty(order.v_business)||(e.push(1),selectType(1),values.truckBusinessArr=getBusinessArr(order.v_business)),values.types=e,values.id=order.id,values.able=1}function updateHTML(){tea.doT(data.c_business,"car-template",dom.carBusiness),dom.carBusinessBtn=$api.domAll(dom.carBusiness,".aui-btn"),tea.doT(data.v_business,"truck-template",dom.truckBusiness),dom.truckBusinessBtn=$api.domAll(dom.truckBusiness,".aui-btn"),selectLicense(values.lisence);for(e=0;e<dom.imgs.length;e++)null!=values["imgLocal"+e]&&($api.attr(dom.imgs[e],"src",values["imgLocal"+e]),$api.removeCls(dom.imgs[e],"aui-hide"),$api.removeCls(dom.close[e],"aui-hide"));for(var e=0;e<dom.inputs.length;e++){var a=dom.inputs[e],s=$api.attr(a,"id").replace(/-/g,"_");$api.val(a,values[s])}}function sendEvent(){}function closeWin(){api.closeWin()}function selectLicense(e){if(values.lisence!=e){values.lisence=e;for(var a=dom.radios.length-1;a>=0;a--)$api.attr(dom.radios[a],"data-type")==e?$api.addCls(dom.radios[a],"aui-checked"):$api.removeCls(dom.radios[a],"aui-checked");1==e?($api.removeCls(dom.lisenceUpload,"aui-hide"),$api.addCls(dom.lisenceBox,"show")):($api.addCls(dom.lisenceUpload,"aui-hide"),$api.removeCls(dom.lisenceBox,"show"))}}function postApply(){values.user_id=tea.getStorage("ID"),values.business_license=values.lisence,values.types.indexOf(0)>-1&&(values.c_business=values.carBusinessArr.join(",")),values.types.indexOf(1)>-1&&(values.v_business=values.truckBusinessArr.join(",")),check()&&api.ajax({url:website+"api_q.php?action=agent_apply_post",method:"post",data:{values:values}},function(e,a){e.succ?api.openWin({name:"success_win",url:"../unit/success_win.html",pageParam:{title:"我要加盟",result:"提交成功",data:{0:["等待小马哥公司审核通过，会与您联系","请保持通讯工具畅通"]}}}):tea.toast("ajax")})}function input(e){var a=dom.inputs[e],s=$api.val(a),i=$api.attr(a,"id").replace(/-/g,"_");values[i]=s}function upper(e,a,s,i){return console.log("匹配的完整文本："+e),console.log("匹配的捕获："+a),console.log("索引："+s),console.log("源字符串："+i),a.toUpperCase()}function openWinMedia(e){api.openWin({name:"media1_win",url:"../unit/media1_win.html",pageParam:{limit:1,imgId:e}})}function delImg(e){var a=e;switch(values["imgLocal"+a]=null,e){case 0:values.business_license_image=null;break;case 1:values.shop_image=null;break;case 2:values.legal_person_image=null}$api.addCls(dom.imgs[a],"aui-hide"),$api.addCls(dom.close[a],"aui-hide")}function openBigImg(e){var a=values["imgLocal"+e];imageBrowser.openImages({showList:!1,imageUrls:[a]})}function postImg(e){var a=values["imgLocal"+e];api.showProgress({style:"default",animationType:"fade",title:"图片上传中...",text:"请稍候...",modal:!1}),imgCompress(a,.8,.8,getExt(a),function(a){uploadFile(a,function(a){switch(e){case 0:values.business_license_image=a;break;case 1:values.shop_image=a;break;case 2:values.legal_person_image=a}api.hideProgress()})})}function selectType(e){var a=dom.type[e],s=values.types.indexOf(e);s>-1?values.types.length>1?(values.types.splice(s,1),tea.toggle(a,"tea-active"),1==e&&(tea.toggle(dom.carBusiness),tea.toggle(dom.truckBusiness))):api.toast({msg:"请至少选择一个业务类型~",duration:2e3,location:"middle"}):(values.types.push(e),tea.toggle(a,"tea-active"),1==e&&(tea.toggle(dom.carBusiness),tea.toggle(dom.truckBusiness)))}function selectBusiness(e,a){setBusiness(dom.carBusinessBtn,values.carBusinessArr,e,a),setBusiness(dom.truckBusinessBtn,values.truckBusinessArr,e,a)}function uploadFile(e,a){api.ajax({url:website+"api_q.php?action=up_agent_apply",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{files:{upfile:e}}},function(e,s){e&&a(e.path)})}function imgCompress(e,a,s,i,t){var l=api.cacheDir+"/"+getNowFormatDate()+"/",n=NewGuid()+"."+i;imageFilter.compress({img:e,quality:a,scale:a,save:{album:!1,imgPath:l,imgName:n}},function(e,a){e&&t(l+n)})}function NewGuid(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function getNowFormatDate(){var e=new Date,a=e.getFullYear(),s=e.getMonth()+1,i=e.getDate();return s>=1&&s<=9&&(s="0"+s),i>=0&&i<=9&&(i="0"+i),a+"-"+s+"-"+i}function getExt(e){return e.substring(e.lastIndexOf(".")+1)}function check(){return""===values.agency_name?(api.toast({msg:"请输入机构名称~",duration:2e3,location:"middle"}),!1):1===values.business_license&&null===values.business_license_image?(api.toast({msg:"请上传营业执照~",duration:2e3,location:"middle"}),!1):null===values.shop_image?(api.toast({msg:"请上传店铺照片~",duration:2e3,location:"middle"}),!1):null===values.legal_person_image?(api.toast({msg:"请上传2寸法人照片~",duration:2e3,location:"middle"}),!1):(values.telphone=tea.toNum(values.telphone),tea.checkPhone(values.telphone)?""===values.service_call?(api.toast({msg:"请输入格式正确的服务电话~",duration:2e3,location:"middle"}),!1):""!==values.shop_address||(api.toast({msg:"请输入店铺地址~",duration:2e3,location:"middle"}),!1):(api.toast({msg:"请输入格式正确的11位手机号码~",duration:2e3,location:"middle"}),!1))}function setBusiness(e,a,s,i){var t=e[s];if($api.hasCls(t,"tea-active"))if(a.length>1){$api.removeCls(t,"tea-active");var l=a.indexOf(i);l>-1&&a.splice(l,1)}else api.toast({msg:"至少要选择一个业务~",duration:2e3,location:"middle"});else $api.addCls(t,"tea-active"),a.push(i)}function getBusinessArr(e){var a=[];for(var s in e)a.push(parseInt(e[s].id));return a}apiready=function(){initDOM(),initVar(),initEventListener(),initModule(),getData()};var dom={},data={},values={},imageFilter=null,imageBrowser=null,order</script> </html>