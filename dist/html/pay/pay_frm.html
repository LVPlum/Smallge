<!DOCTYPE html> <html> <head> <meta charset=utf-8> <meta name=viewport content="maximum-scale=1,minimum-scale=1,user-scalable=0,width=device-width,initial-scale=1"/> <meta name=format-detection content="telephone=no,email=no,date=no,aItemress=no"> <title>title</title> <link rel=stylesheet type=text/css href=../../css/api.css /> <link rel=stylesheet type=text/css href=../../css/aui.css /> <link rel=stylesheet type=text/css href=../../css/aui-skin.css /> <link rel=stylesheet type=text/css href=../../css/tea.css /> <style type=text/css>body,html{height:100%;overflow:auto}.title{padding:1rem 0 .75rem;text-align:center;font-size:.8rem;line-height:1}.money{padding-bottom:1.35rem;text-align:center;font-size:1.8rem;line-height:1}.deal{line-height:1;margin-bottom:3rem}.deal .aui-radio{margin-top:.1rem;height:.7rem;width:.7rem}.deal .aui-radio:after,.deal .aui-radio:before{-webkit-transform:rotate(-45deg) scale(.7);transform:rotate(-45deg) scale(.7)}</style> </head> <body> <div id=title class="title aui-font-size-16 tea-text-title tea-bg-white">标题</div> <div id=money class="money tea-text-title tea-bg-white">¥</div> <ul id=type-box class="aui-list aui-list-noborder"> <li id=sum-box class=aui-list-item tapmode onclick=setType(0)> <div class=aui-list-item-inner> <div class=aui-list-item-title> <i class="aui-iconfont tea-icon-sum tea-text-blue tea-font-size-19 aui-margin-r-10"></i>余额支付 <span id=sum>(¥)</span> </div> <div class=aui-list-item-right> <span id=tip>余额不足</span> <label class=aui-radio></label> </div> </div> </li> <li class=aui-list-item tapmode onclick=setType(1)> <div class=aui-list-item-inner> <div class=aui-list-item-title> <i class="aui-iconfont tea-icon-alipay tea-text-blue tea-font-size-19 aui-margin-r-10"></i>支付宝支付 </div> <div class=aui-list-item-right> <label class=aui-radio></label> </div> </div> </li> <li class=aui-list-item tapmode onclick=setType(2)> <div class=aui-list-item-inner> <div class=aui-list-item-title> <i class="aui-iconfont tea-icon-wechat tea-text-blue tea-font-size-19 aui-margin-r-10"></i>微信支付 </div> <div class=aui-list-item-right> <label class=aui-radio></label> </div> </div> </li> <li class="aui-list-item tea-opacity"> <div class=aui-list-item-inner> <div class=aui-list-item-title> <i class="aui-iconfont tea-icon-unionpay tea-font-size-19 aui-margin-r-10"></i>银联支付 </div> <div class=aui-list-item-right> 即将开通 </div> </div> </li> </ul> <div class="aui-content-padded deal"> <span class=tea-big tapmode onclick=toggleDeal(this)> <span id=deal-radio class="aui-radio aui-checked aui-margin-r-5"></span> </span> <span class="aui-font-size-12 tea-text-blue" tapmode onclick=openWinDeal()>我已同意小马哥在线支付协议</span> </div> <div class=aui-content-padded tapmode onclick=paystar()> <div class="aui-btn aui-btn-info aui-btn-block aui-font-size-16 tea-btn-radius">确认支付</div> </div> </body> <script src=../../script/api.js></script> <script src=../../script/aui-toast.js></script> <script src=../../script/tea.js></script> <script src=../../script/conn.js></script> <script src=../../script/doT.min.js></script> <script type=text/template id=template></script> <script>function initDOM(){dom.sum=$api.byId("sum"),dom.sumBox=$api.byId("sum-box"),dom.typeBox=$api.byId("type-box"),dom.radios=$api.domAll(dom.typeBox,".aui-radio"),dom.dealRadio=$api.byId("deal-radio")}function initVar(){data=api.pageParam.data,(values=data.values).title=data.title,values.wxmony=values.paymoney,values.result_m=data.result_m?data.result_m+".00":values.paymoney,values.deal=!0,values.payType=0,values.ID=$api.getStorage("ID"),values.token=$api.getStorage("token"),values.nickname=$api.getStorage("nickname"),values.telphone=$api.getStorage("telphone"),values.orderid=curDateTime()+RndNum(10),values.zftype="1"}function initHTML(){$api.byId("title").innerHTML=data.title;var a=$api.byId("money");if(data.result_m?a.innerHTML="¥"+formatCurrency(data.result_m):a.innerHTML="¥"+formatCurrency(data.money),"recharge"==data.type){var e=$api.byId("sum-box");$api.addCls(e,"aui-hide"),$api.addCls(dom.radios[1],"aui-checked"),values.payType=1}else getSum(updateSum)}function initEventListener(){api.addEventListener({name:"paycodeok"},function(a,e){if(a){var t="paymember.php?t=zfb";switch(data.type){case"addvip":t="paymember.php?t=zfb";break;case"recharge":t="chongzhi.php";break;case"phoneRecharge":t="cz.php?action=yucz";break;case"reward":t="hongbao.php?action=dx";break;case"redpacket":t="hongbao.php?action=qunhongbao",values.hongbao=values.paymoney;break;case"insure":t="paybx.php";break;case"etc":t="etc.php?action=pay";break;case"exempt":t="exempt_api.php?action=pay";break;case"oil":t="oil_api.php?action=pay"}api.ajax({url:website+t,method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:values}},function(a,e){if(a&&("1"==a.succ&&openWinSuccess(a),"0"==a.succ))return api.alert({msg:a.msg}),!1})}else alert(JSON.stringify(e))})}function initModule(){}function getData(){}function updateDOM(){}function updateVar(){}function updateHTML(){}function sendEvent(){}function openWinDeal(){api.openWin({name:"zfxy_win",url:"./zfxy_win.html"})}function toggleDeal(a){values.deal=tea.toggle(dom.dealRadio,"aui-checked")}function setType(a){if(0===a&&$api.hasCls(dom.sumBox,"tea-opacity"))tea.toast("fail","余额不足");else if(a!==values.payType){values.payType=a;for(var e=0;e<dom.radios.length;e++)e===a?$api.addCls(dom.radios[e],"aui-checked"):$api.removeCls(dom.radios[e],"aui-checked")}}function paystar(){if(values.deal)switch(values.payType){case 0:sumPay();break;case 1:aliPay();break;case 2:wechatPay();break;default:tea.toast("fail","请选支付方式")}else tea.toast("fail","支付之前<br/>请先同意协议")}function getSum(a){api.showProgress({style:"default",animationType:"fade",title:"努力加载中...",text:"请稍候...",modal:!0}),api.ajax({url:website+"getmyinfo.php",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{token:values.token}}},function(e,t){e&&(paycode=e.paycode,a(e.mymoney))})}function updateSum(a){dom.sum.innerHTML="(¥"+formatCurrency(a)+")";var e=$api.dom(dom.sumBox,".aui-radio"),t=$api.byId("tip");parseFloat(data.money)>parseFloat(a)?($api.addCls(dom.sumBox,"tea-opacity"),$api.addCls(e,"aui-hide"),$api.removeCls(t,"aui-hide"),$api.addCls(dom.radios[1],"aui-checked"),values.payType=1):($api.removeCls(dom.sumBox,"tea-opacity"),$api.removeCls(e,"aui-hide"),$api.addCls(t,"aui-hide"),$api.addCls(dom.radios[0],"aui-checked")),api.hideProgress()}function aliPay(){showp("数据处理中...","请稍候"),api.ajax({url:website+"alipay_temp.php?action=add",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:values}},function(a,e){if(a&&(api.hideProgress(),"1"==a.succ)){var t=api.require("aliPay"),i=data.title,n=data.title,o=data.money;data.result_m&&(o=data.result_m);var s=website+"aliPay_notifyURL.php";t.config({partner:"2088421213998519",seller:"junma@jmwlw.com",rsaPriKey:"MIICeAIBADANBgkqhkiG9w0BAQEFAASCAmIwggJeAgEAAoGBAL+iN9gS/pC2DcP9tME5VkuR9ssd0FEteGN3VJUpF0C6PG/QgV3fmlDGaS6Iah/nqV7PdC0Iob6dkHwIhE/LPotmGFoBqL33OW+6ArkxV9epKn3oSxwU1YnWG21VZJCw0oa3hnM15EDRYpUIMnUBFg7I2KHxi7erQ6tbZxgyVvLLAgMBAAECgYEAkyioR7a2ZDxZr9MpNmSofxnU8j+v1Fbdp0xg2LaYU61wcdElNwhaAYOMDB7XmC6XIuaeaWLCipWG+ai0qm4CVUWIIY74Mf4LefxYFhruAoVi/lInc2w07Tq7XZABwe6ZDb3XbwCcXUrIxn+ZxsSRfo8LL+I2w2Jx+caY8Cu7lqkCQQD5FGIikoE0XiSS6HDT6k2+orCkQkTOOMRKhaiWUkF4gxLqCpQFWKmwaxuEJ+VYlMI+9EZitdJQMWuerV51ayA1AkEAxPU93+GzpvLLSyWafC6DBtSXtj42jAd9NWR0zSexw3AKlDylAJSikrsrhiqGOcVJoFS1bFgc/QAhABCrTbIm/wJBAKepy+E/ww9QK8hkBMbxWkHv233GSfCTD7amP/RoDEAl4w597mOm6hqiDpSoEl7NS+/6mIKLp7VpfusCAqqBYN0CQQCR7ZZ7g3GlN2zyb5kHezqvW+JQL8YgeAgIADceLdPilufvrwMd7AKMLstvq6Apu4fyl/CXpq1LssXAk5koht+nAkBb++/Q5YGD86C6tkinSQqWqxTAJkc0OC9q7wWGf9jf/Nqf55mIqpYmJQkHn5fmcgK4lc6iY5VT96/XkmznXoxu",rsaPubKey:"MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC/ojfYEv6Qtg3D/bTBOVZLkfbLHdBRLXhjd1SVKRdAujxv0IFd35pQxmkuiGof56lez3QtCKG+nZB8CIRPyz6LZhhaAai99zlvugK5MVfXqSp96EscFNWJ1httVWSQsNKGt4ZzNeRA0WKVCDJ1ARYOyNih8Yu3q0OrW2cYMlbyywIDAQAB",notifyURL:s},function(a,e){e&&api.alert({title:"发生错误",msg:e.code,buttons:["确定"]})}),t.pay({subject:i,body:n,amount:o,tradeNO:values.orderid},function(a,e){"9000"==a.code&&openWinSuccess(a)})}})}function curDateTime(){var a=new Date,e=a.getFullYear()+"",t=a.getMonth()+1,i=a.getDate(),n=(a.getDay(),a.getHours()),o=a.getMinutes(),s=a.getSeconds(),r=e;return t>9?r+=t:r=r+"0"+t,i>9?r+=i:r=r+"0"+i,n>9?r+=n:r=r+"0"+n,o>9?r+=o:r=r+"0"+o,s>9?r+=s:r=r+"0"+s,r}function RndNum(a){for(var e="",t=0;t<a;t++)e+=Math.floor(10*Math.random());return e}function wechatPay(){var a=$api.jsonToStr(values),e=$api.strToJson(a);e.paymoney=100*values.paymoney,data.result_m&&(e.paymoney=100*parseFloat(data.result_m)),showp("数据处理中...","请梢候"),api.ajax({url:website+"wxpay_temp.php?action=getord",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:e}},function(a,e){if(a&&"1"==a.succ){api.hideProgress();var t=a.data;api.require("wxPay").payOrder({apiKey:t.appid,orderId:t.prepayid,mchId:t.partnerid,nonceStr:t.noncestr,timeStamp:t.timestamp,package:t.package,sign:t.sign},function(a,e){a.status&&openWinSuccess(a)})}})}function sumPay(){var a="";switch(paycode){case 0:a="setpaycode1_win";break;case 1:a="paycode_win";break;default:return void tea.toast("fail","发起支付未成功<br/>请返回重试")}api.openWin({name:a,url:"./"+a+".html",pageParam:{name:"test"}})}function formatCurrency(a){a=a.toString().replace(/\$|\,/g,""),isNaN(a)&&(a="0"),sign=a==(a=Math.abs(a)),a=Math.floor(100*a+.50000000001),cents=a%100,a=Math.floor(a/100).toString(),cents<10&&(cents="0"+cents);for(var e=0;e<Math.floor((a.length-(1+e))/3);e++)a=a.substring(0,a.length-(4*e+3))+","+a.substring(a.length-(4*e+3));return(sign?"":"-")+a+"."+cents}function sendsms(a,e,t){api.ajax({url:website+"sendsmspay.php",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{templateId:a,param:e,telphone:t}}},function(a,e){})}function openWinSuccess(){var a,e="支付成功";switch(data.type){case"addvip":sendsms("22209",values.carnum,values.tel),a={0:["您选择的车辆已经成功加入VIP"],1:[]};break;case"recharge":e="充值成功",a={0:["充值成功，您已经成功充值"+data.money+"元"]};break;case"phoneRecharge":e="充值成功",a={0:["充值订单已提交，等候充值中..."]};break;case"reward":return api.sendEvent({name:"rewardSuccess",extra:{msg:values.msg,tzid:values.tzid,targetID:values.targetID,paymoney:formatCurrency(values.paymoney),targetname:values.targetname}}),void api.closeToWin({name:"main_win"});case"redpacket":return api.sendEvent({name:"redpacketSuccess",extra:{}}),void api.closeToWin({name:"main_win"});case"etc":e="支付成功",a={0:["小马哥工作人员将会联系您","请保持手机通畅并提供以下手续"],1:["个人车辆","身份证、行驶证"],2:["单位车辆","营业执照副本、委托书","经办人身份证、行驶证"]};break;case"oil":e="充值成功",a={0:["小马哥工作人员将会联系您","请保持电话畅通"]};break;default:e="支付成功"}api.openWin({name:"success_win",url:"../unit/success_win.html",bounces:!1,pageParam:{title:"支付成功页",result:e,data:a}})}apiready=function(){initDOM(),initVar(),initHTML(),initEventListener(),initModule(),getData()};var dom={},data={},values={},paycode=null</script> </html>