<!DOCTYPE html> <html> <head> <meta charset=utf-8> <meta name=viewport content="maximum-scale=1,minimum-scale=1,user-scalable=0,width=device-width,initial-scale=1"/> <meta name=format-detection content="telephone=no,email=no,date=no,aItemress=no"> <title></title> <link rel=stylesheet type=text/css href=../../css/api.css /> <link rel=stylesheet type=text/css href=../../css/aui.css /> <link rel=stylesheet type=text/css href=../../css/aui-skin.css /> <link rel=stylesheet type=text/css href=../../css/tea.css /> <style type=text/css>body,html{width:100%;height:100%;overflow:auto}input::-webkit-input-placeholder,textarea::-webkit-input-placeholder{color:#ccc}input:-moz-placeholder,textarea:-moz-placeholder{color:#ccc}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#ccc}.select-round{width:1rem;height:1rem;border:1px solid #09f;border-radius:50%;font-size:.5rem;line-height:1rem;color:#09f;text-align:center;display:table}.vip:after{content:'VIP';font-size:.6rem;color:#fc6;text-align:center;line-height:.7rem;position:absolute;left:50%;top:30%;width:1.25rem;height:.7rem;background-image:linear-gradient(-45deg,rgba(0,0,0,1) 0,rgba(51,51,51,1) 100%),linear-gradient(rgba(255,153,51,1),rgba(255,153,51,1));background-blend-mode:normal,normal;border-radius:8px 8px 8px 8px}</style> </head> <body> <div id=app v-cloak> <div class=aui-bar-btn> <ul class="aui-list aui-media-list aui-list-noborder"> <li class="aui-list-item aui-padded-0"> <div class=aui-media-list-item-inner> <div class="aui-list-item-inner aui-padded-l-15"> <div class=aui-list-item-text> <div class="aui-list-item-title tea-text-blue aui-font-size-14" style=z-index:999>车牌号码</div> </div> <div class=aui-info style=padding:0> <div class=aui-list-item-label style=width:4rem;line-height:normal tapmode @click="goto('province')"> <span class="tea-text-title aui-font-size-16 tea-text-star-red tea-text-arrow-down">{{ province }}</span> </div> <div class="aui-list-item-input aui-font-size-16"> <input type=text placeholder=请输入车牌后5位数 v-model=number> </div> <div class="tea-text-round tea-big" tapmode @click="goto('plate')" style=padding-left:3px;font-size:.55rem>选</div> </div> </div> </div> </li> <li class="aui-list-item aui-padded-0 aui-list-item-arrow" tapmode @click="goto('date')"> <div class=aui-media-list-item-inner> <div class="aui-list-item-inner aui-padded-l-15"> <div class="aui-list-item-text aui-margin-b-5"> <div class="aui-list-item-title tea-text-blue aui-font-size-14">预约时间</div> </div> <div class=aui-info style=padding:0> <div class="aui-font-size-16 tea-text-title">{{ time }}</div> </div> </div> </div> </li> <li class="aui-list-item aui-padded-0 aui-list-item-arrow" tapmode @click="goto('address')"> <div class=aui-media-list-item-inner> <div class="aui-list-item-inner aui-padded-l-15"> <div class="aui-list-item-text aui-margin-b-5"> <div class="aui-list-item-title tea-text-blue aui-font-size-14">地址<span class=tea-text-light-gray>(上门服务限 北海市区与合浦县城)</span></div> </div> <div class=aui-list-item-text> <div v-if=address class="aui-font-size-16 tea-text-title">{{ address.name }} {{ address.tel.replace(/^(\d{3})(\d{4})(\d{4})$/, "$1 $2 $3") }}</div> <div v-else class="aui-font-size-16 tea-text-light-gray">请添加新地址</div> </div> <div v-if=address class=aui-info style=padding:0> <div class="aui-font-size-16 tea-text-title aui-ellipsis-2">{{ address.region+' '+address.detail }}</div> </div> </div> </div> </li> </ul> </div> <p class="tea-text-orange aui-font-size-14 aui-padded-15">总费用¥60上门收取（特权卡VIP免费）</p> <footer style="margin:0 2rem" tapmode @click=submitOrder> <div id=pay-btn class="aui-btn aui-btn-block aui-text-white tea-btn-radius" :class="errorMsg ? 'tea-bg-light-blue' : 'tea-bg-blue' ">提交订单</div> </footer> </div> </body> <script src=../../script/api.js></script> <script src=../../script/conn.js></script> <script src=../../script/fastclick.min.js></script> <script src=../../script/vue.min.js></script> <script src=../../script/tea.js></script> <script type=text/template id=template> </script> <script>function init(){dom={},vm=new Vue({el:"#app",data:{province:"桂E",number:"",time:"2017-01-10 10点",address:"",index:0},methods:{goto:function(e){switch(e){case"province":openWinPlateProvince();break;case"plate":openWinPlateNum();break;case"date":openWinDateSelect();break;case"address":openWinAddress(vm.address.addrid)}},submitOrder:function(){this.errorMsg?api.toast({msg:this.errorMsg,duration:2e3,location:"middle"}):saveOrder()}},computed:{errorMsg:function(){var e=new tea.checkRule;return e.add(this.number,[{condition:"isNoEmpty",errorMsg:"请输入车牌号码"}]),e.add(this.time,[{condition:"isNoEmpty",errorMsg:"请选择预约时间"}]),e.add(this.tel,[{condition:"isNoEmpty",errorMsg:"请选择联系方式和地址"}]),e.start()}},watch:{}}),getData(),initModule(),initEventListener()}function initModule(){}function initEventListener(){api.addEventListener({name:"selectPlateProvince"},function(e,a){vm.province=e.value.province+e.value.city}),api.addEventListener({name:"addOldCar"},function(e,a){vm.province=e.value.car.slice(0,2),vm.number=e.value.car.slice(2),vm.tel=e.value.tel}),api.addEventListener({name:"selectretime"},function(e,a){vm.time=e.value.strtime}),api.addEventListener({name:"selectAddress"},function(e,a){vm.address=e.value.address,vm.add=e.value.index}),api.addEventListener({name:"saveOk"},function(e,a){getData()}),api.addEventListener({name:"editorOk"},function(e,a){getAddressDetail(e.value.addrid)})}function getData(){tea.showp("数据加载中..."),api.ajax({url:website+"exempt_api.php?action=index",method:"post",timeout:30,data:{values:{ID:$api.getStorage("ID")}}},function(e,a){return api.hideProgress(),e?"1"==e.succ?(vm.time=e.data.booktime,vm.province=e.data.carnum.slice(0,2),vm.number=e.data.carnum.slice(2),vm.address=e.data.address,!0):void 0:(tea.toast("ajax"),!1)})}function openWinPlateProvince(){event.stopPropagation(),api.openWin({name:"plate_province_win",url:"../car_plate/plate_province_win.html"})}function openWinPlateNum(){api.openWin({name:"plate_num_win",url:"../car_plate/plate_num_win.html"})}function openWinDateSelect(){api.openWin({name:"date_select_win",url:"../unit/date_select_win.html",pageParam:{winName:"newcar_check_partOne_win"}})}function openWinAddress(e){api.openWin({name:"address_list_win",url:"../address/address_list_win.html",pageParam:{addrid:e,origin:api.winName}})}function openWinPay(){}function getAddressDetail(e){tea.showp("加载中..."),api.ajax({url:website+"exempt_api.php?action=addrinfo",method:"post",timeout:30,data:{values:{ID:$api.getStorage("ID"),addrid:e}}},function(e,a){api.hideProgress(),"1"==e.succ&&(vm.address=e.data)})}function checkcarnum(e){api.ajax({url:website+"api.php?action=checkcarnum",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{userid:$api.getStorage("ID"),carnum:vm.province+vm.number,car_type:values.carColor,telphone:vm.address.tel}}},function(e,a){})}function saveOrder(){tea.showp("提交订单中...","请稍候",!0),api.ajax({url:website+"exempt_api.php?action=save",method:"post",timeout:30,data:{values:{ID:$api.getStorage("ID"),carnum:vm.province+vm.number,booktime:vm.time,addrid:vm.address.addrid}}},function(e,a){if(api.hideProgress(),!e)return tea.toast("ajax"),!1;"1"==e.succ&&(0==e.data.money?toSuccess():toPay({payid:e.data.payid,paymoney:e.data.money,mtype:e.data.mtype})),api.toast({msg:e.msg,duration:2e3,location:"middle"})})}function toPay(e){api.openWin({name:"pay_win",url:"../pay/pay_win.html",pageParam:{title:"支付六年免检",money:e.paymoney,type:"exempt",values:e},vScrollBarEnabled:!1})}function toSuccess(){api.openWin({name:"success_win",url:"../unit/success_win.html",bounces:!1,pageParam:{title:"提交成功页",result:"提交成功",data:{0:["由于您需要办理的车辆已经加入VIP","您无需缴纳任何费用"],1:["小马哥工作人员将会联系您","请保持手机通畅..."]}}})}var dom={},vm=null;apiready=function(){init()}</script> </html>