<!DOCTYPE html> <html> <head> <meta charset=utf-8> <meta name=viewport content="maximum-scale=1,minimum-scale=1,user-scalable=0,width=device-width,initial-scale=1"/> <title></title> <link rel=stylesheet type=text/css href=../../css/aui.css /> <link rel=stylesheet type=text/css href=../../css/common.css /> </head> <style type=text/css>.ac{display:inline}.ac .m{font-size:38px;color:#ed4040}.ac .y{color:#999}.bu{color:#03f;margin-top:10px}.su{padding-bottom:10px}.aui-user-view-cell .aui-img-object{max-width:38px!important;height:38px!important;line-height:38px!important;border-radius:50%;margin-top:3px}.aui-user-view-cell .aui-img-body span{color:#333;margin-top:0;font-weight:400;font-size:18px;width:100%}.aui-user-view-cell .aui-img-body span>em{font-weight:400;font-size:15px;color:#8f8f94;float:right}.aui-user-view-cell{position:relative;padding:10px 7px 10px 7px;overflow:hidden}.aui-user-view-cell p{margin-top:0;margin-bottom:0;font-size:13px}.pmsg{color:#136ce5}.ly{color:#136ce5;font-size:18px}</style> <body> <div class="aui-content aui-text-center"> <p class=aui-padded-10 id=msg></p> <img class="aui-img-object aui-img" id=sendlogo src=../../image/nologo.png style=width:68px;height:68px;border-radius:80%> <div class=aui-img-body style=padding-bottom:10px> <span id=sendname></span> </div> <div class=aui-btn-row> <div class="aui-btn aui-btn-block aui-btn-danger" id=bottom onclick=postdate()>领取这个红包</div> </div> </div> <p class="aui-text-center su" id=su></p> <div class=aui-content id=hongbaolist></div> </body> <script src=../../script/api.js></script> <script src=../../script/conn.js></script> <script src=../../script/emo.js></script> <script src=../../script/tea.js></script> <script>function loaddate(){var a=api.pageParam.hongbaoID,e=$api.getStorage("nickname"),o=$api.getStorage("ID");showp("数据加载中...","请稍候..."),api.ajax({url:website+"hongbao.php?action=seequnhongbaoinfo",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{hongbaoID:a,userid:o,deviceId:deviceId,deviceModel:deviceModel}}},function(a,i){if(a){if(!a.errmsg){var t="1"==a.hongbaotype?"拼运气抢红包":"普通红包";$api.html($api.byId("msg"),a.msg);var n=a.sendname==e?"我":a.sendname;if($api.html($api.byId("sendname"),n+"发的"+t),$api.byId("sendlogo").src=a.sendlogo,"1"==a.succ){s=$api.byId("bottom");$api.removeCls(s,"aui-btn-danger"),$api.html(s,"您已经领过这个红包"),$api.removeAttr(s,"onclick"),qunhongbaolist()}if("-1"==a.succ){s=$api.byId("bottom");$api.removeCls(s,"aui-btn-danger"),$api.html(s,"和红包擦肩而过，下次努力..."),$api.removeAttr(s,"onclick"),qunhongbaolist()}if("nocount"==a.succ){var s=$api.byId("bottom");$api.removeCls(s,"aui-btn-danger"),$api.html(s,"来迟了，这个红包已经被抢光"),$api.removeAttr(s,"onclick"),qunhongbaolist()}a.sendID==o&&"0"!=a.succ&&"nocount"!=a.succ&&qunhongbaolist(),api.hideProgress()}}else api.hideProgress(),api.alert({msg:"错误码："+i.code+"；错误信息："+i.msg+"网络状态码："+i.statusCode})})}function postdate(){var a=api.pageParam.hongbaoID,e=$api.getStorage("ID"),o=$api.getStorage("nickname");if(""==a||void 0==a||""==e||void 0==e||""==o||void 0==o)return api.alert({msg:"数据异常，无法领取红包，或请尝试重新登陆"}),!1;api.ajax({url:website+"hongbao.php?action=lingqunhongbao",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{hongbaoID:a,userid:e,nickname:o,deviceId:deviceId,deviceModel:deviceModel}}},function(a,e){if(a){if(1==a.succ){var o=$api.byId("bottom");$api.removeCls(o,"aui-btn-danger"),$api.html(o,"<p>领到了"+a.hbmoney+'元</p><p class="pmsg" id="pmsg" tapmode onclick="showinput()">留言</p>'),$api.removeAttr(o,"onclick"),qunhongbaolist()}}else api.alert({msg:"错误码："+e.code+"；错误信息："+e.msg+"网络状态码："+e.statusCode})})}function qunhongbaolist(){showp("数据加载中...","请稍候...");var a=api.pageParam.hongbaoID,e=$api.getStorage("ID");api.ajax({url:website+"hongbao.php?action=lingqunhongbaolist",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{hongbaoID:a,deviceId:deviceId,deviceModel:deviceModel,userid:e}}},function(a,o){var i=$api.byId("hongbaolist");qunhongbaosu(),html="",html+="<ul>";for(var t=0,n=a.length;t<n;t++){var s=a[t];html+='<div class="aui-user-view-cell aui-img"><img class="aui-img-object aui-pull-left" src="'+s.img+'"><div class="aui-img-body">',html+="<span>"+s.username+"<em>"+s.moneyval+"元</em></span>",s.msg&&""!=s.msg?html+="<p>"+_transEmo(s.msg)+"</p>":s.userid==e&&(html+='<p class="ly" tapmode onclick="showinput()">留言</p>'),html+="<p>"+s.addtime+"</p>",html+="</div></div>"}html+="</ul>",$api.html(i,html),api.hideProgress()})}function qunhongbaosu(){showp("数据加载中...","请稍候...");var a=api.pageParam.hongbaoID;api.ajax({url:website+"hongbao.php?action=qunhongbaosu",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{hongbaoID:a}}},function(a,e){if(a){var o=$api.byId("su"),i="红包领取纪录("+a.m+"元,共"+a.hongbaocount+"个/剩"+a.hongbaocountsu+"个)";$api.html(o,i),api.hideProgress()}})}function showinput(){UIChatBox.open({placeholder:"",maxRows:4,emotionPath:"widget://image/emotion",styles:{inputBar:{borderColor:"#d9d9d9",bgColor:"#f2f2f2"},inputBox:{borderColor:"#B3B3B3",bgColor:"#FFFFFF"},indicator:{target:"both",color:"#c4c4c4",activeColor:"#9e9e9e"}}},function(a){if("send"==a.eventType){var e=api.pageParam.hongbaoID,o=$api.getStorage("ID"),i=a.msg;if(!i)return api.alert({msg:"不能发送为空的内容"}),!1;if(i.length>50)return api.alert({msg:"字数不能超过50"}),!1;api.ajax({url:website+"hongbao.php?action=savequnhongbaomsg",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{msg:i,id:e,userid:o}}},function(a,e){a&&($api.remove($api.byId("pmsg")),UIChatBox.close(),qunhongbaolist(),api.toast({msg:"发表成功"}))})}})}var UIChatBox=null,deviceId=null,deviceModel=null;apiready=function(){deviceId=api.deviceId,deviceModel=api.deviceModel,UIChatBox=api.require("UIChatBox"),api.parseTapmode(),loaddate(),api.addEventListener({name:"tap"},function(){UIChatBox.close()})}</script> </html>