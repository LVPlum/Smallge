<!DOCTYPE html> <html> <head> <meta charset=utf-8> <meta name=viewport content="maximum-scale=1,minimum-scale=1,user-scalable=0,width=device-width,initial-scale=1"/> <meta name=format-detection content="telephone=no,email=no,date=no,aItemress=no"> <title>title</title> <link rel=stylesheet type=text/css href=../../css/api.css /> <link rel=stylesheet type=text/css href=../../css/aui.css /> <link rel=stylesheet type=text/css href=../../css/aui-skin.css /> <link rel=stylesheet type=text/css href=../../css/tea.css /> <style type=text/css>body,html{overflow:auto;background:0 0;text-align:center;width:100%;height:100%;text-align:center;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center;-webkit-flex-direction:column;flex-direction:column}section{width:15rem;height:auto;background-color:#fff}.list-height{height:2.75rem;line-height:2.75rem}.aui-list-item-label{width:45%!important}.aui-icon-close:before{padding:.1rem;height:1rem;border:1px solid #999;border-radius:50%}</style> </head> <body tapmode ontouchend='tea.closeFrame(event,"section")'> <section id=section class="tea-content-radius-10 aui-padded-l-15 aui-padded-r-15"> <header id=header class="aui-bar aui-bar-nav aui-bar-light"> <div class=tea-text-title style=width:100%>拍照上传</div> </header> <ul class="aui-list aui-media-list"> <li class="aui-list-item aui-padded-r-15"> <div class=aui-info style=padding-bottom:0 tapmode onclick=openWinMediaScanner()> <div id=title class="aui-info-item aui-font-size-16 tea-text-title"> 上传行驶证照片 </div> <div class="aui-info-item tea-big"> <i id=camera class="aui-iconfont aui-font-size-18 aui-icon-camera tea-text-blue"></i> </div> </div> <div class=aui-media-list-item-inner> <div class=aui-list-item-media> <img id=pic src=../../image/lisence.png style=width:3.75rem;height:2.5rem tapmode onclick=event.stopPropagation(),openBigImg(this)> </div> <div class=aui-list-item-inner> <div class=aui-list-item-text style=line-height:2.5rem> <span id=tip class="">样板</span> <i id=close class="aui-iconfont aui-font-size-14 aui-icon-close aui-hide tea-big" tapmode onclick=event.stopPropagation(),delImg()></i> </div> </div> </div> </li> </ul> <ul class="aui-list aui-form-list"> <li class="aui-list-item list-height"> <div class=aui-list-item-inner> <div class=aui-list-item-label> 手机号码 </div> <div class=aui-list-item-input> <input id=telphone type=tel placeholder=请输入手机号码 tapmode oninput=input(this)> </div> </div> </li> </ul> <footer id=footer> <div class="aui-content list-height"> <ul class="aui-list aui-list-noborder aui-form-list aui-padded-r-15"> <li class="aui-list-item aui-row"> <div class="aui-col-xs-6 aui-border-r" tapmode onclick=hideFrame()> 取消 </div> <div class="aui-col-xs-6 tea-text-blue" tapmode onclick=openWinInsurePrice()> 下一步 </div> </li> </ul> </div> </footer> </section> </body> <script src=../../script/api.js></script> <script src=../../script/tea.js></script> <script src=../../script/conn.js></script> <script src=../../script/doT.min.js></script> <script type=text/template id=template></script> <script>function initDOM(){dom.title=$api.byId("title"),dom.tip=$api.byId("tip"),dom.pic=$api.byId("pic"),dom.telphone=$api.byId("telphone"),dom.close=$api.byId("close"),dom.camera=$api.byId("camera")}function initVar(){(values=api.pageParam.values).telphone=tea.getStorage("telphone"),values.imgLocal=null,values.img=null,order=api.pageParam.order,"undefined"!=typeof order&&updateVar()}function initHTML(){$api.val(dom.telphone,values.telphone);var e=values.imgLocal;!1===values.lisence?(dom.title.innerHTML="请上传车辆发票",null===e&&(e="../../image/ticket.png"),$api.attr(dom.pic,"src",e)):(dom.title.innerHTML="上传行驶证照片",null===e&&(e="../../image/lisence.png"),$api.attr(dom.pic,"src",e))}function initEventListener(){api.addEventListener({name:"getimgarr"},function(e,i){values.imgLocal=e.value.img,$api.attr(dom.pic,"src",values.imgLocal),$api.addCls(dom.tip,"aui-hide"),$api.removeCls(dom.close,"aui-hide"),$api.addCls(dom.camera,"tea-text-default")})}function initModule(){imageFilter=api.require("imageFilter"),imageBrowser=api.require("imageBrowser")}function getData(){}function updateDOM(){}function updateVar(){order.img&&(values.img=order.img,values.imgLocal=website+"carrexsz_img/"+order.img)}function updateHTML(){}function sendEvent(){}function hideFrame(){api.setFrameAttr({hidden:!0})}function openWinInsurePrice(){check()&&(api.showProgress({style:"default",animationType:"fade",title:"图片上传中...",text:"请稍候...",modal:!1}),imgCompress(values.imgLocal,.8,.8,getExt(values.imgLocal),function(e){uploadFile(e,function(e){values.img=e,api.hideProgress(),api.openWin({name:"insure_price_win",url:"./insure_price_win.html",pageParam:{values:values,order:order}})})}))}function input(e){values.telphone=$api.val(e),$api.val(dom.telphone,values.telphone)}function openWinMediaScanner(){api.openWin({name:"media1_win",url:"../unit/media1_win.html",pageParam:{limit:1,imgId:1}})}function openBigImg(e){var i=$api.attr(e,"src");if(null===values.imgLocal){var a=i.split("/");i=a[a.length-1],i=website+"image/big-"+i}imageBrowser.openImages({showList:!1,imageUrls:[i]})}function delImg(){values.imgLocal=null,$api.removeCls(dom.tip,"aui-hide"),$api.addCls(dom.close,"aui-hide"),$api.removeCls(dom.camera,"tea-text-default"),values.lisence?$api.attr(dom.pic,"src","../../image/lisence.png"):$api.attr(dom.pic,"src","../../image/ticket.png")}function uploadFile(e,i){api.ajax({url:website+"upcarrexsz.php",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{files:{upfile:e}}},function(e,a){e&&i(e.path)})}function imgCompress(e,i,a,t,n){var o=api.cacheDir+"/"+getNowFormatDate()+"/",l=NewGuid()+"."+t;imageFilter.compress({img:e,quality:i,scale:i,save:{album:!1,imgPath:o,imgName:l}},function(e,i){e?n(o+l):alert(JSON.stringify(i))})}function NewGuid(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function getNowFormatDate(){var e=new Date,i=e.getFullYear(),a=e.getMonth()+1,t=e.getDate();return a>=1&&a<=9&&(a="0"+a),t>=0&&t<=9&&(t="0"+t),i+"-"+a+"-"+t}function getExt(e){return e.substring(e.lastIndexOf(".")+1)}function check(){return null===values.imgLocal?(api.toast({msg:"请先上传图片~",duration:2e3,location:"middle"}),!1):(values.telphone=tea.toNum(values.telphone),!!tea.checkPhone(values.telphone)||(api.toast({msg:"请输入格式正确的11位手机号码",duration:2e3,location:"middle"}),!1))}apiready=function(){initDOM(),initVar(),initHTML(),initEventListener(),initModule(),getData()};var dom={},data={},values={},imageFilter=null,imageBrowser=null</script> </html>