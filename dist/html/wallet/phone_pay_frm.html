<!DOCTYPE html> <html> <head> <meta charset=utf-8> <meta name=viewport content="maximum-scale=1,minimum-scale=1,user-scalable=0,width=device-width,initial-scale=1"/> <meta name=format-detection content="telephone=no,email=no,date=no,aItemress=no"> <title>手机充值</title> <link rel=stylesheet type=text/css href=../../css/api.css /> <link rel=stylesheet type=text/css href=../../css/aui.css /> <link rel=stylesheet type=text/css href=../../css/aui-skin.css /> <link rel=stylesheet type=text/css href=../../css/tea.css /> <style type=text/css>body,html{height:100%;overflow:auto}body,html{background-color:#fff;color:#333}input::-webkit-input-placeholder{color:#ccc}input:-moz-placeholder{color:#ccc}input::-moz-placeholder{color:#ccc}input:-ms-input-placeholder{color:#ccc}.aui-col-xs-4{display:table}.money-type{width:100%;height:3.15rem;text-align:center;color:#999;border:1px solid #999;border-radius:.25rem;display:table-cell;vertical-align:middle}.active-money-type{color:#39f;border:1px solid #39f}.btn{width:15rem;margin:0 auto;border-radius:99px;opacity:.5}.active-btn{opacity:1}.select_nomey{background-color:#39f;color:#fff;border:none}.coupon-active{font-size:.8rem!important;color:#f60!important}</style> </head> <body> <div class="aui-content aui-margin-t-15"> <div class="aui-list aui-form-list aui-padded-t-10 aui-list-noborder"> <div class="aui-list-item-inner aui-padded-l-15"> <div class=aui-list-item-input> <input id=phone-val type=tel maxlength=11 placeholder=请输入手机号码 style=font-size:1.5rem;color:#333 tapmode oninput=isNumber(this)> </div> <div class="aui-list-item-label aui-iconfont tea-icon-contacts aui-margin-r-15" style=width:auto;font-size:1.3rem;color:#39f tapmode onclick=historyPaynum()></div> </div> <div id=operator class="aui-list-header aui-padded-b-15 aui-font-size-14 aui-border-b" style=background-color:#fff;color:#ccc> </div> </div> </div> <div class="aui-content aui-margin-b-15"> <div class=aui-card-list-content-padded> <div class=aui-list-item-inner> <div class="aui-list-item-title aui-margin-b-10 aui-margin-t-15" style=color:#333>充话费</div> <div id=pay-ytpe-content class="aui-row aui-row-padded"> </div> </div> </div> <ul class="aui-list aui-list-in aui-form-list aui-border-b"> <li class="aui-list-item aui-list-item-arrow" style=margin-right:.75rem> <div class=aui-list-item-inner tapmode onclick=openCouponLists()> <div class=aui-list-item-label style=width:4rem> <span class=tea-text-title>现金券</span> </div> <div id=coupon class="aui-font-size-14 tea-text-gray">暂无可用现金券</div> </div> </li> </ul> <div id=pay-hint class="aui-list-item-title aui-margin-b-10 aui-margin-t-15" style=text-align:center;color:#39f></div> <div id=btn class="aui-btn aui-btn-info aui-btn-block aui-btn-sm btn" tapmode onclick=submit()>确定充值，去支付</div> <div class="aui-content-padded aui-padded-t-15"> <p>因充值平台业务量较大，有时会有充值失败的情况出现，尤其在月初。如遇充值失败，充值金额会原路退回，请隔一段时间后再重试充值。</p> </div> </div> </body> <script src=../../script/api.js></script> <script src=../../script/tea.js></script> <script src=../../script/conn.js></script> <script src=../../script/doT.min.js></script> <script src=../../script/zepto.min.js></script> <script type=text/template id=template></script> <script>function init(a){if("1"==a){showp("数据载入中","");var e=trim($api.val($api.byId("phone-val")));api.ajax({url:website+"cz.php?action=cztypelist",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{cztype:a,cztel:e}}},function(a,e){if(a)if("1"==a.succ){$api.byId("pay-ytpe-content");for(var t="",i=0,o=a.content.length;i<o;i++){var s=a.content[i];1==s.isuse?(t+='<div class="aui-col-xs-4" data-id= "'+s.ID+'" ><div class="money-type active-money-type" data-id="'+s.ID+'" data-price = "'+s.price+'" data-cost = "'+s.m+'" tapmode onclick="select_nomey(this)"><div class="aui-font-size-16 ">'+s.price+'</div><div class="aui-font-size-12 ">售价：'+s.m+"元</div></div></div>",api.parseTapmode()):0==s.isuse&&(t+='<div class="aui-col-xs-4" data-id= "'+s.ID+'" ><div class="money-type"><div class="aui-font-size-16 ">'+s.price+'</div><div class="aui-font-size-12 ">无货</div></div></div>')}$api.html($api.byId("operator"),"所属运营商："+a.yysstr),$api.html($api.byId("pay-ytpe-content"),t),$api.addCls($api.byId("btn"),"active-btn")}else api.toast({msg:a.msg});api.hideProgress()})}else{$api.html($api.byId("pay-ytpe-content"),'<div class="aui-col-xs-4"><div class="money-type"><div class="aui-font-size-16 ">10元</div></div></div><div class="aui-col-xs-4"><div class="money-type"><div class="aui-font-size-16" >20元</div></div></div><div class="aui-col-xs-4"><div class="money-type"><div class="aui-font-size-16">30元</div></div></div><div class="aui-col-xs-4"><div class="money-type"><div class="aui-font-size-16">40元</div></div></div><div class="aui-col-xs-4"><div class="money-type"> <div class="aui-font-size-16">50元</div></div></div><div class="aui-col-xs-4"><div class="money-type"><div class="aui-font-size-16" >100元</div></div></div>'),$api.html($api.byId("operator"),""),$api.html($api.byId("pay-hint"),""),$api.removeCls($api.byId("btn"),"active-btn")}}function isNumber(a){a.value=a.value.replace(/[^\d]/g,""),init(a.value.length>=11?"1":"0")}function listmytel(){showp("号码载入中",""),api.ajax({url:website+"cz.php?action=lasttel",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{userid:$api.getStorage("ID")}}},function(a,e){a&&(null!=a.tel?$api.val($api.byId("phone-val"),formattel(a.tel)):$api.val($api.byId("phone-val"),formattel($api.getStorage("telphone"))),checkinput($api.val($api.byId("phone-val")))),api.hideProgress()})}function checkinput(a){var e=trim(a);init(e.length>=11?1:0),$api.val($api.byId("phone-val"),formattel(e))}function trim(a){var e;return e=a.replace(/(^\s+)|(\s+$)/g,""),e=e.replace(/\s/g,"")}function select_nomey(a){if(a){$(a).addClass("select_nomey").parent().siblings().find(".money-type").removeClass("select_nomey");var e=$(a).attr("data-cost"),t=$(a).attr("data-price"),i=$(a).attr("data-id");if(Number(t.replace("元",""))>=Number(values.except_money)){data.isUse=!0,updateHTML();s=parseFloat(e)-parseFloat(values.coupon_m)}else{data.isUse=!1,updateHTML();s=parseFloat(e)}$("#pay-hint").html("充值"+t+"，支付<span id='cost' data-id ="+i+" >"+s.toFixed(2)+"元</span>")}else{var o=$(".select_nomey"),e=o.attr("data-cost"),t=o.attr("data-price"),i=o.attr("data-id");if(t.replace("元","")>=values.except_money){data.isUse=!0,updateHTML();s=parseFloat(e)-parseFloat(values.coupon_m)}else{data.isUse=!1,updateHTML();var s=parseFloat(e)}$("#pay-hint").html("充值"+t+"，支付<span id='cost' data-id ="+i+" >"+s.toFixed(2)+"元</span>")}}function formattel(a){var e=/^(\d{3})(\d{4})(\d{4})$/.exec(a);return e[1]+" "+e[2]+" "+e[3]}function isVerifyPhoneNum(a){return/^1(3|4|5|7|8)\d{9}$/.test(a)}function submit(){var a=trim($api.val($api.byId("phone-val")));if(0===a.length)api.toast({msg:"请输入要充值的手机号码"});else if(isVerifyPhoneNum(a)){var e=$("#cost").html(),t=$("#cost").attr("data-id");e?openPaynum_win(a,e,t):api.toast({msg:"请选择要充值的项目"})}else api.toast({msg:"手机号码格式不对"})}function openPaynum_win(a,e,t){api.openWin({name:"pay_win",url:"../pay/pay_win.html",pageParam:{title:"支付充值费用("+a+")",money:parseFloat(e)+parseFloat(values.coupon_m),result_m:parseFloat(e),type:"phoneRecharge",values:{paymoney:e,czindex:t,cztel:a,mtype:"19",coupon_id:values.coupon_id,coupon_m:values.coupon_m}},vScrollBarEnabled:!1})}function historyPaynum(){_openWin("历史充值号码","./history_paynum_win.html")}function getCoupon(){api.ajax({url:website+"api_cj.php?action=my_coupon",method:"post",timeout:30,data:{values:{userid:$api.getStorage("ID"),state:"2"}}},function(a,e){if(!a)return tea.toast("ajax"),!1;if(a){if(a.length){a.sort(function(a,e){return parseFloat(a.coupon_m)>parseFloat(e.coupon_m)?1:-1});for(i in a)"hf"==a[i].coupon_type?data.result.unshift(a[i]):data.result.push(a[i]);"hf"==data.result[0].coupon_type&&(values.coupon_m=data.result[0].coupon_m,values.coupon_id=data.result[0].ID,values.except_money=data.result[0].except.except_money)}updateHTML()}})}function updateHTML(){var a=$api.byId("coupon");data.isUse&&0!=values.coupon_m?($api.text(a,"-¥"+values.coupon_m),$api.addCls(a,"coupon-active")):($api.text(a,"暂无可用现金券"),$api.removeCls(a,"coupon-active"))}function openCouponLists(){api.openWin({name:"coupon_list_win",url:"../unit/coupon_list_win.html",pageParam:{coupons:data.result,couponType:"hf",couponsIndex:data.couponsIndex}})}apiready=function(){api.parseTapmode(),init("0"),listmytel(),getCoupon(),api.addEventListener({name:"selectCoupon"},function(a){values.coupon_id=a.value.coupon.ID,values.coupon_m=a.value.coupon.coupon_m,values.except_money=a.value.coupon.except.except_money,data.couponsIndex=a.value.couponsIndex,updateHTML(),$(".select_nomey").length&&select_nomey()}),api.addEventListener({name:"selecttel"},function(a,e){if(a){if(!a.value.tel)return;$api.val($api.byId("phone-val"),a.value.tel),init("1")}})};var dom={},data={},values={};data={result:[],couponsIndex:0,isUse:!0},values={coupon_id:"",coupon_m:0,except_money:0}</script> </html>