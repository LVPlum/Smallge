<!DOCTYPE html> <html> <head> <meta charset=utf-8> <meta name=viewport content="maximum-scale=1,minimum-scale=1,user-scalable=0,width=device-width,initial-scale=1"/> <meta name=format-detection content="telephone=no,email=no,date=no,aItemress=no"> <title>购买VIP</title> <link rel=stylesheet type=text/css href=../../css/api.css /> <link rel=stylesheet type=text/css href=../../css/aui.css /> <link rel=stylesheet type=text/css href=../../css/aui-skin.css /> <link rel=stylesheet type=text/css href=../../css/tea.css /> <style type=text/css>body,html{height:100%;overflow:hidden;background:#fff}.aui-list-item-arrow.tea-blue:before{right:0;border-color:#39f}.aui-form-list .tea-list-item-select:after{right:0}.aui-list.aui-list-in .aui-list-item:last-child{background-position:.75rem bottom}.blue{background-color:#39f!important}.blue *{color:#fff!important}.yellow{background-color:#f90!important}.yellow *{color:#fff!important}.coupon-active{font-size:.8rem!important;color:#f60!important}.VIP-deal{width:100%;margin:0 .7rem;text-align:left;font-size:1.2rem;color:#39f}.VIP-icon{width:100%;text-align:left;font-size:.6rem;color:#39f;position:relative}.VIP-icon:before{content:' ';width:.6rem;height:.6rem;margin-right:.7rem;background:url(../../image/VIP_icons/te_bingo@2x.png) no-repeat;background-size:.6rem;display:inline-block}</style> </head> <body> <section class=aui-content> <ul class="aui-list aui-media-list aui-list-noborder"> <li class="aui-list-item tea-noactive"> <div class=aui-list-item-inner> <div class="aui-list-item-title project-title aui-margin-t-5 aui-margin-b-5"> <span class=u-title>请选择你的车型</span> </div> <div class="aui-row aui-row-padded"> <div class=aui-col-xs-6 tapmode onclick=selectCarColor(0)> <ul class="aui-list aui-media-list aui-list-noborder"> <li id=blue-btn class="aui-list-item tea-bg-default tea-border-radius-10 aui-padded-l-10"> <div class=aui-media-list-item-inner> <div class="aui-list-item-inner aui-padded-r-10 aui-padded-t-15 aui-padded-b-15"> <div class="aui-list-item-text aui-margin-b-5"> <div class="aui-list-item-title aui-font-size-14">蓝牌车</div> </div> <div class="aui-list-item-text aui-ellipsis-2 tea-font-size-11"> 蓝牌车,家用小轿车 </div> </div> </div> </li> </ul> </div> <div class="aui-col-xs-6 u-btn" tapmode onclick=selectCarColor(1)> <ul class="aui-list aui-media-list aui-list-noborder"> <li id=yellow-btn class="aui-list-item tea-bg-default tea-border-radius-10 aui-padded-l-10"> <div class=aui-media-list-item-inner> <div class="aui-list-item-inner aui-padded-r-10 aui-padded-t-15 aui-padded-b-15"> <div class="aui-list-item-text aui-margin-b-5"> <div class="aui-list-item-title aui-font-size-14"> 黄牌车<span class="tea-text-default tea-font-size-11">(含蓝牌运营车)</span> </div> </div> <div class="aui-list-item-text aui-ellipsis-2 tea-font-size-11"> 黄车牌,货车,运营车辆 </div> </div> </div> </li> </ul> </div> </div> </div> </li> </ul> </section> <section class="tea-bg-white aui-margin-r-15"> <ul class="aui-list aui-list-in aui-form-list"> <li class=aui-list-item> <div class=aui-list-item-inner> <div class=aui-list-item-label tapmode onclick=openWinPlateProvince() style=width:4rem> <span id=plate-province class="tea-text-title tea-text-star-red tea-text-arrow-down">桂E</span> </div> <div class=aui-list-item-input> <input id=plate-num type=text placeholder=请输入车牌后5位数 tapmode oninput=input(0)> </div> <div id=select class="tea-text-round tea-big" tapmode onclick=openHistory()>选</div> </div> </li> <li class=aui-list-item> <div class=aui-list-item-inner> <div class=aui-list-item-label-icon style=padding:0;min-width:0> <span class=tea-text-red>*</span> </div> <div class=aui-list-item-input> <input id=tel type=tel placeholder=请输入您的手机号码 tapmode oninput=input(1) required> <div class=tea-clear-btn onclick='tea.clear("tel"),input(1)'> <i class="aui-iconfont aui-icon-close"></i> </div> </div> </div> </li> <li class=aui-list-item> <div class="aui-list-item-inner aui-list-item-arrow" tapmode onclick=openCouponLists()> <div class=aui-list-item-label style=width:4rem> <span class=tea-text-title>现金券</span> </div> <div id=coupon class="aui-font-size-14 tea-text-gray aui-margin-r-15">暂无可用现金券</div> </div> </li> </ul> </section> <div class=VIP-deal tapmode onclick=openWinXieyi()> <span class=VIP-icon>我同意《VIP会员服务协议》</span> </div> <footer style="margin:.75rem 2rem"> <div id=pay-btn class="aui-btn aui-btn-block aui-text-white tea-bg-light-blue tea-btn-radius" tapmode onclick=pay()>确认支付</div> <p style="margin:.5rem 0 2.2rem .75rem" class="aui-font-size-12 aui-text-center tea-text-blue">支付成功则不可退款</p> </footer> </body> <script src=../../script/api.js></script> <script src=../../script/tea.js></script> <script src=../../script/conn.js></script> <script src=../../script/doT.min.js></script> <script src=../../script/aui-toast.js></script> <script type=text/template id=template></script> <script>function initVar(){dom={cols:$api.domAll(".aui-col-xs-6 .aui-list-item"),blueBtn:$api.byId("blue-btn"),yellowBtn:$api.byId("yellow-btn"),tel:$api.byId("tel"),plateNum:$api.byId("plate-num"),plateProvince:$api.byId("plate-province"),select:$api.byId("select"),payBtn:$api.byId("pay-btn"),coupon:$api.byId("coupon"),update:updateDom},data={id:$api.getStorage("ID"),result:[],couponsIndex:0},values={carid:null,carnum:"桂E",tel:$api.getStorage("telphone"),carcolor:0,paymoney:600,coupon_m:0,coupon_id:"",update:updateVar},tea.sameHeight(dom.cols),updateHTML()}function initModule(){}function initEventListener(){api.addEventListener({name:"addOldCar"},function(a,e){a&&(values.carcolor=a.value.cartype,values.carid=a.value.carid,values.carnum=a.value.car,values.tel=a.value.tel,updateHTML())}),api.addEventListener({name:"selectPlateProvince"},function(a,e){if(a){var o=a.value.province+a.value.city;values.carnum=o+values.carnum.slice(2),updateHTML()}}),api.addEventListener({name:"selectCoupon"},function(a,e){a&&(values.coupon_id=a.value.coupon.ID,values.coupon_m=a.value.coupon.coupon_m,data.couponsIndex=a.value.couponsIndex,updateHTML())})}function getPlate(){api.showProgress({style:"default",animationType:"fade",title:"努力加载中...",text:"请稍后...",modal:!0}),api.ajax({url:website+"getmycar.php?action=getmycar",method:"post",data:{values:{ID:data.id}}},function(a,e){api.hideProgress(),a&&(values.update(a),updateHTML())})}function getCoupon(){api.ajax({url:website+"api_cj.php?action=my_coupon",method:"post",data:{values:{userid:data.id,state:"2"}}},function(a,e){if(!a)return tea.toast("ajax"),!1;if(!a.length)return!1;a.sort(function(a,e){return parseFloat(a.coupon_m)>parseFloat(e.coupon_m)?1:-1});for(i in a)"vip"==a[i].coupon_type?data.result.unshift(a[i]):data.result.push(a[i]);"vip"==data.result[0].coupon_type&&(values.coupon_m=data.result[0].coupon_m,values.coupon_id=data.result[0].ID),updateHTML()})}function updateVar(a){function e(a){values.carid=a.ID,values.carnum=a.carnum,values.tel=a.tel,values.carcolor=a.cartype,(a.carcolor=0)?values.paymoney=600:values.paymoney=1e3}if(api.pageParam.carid){for(o=0;o<a.length;o++)if(a[o].ID==api.pageParam.carid)return void e(a[o])}else for(var o=0;o<a.length;o++)if(0==a[o].vip)return void e(a[o])}function updateDom(){}function updateHTML(){selectCarColor(values.carcolor,!0),$api.val(dom.tel,values.tel),$api.text(dom.plateProvince,values.carnum.slice(0,2)),$api.val(dom.plateNum,values.carnum.slice(2)),values.coupon_id?($api.text(dom.coupon,"-￥"+values.coupon_m),$api.addCls(dom.coupon,"coupon-active")):($api.text(dom.coupon,"暂无可用现金券"),$api.removeCls(dom.coupon,"coupon-active")),checkForm()}function selectCarColor(a,e){((e=tea.check(e,!1))||values.carcolor!=a)&&(values.carcolor=a,0==a?($api.addCls(dom.blueBtn,"blue"),$api.removeCls(dom.yellowBtn,"yellow"),values.paymoney=600):($api.addCls(dom.yellowBtn,"yellow"),$api.removeCls(dom.blueBtn,"blue"),values.paymoney=1e3))}function openHistory(){api.openWin({name:"plateNum",url:"../car_plate/plate_num_win.html",pageParam:{vip:!1}})}function openWinPlateProvince(){event.stopPropagation(),api.openWin({name:"plateProvince",url:"../car_plate/plate_province_win.html",pageParam:{name:"test"}})}function input(a){if(0==a){e=$api.val(dom.plateNum);values.carnum=values.carnum.slice(0,2)+e}if(1==a){var e=$api.val(dom.tel);values.tel=e}checkForm()}function pay(){var a=check();!0===a?checkcarnum(values.carnum,function(a){if("1"==a){var e=!1;values.carid&&(e=!0);var o={carid:values.carid,carnum:values.carnum,tel:values.tel,carcolor:values.carColor,paymoney:values.paymoney,addcar:e,mtype:"8",coupon_id:values.coupon_id,coupon_m:values.coupon_m};api.openWin({name:"pay_win",url:"../pay/pay_win.html",pageParam:{title:"支付VIP费用",money:values.paymoney,result_m:parseFloat(values.paymoney)-parseFloat(values.coupon_m),type:"addvip",values:o},vScrollBarEnabled:!1})}else tea.toast("custom","此车牌已加入VIP</br>无需重复加入")}):tea.toast("fail",a)}function check(){return values.tel=tea.toNum(values.tel),tea.checkPhone(values.tel)?!(values.carnum.length<3)||"请输入格式正确</br>的车牌号码":"请输入格式正确</br>的手机号码"}function checkForm(){!0===check()?$api.addCls(dom.payBtn,"tea-active"):$api.removeCls(dom.payBtn,"tea-active")}function checkcarnum(a,e){api.ajax({url:website+"api.php?action=checkcarnum",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{userid:data.id,carnum:values.carnum,car_type:values.carColor,telphone:values.tel}}},function(a,o){a&&e(a.succ)})}function openCouponLists(){api.openWin({name:"coupon_list_win",url:"../unit/coupon_list_win.html",pageParam:{coupons:data.result,couponType:"vip",couponsIndex:data.couponsIndex}})}function openWinXieyi(){api.openWin({name:"vipxieyi",url:"./vipxieyi_win.html",vScrollBarEnabled:!1})}var dom={},data={},values={};apiready=function(){initVar(),initModule(),initEventListener(),getPlate(),getCoupon()}</script> </html>