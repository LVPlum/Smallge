<!DOCTYPE html> <html> <head> <meta charset=utf-8> <meta name=viewport content="maximum-scale=1,minimum-scale=1,user-scalable=0,width=device-width,initial-scale=1"/> <title></title> <link rel=stylesheet type=text/css href=../../css/aui18/aui.css /> <link rel=stylesheet type=text/css href=../../css/aui18/common.css /> </head> <style type=text/css>img.aui-img-object{border-radius:50%;max-width:48px!important;height:48px!important;line-height:48px!important}.bo img{border-radius:0;max-width:88px!important;height:88px!important;line-height:88px!important}.n{font-size:16px;color:#4f59dd}.body{font-size:15px;color:#323232}.otherinfo{padding-bottom:50px}.otherinfo p{font-size:13px;margin:0 15px 3px 5px;display:inline}.otherinfo .tx{font-size:20px}.hui{background-color:#eef3f7;padding:0 5px 0 15px}.hui p:active{background-color:#ccc}</style> <body> <div class=aui-content> <ul class=aui-list-view id=content> </ul> </div> <div class=aui-toast style=display:none id=default> <i class="aui-iconfont aui-icon-check"></i> <div class=aui-toast-content>删除成功</div> </div> </body> <script src=../../script/api.js></script> <script src=../../script/conn.js></script> <script src=../../script/zepto.min.js></script> <script src=../../script/zan1.js></script> <script src=../../script/emo.js></script> <script>function loaddate(){showp("加载数据中...","请梢候"),api.ajax({url:website+"getnewslist.php?action=showcontent",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{titleid:titleid}}},function(a,i){if(a){var e="",t=$api.byId("content");if(e+='<li class="aui-list-view-cell aui-img">',e+='<img class="aui-img-object aui-pull-left" src="'+a.img+'">',e+='<div class="aui-img-body n">'+a.nickname,e+='<p class="body">'+a.body+"</p>",""!=a.pic){e+='<div class="aui-content"><ul class="aui-list-view aui-grid-view bo">';for(var n=a.pic.split(","),s=0;s<n.length;s++)e+='<li class="aui-list-view-cell aui-img aui-col-xs-4" onclick="openbigimg('+a.ID+","+s+');"><img class="aui-img-object" src="'+website+"newspicup/smallimg/"+n[s]+'"></li>';e+="</ul>"}if(null!=a.lylist){e+='<div class="aui-content hui">';for(var s=0,o=a.lylist.length;s<o;s++){var l=a.lylist[s];if("1"==l.lymode){var p=""==l.liuyan?"平安是福，行车顺利":l.liuyan;e+='<p id="ly'+l.ID+'" onclick="zjliuyan('+a.ID+",'"+l.nickname+"',"+l.userid+',1,0)"><span class="nc">'+l.nickname+'<span class="hf">打赏了楼主'+l.dxmoney+'元,</span></span><span class="lc">打赏理由:<span class="dx">'+p+"</span></span></p>"}else l.towho==a.nickname?e+='<p id="ly'+l.ID+'" onclick="zjliuyan('+a.ID+",'"+l.nickname+"',"+l.userid+",1,"+l.ID+')"><span class="nc">'+l.nickname+':</span><span class="lc">'+_transEmo(l.liuyan)+"</span></p>":e+='<p id="ly'+l.ID+'" onclick="zjliuyan('+a.ID+",'"+l.nickname+"',"+l.userid+",1,"+l.ID+')"><span class="nc">'+l.nickname+' <span class="hf">回复了</span> <a onclick="zjliuyan('+a.ID+",'"+l.towho+"')\">"+l.towho+'</a>:</span><span class="lc">'+_transEmo(l.liuyan)+"</span></p>"}e+="</div>"}e+="</div></li>",e+='<div class="aui-col-xs-12 otherinfo aui-text-right">',e+='<p class="wz'+a.ID+' zanj" id="zanj" data-num="3" tapmode onclick="zan('+a.ID+')"><span class="aui-iconfont aui-icon-appreciate tx"></span> 赞(<span id="zancount'+a.ID+'">'+a.zan+"</span>)</p>",e+='<p class="wz'+a.ID+'" data-num="2" tapmode onclick="zjliuyan('+a.ID+",'"+a.nickname+'\',0,0,0)"><span class="aui-iconfont aui-icon-comment tx"></span> 评论(<span id="pl'+a.ID+'">'+a.lycount+"</span>)</p>",e+='<p class="wz'+a.ID+'" data-num="1" tapmode onclick="sendmoney('+a.userid+",'"+a.nickname+"','"+a.ID+'\')"><span class="aui-iconfont aui-icon-recharge tx"></span> 打赏('+a.dxcount+")</p>",e+="</div>",userid==a.userid&&(e+='<div class="aui-btn-row"><div class="aui-btn aui-btn-block aui-btn-danger" tapmode onclick="deltitle('+a.ID+')">删除本贴</div></div>'),$api.html(t,e),api.hideProgress()}})}function zan(a){api.ajax({url:website+"savenews.php?action=zan",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{ID:a}}},function(i,e){if(i){var t=$api.html($api.byId("zancount"+a));t=parseInt(t)+1,$api.html($api.byId("zancount"+a),t)}else api.alert({msg:"错误码："+e.code+"；错误信息："+e.msg+"网络状态码："+e.statusCode})})}function zjliuyan(a,i,e,t,n){var s=$api.getStorage("nickname"),o=$api.getStorage("telphone"),l=gettoken(o),p=a;if(userid==e&&0!=n)api.actionSheet({cancelTitle:"取消",destructiveTitle:"删除"},function(a,i){a&&1==a.buttonIndex&&delly(p,n)});else{var c=0==t?"评论":"回复";UIChatBox.open({placeholder:c+" @"+i,maxRows:4,emotionPath:"widget://image/emotion",styles:{inputBar:{borderColor:"#d9d9d9",bgColor:"#f2f2f2"},inputBox:{borderColor:"#B3B3B3",bgColor:"#FFFFFF"},indicator:{target:"both",color:"#c4c4c4",activeColor:"#9e9e9e"}}},function(a){if("send"==a.eventType){var e=a.msg,t=api.deviceModel;if(!e)return api.alert({msg:"不能发送为空的内容"}),!1;api.ajax({url:website+"savenews.php?action=addliuyan",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{msg:e,nickname:s,telphone:o,token:l,ID:p,userid:userid,dm:t,towho:i}}},function(a,i){a?a.errmsg||(UIChatBox.close(),api.toast({msg:"发表成功"}),loaddate()):api.alert({msg:"错误码："+i.code+"；错误信息："+i.msg+"网络状态码："+i.statusCode})})}})}}function delly(a,i){api.ajax({url:website+"savenews.php?action=delly",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{tzid:a,lyid:i}}},function(e,t){if(e&&"1"==e.succ){var n=$api.byId("ly"+i);$api.remove(n);var s=parseInt($api.html($api.byId("pl"+a)));s-=1,$api.html($api.byId("pl"+a),s),api.toast({msg:"删除成功"})}})}function openbigimg(a,i){api.ajax({url:website+"getnewslist.php?action=getimglist",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{ID:a}}},function(a,e){if(a){if(!a.errmsg&&"ok"==a.succ){for(var t=a.img.split(","),n=[],s=0;s<t.length;s++){var o=website+"newspicup/"+t[s];n.push(o)}api.require("imageBrowser").openImages({imageUrls:n,showList:!1,activeIndex:i})}}else api.alert({msg:"错误码："+e.code+"；错误信息："+e.msg+"网络状态码："+e.statusCode})})}function sendmoney(a,i,e){if($api.getStorage("ID")==a)return api.toast({msg:"亲，不能自己打赏自己啦，去看看谁顺眼就赏TA~"}),!1;api.openWin({name:"../red_packet/fahongbao_win",url:"../red_packet/reward_win.html",bounces:!1,vScrollBarEnabled:!1,pageParam:{ID:a,target:i,tzid:e}})}function deltitle(a){api.confirm({title:"取消提示",msg:"真的要删除？是的话所有留言会一并消失",buttons:["是","否"]},function(i,e){i&&1==i.buttonIndex&&api.ajax({url:website+"savenews.php?action=deltitle",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{titleid:a}}},function(a,i){a&&1==a.succ&&(api.sendEvent({name:"reflashnews"}),showDefault())})})}function showDefault(){$api.css($api.byId("default"),"display:block"),setTimeout(function(){$api.css($api.byId("default"),"display:none"),api.closeWin()},2e3)}var titleid=null,UIChatBox=null,userid=null;apiready=function(){userid=$api.getStorage("ID"),UIChatBox=api.require("UIChatBox"),titleid=api.pageParam.ID,api.parseTapmode(),loaddate(),api.addEventListener({name:"tap"},function(){UIChatBox.close()})},Zepto(function(a){function i(i){var e=a("<b>").text("赞+1"),t=i.pageX,n=i.pageY;e.css({top:n-30,left:t,position:"absolute",color:"#E94F06","font-size":"1.0em","z-index":10}),a("body").append(e),e.animate({top:n-200,left:t-150,opacity:0,"font-size":"1.6em"},3e3,"linear",function(){e.remove()}),i.stopPropagation()}a("#content").on("click",".zanj",function(e){a(this);i(e)})})</script> </html>