<!DOCTYPE html> <html> <head> <meta charset=utf-8> <meta name=viewport content="maximum-scale=1,minimum-scale=1,user-scalable=0,width=device-width,initial-scale=1"/> <title></title> <link rel=stylesheet type=text/css href=../../css/aui18/aui.css /> <link rel=stylesheet type=text/css href=../../css/aui18/common.css /> </head> <style type=text/css>body{background-color:#fff}.title{font-size:20px;color:#136ce5}p{font-size:15px;color:#8f8f94}.kb{height:80px}.otherinfo p{font-size:15px;margin:0 15px 3px 5px;display:inline}.otherinfo .tx{font-size:18px}.x{height:1px;background:#e7e7e7;overflow:hidden;margin:0 15px 0 15px}</style> <body> <div class="aui-text-center title aui-hr" id=title></div> <div class=x>sdsafdsaf</div> <div class="aui-content aui-padded-10" id=content></div> <div class="aui-col-xs-12 otherinfo aui-text-center"> <p id=zanj data-num=3 tapmode onclick=zan()><span class="aui-iconfont aui-icon-appreciate tx"></span> 赞(<span id=zancount></span>)</p> <p tapmode id=share><span class="aui-iconfont aui-icon-recharge tx"></span>分享</p> </div> <div class=aui-content> <ul class=aui-user-view id=liuyanlist> <p id=ly>暂无留言</p> </ul> </div> <p class=aui-text-center id=loadding></p> <div class=kb></div> </body> <script src=../../script/api.js></script> <script src=../../script/conn.js></script> <script src=../../script/emo.js></script> <script src=../../script/share.js></script> <script src=../../script/hammer.min.js></script> <script>function loaddate(){showp("数据加载中...","请稍候"),api.ajax({url:website+"getnewslist.php?action=smallgenews",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{ID:newsid}}},function(e,i){if(e){var t=$api.byId("title"),a=$api.byId("content"),n=$api.byId("zancount"),o=$api.byId("share");$api.html(t,decodeURI(e.title)),$api.html(a,e.body),$api.html(n,e.zan),title=e.title,description=e.description,$api.attr(o,"onclick","share()"),chimg(),api.hideProgress(),imgPress()}})}function showinput(){UIChatBox.open({placeholder:"说点什么吧",maxRows:4,emotionPath:"widget://image/chatBox/emotion",styles:{inputBar:{borderColor:"#ededed",bgColor:"#ffffff"},inputBox:{borderColor:"#B3B3B3",bgColor:"#FFFFFF"},emotionBtn:{normalImg:"widget://image/chatBox/chatBox_face1.png"},indicator:{target:"both",color:"#c4c4c4",activeColor:"#9e9e9e"},sendBtn:{titleColor:"#fff",bg:"#3399ff",activeBg:"#46a91e",titleSize:14}}},function(e){if("send"==e.eventType){var i=e.msg;i&&api.ajax({url:website+"savenews.php?action=smallgeliuyan",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{msg:i,nickname:nickname,telphone:telphone,ID:ID,newsid:newsid}}},function(e,i){e&&(api.toast({msg:"发表成功"}),UIChatBox.close(),showinput(),getajaxlist(1,0))})}})}function getajaxlist(e,i){$api.text($api.byId("loadding"),"留言加载中...");var t="";api.ajax({url:website+"getnewslist.php?action=getsmallgely&page="+e,method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{ID:newsid}}},function(e,a){if(e){for(var n=$api.byId("liuyanlist"),o=0,s=e.length;o<s;o++){var l=e[o];t+='<li class="aui-user-view-cell aui-img">',t+='<img class="aui-img-object aui-pull-left" src="'+l.img+'" tapmode onclick="openfrinfo('+l.frid+')">',t+='<div class="aui-img-body"><span>'+l.nickname+"<em>"+l.addtime+"</em></span><p>"+_transEmo(l.msg)+"</p></div>",t+="</li>"}1==i?$api.append(n,t):0==i&&$api.html(n,t)}$api.text($api.byId("loadding"),"")})}function openfrinfo(e){api.openWin({name:"friendinfo",url:"../friends/friendinfo_win.html",pageParam:{friid:e},vScrollBarEnabled:!1})}function chimg(){var e=document.getElementsByTagName("img");for(i=0;i<e.length;i++)e[i].setAttribute("onclick","openbig("+i+")"),e[i].setAttribute("tapmode",""),picarr.push(e[i].src)}function openbig(e){imageBrowser.openImages({imageUrls:picarr,showList:!1,activeIndex:e})}function share(){api.require("dialogBox").actionMenu({rect:{h:100},tapClose:!0,items:[{text:"微信好友",icon:"widget://image/wxhy.png"},{text:"朋友圈",icon:"widget://image/wxpyq.png"}],styles:{bg:"#FFF",column:3,itemText:{color:"#000",size:12,marginT:8},itemIcon:{size:40}}},function(e){0!=e.index&&1!=e.index||(0==e.index&&(key="session"),1==e.index&&(key="timeline"),api.require("wx").shareWebpage({apiKey:"",scene:key,title:title,description:description,thumb:"widget://image/logo108.png",contentUrl:website+"m/smallgenews.php?ID="+newsid},function(e,i){e.status&&api.alert({msg:"分享成功"})}))})}function zan(){api.ajax({url:website+"savenews.php?action=zan",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{ID:newsid}}},function(e,i){if(e){var t=$api.html($api.byId("zancount"));t=parseInt(t)+1,$api.html($api.byId("zancount"),t)}else api.alert({msg:"错误码："+i.code+"；错误信息："+i.msg+"网络状态码："+i.statusCode})})}function imgPress(){function e(e){api.saveMediaToAlbum({path:e},function(e,i){e&&e.status?api.toast({msg:"已保存到相册，请在微信中打开",duration:2e3,location:"middle"}):api.toast({msg:"图片保存失败，请检测内存是否已满",duration:2e3,location:"middle"})})}for(var i=$api.domAll("img"),t={},a=0;a<i.length;a++)!function(a){var n=i[a];t[a]=new Hammer(n),t[a].on("press",function(t){var n=$api.attr(i[a],"src");api.actionSheet({cancelTitle:"取消",buttons:["保存图片到本地","分享给微信好友","分享到微信朋友圈","在微信收藏此图片"]},function(i,t){var a=i.buttonIndex;api.download({url:n,report:!0,cache:!0,allowResume:!0},function(i,t){if(1==i.state){var n=i.savePath;1==a&&e(n),2==a&&shareImg({url:n,scene:"session"}),3==a&&shareImg({url:n,scene:"timeline"}),4==a&&shareImg({url:n,scene:"favorite"})}t&&api.toast({msg:"网络原因，图片保存未成功",duration:2e3,location:"middle"})})})})}(a)}var newsid=null,ID=null,telphone=null,nickname=null,imageBrowser=null,picarr=new Array,title=null,description=null;apiready=function(){UIChatBox=api.require("UIChatBox"),imageBrowser=api.require("imageBrowser"),newsid=api.pageParam.id,ID=$api.getStorage("ID"),telphone=$api.getStorage("telphone"),nickname=$api.getStorage("nickname"),api.parseTapmode(),loaddate(),showinput(),getajaxlist(1,0);var e=1;api.addEventListener({name:"scrolltobottom"},function(i,t){getajaxlist(++e,1)})}</script> </html>