<!DOCTYPE html> <html> <head> <meta charset=utf-8> <meta name=viewport content="maximum-scale=1,minimum-scale=1,user-scalable=0,width=device-width,initial-scale=1"/> <meta name=format-detection content="telephone=no,email=no,date=no,aItemress=no"> <title></title> <link rel=stylesheet type=text/css href=../../css/api.css /> <link rel=stylesheet type=text/css href=../../css/aui.css /> <link rel=stylesheet type=text/css href=../../css/aui-skin.css /> <link rel=stylesheet type=text/css href=../../css/tea.css /> <style type=text/css>body,html{height:100%;overflow:auto}.banner{width:48%;height:4.55rem;border:1px solid;text-align:center;border-radius:5px}.indigo{background:#eaf5ff;border-color:#39f}.orange{background:#ffefe5;border-color:#f60}.uncheck{background:#f5f5f5;border-color:#ccc}.btn{width:2.35rem;height:1.5rem;border-radius:30px}.dot{padding-left:.6rem}.dot-blue:before,.dot-red:before{content:"";width:.3rem;height:.3rem;border-radius:.5rem;position:absolute;left:0;top:.3rem}.dot-red:before{background:#f33}.dot-blue:before{background:#39f}</style> </head> <body> <div class=aui-content id=app v-cloak> <div class=aui-card-list-header style=padding:.75rem;background:#fff> <div v-if=" checkBreakfast " class="banner uncheck" tapmode @click=yycan(3)> <i class="aui-iconfont tea-icon-breakfast tea-text-gray" style=font-size:2rem></i> <p class=tea-text-title style=font-weight:700>您已预约明天早餐</p> </div> <div v-else class="banner indigo" tapmode @click=yycan(1)> <i class="aui-iconfont tea-icon-breakfast tea-text-blue" style=font-size:2rem></i> <p class="indigo tea-text-blue" style=font-weight:700>预约明天早餐</p> </div> <div v-if=" checkLunch " class="banner uncheck" tapmode @click=yycan(3)> <i class="aui-iconfont tea-icon-lunch tea-text-gray" style=font-size:2rem></i> <p class=tea-text-title style=font-weight:700>您已预约明天午餐</p> </div> <div v-else class="banner orange" tapmode @click=yycan(2)> <i class="aui-iconfont tea-icon-lunch" style=font-size:2rem;color:#f60></i> <p class=tea-text-orange style=font-weight:700>预约明天午餐</p> </div> </div> <section class=aui-margin-t-10> <ul class=aui-list> <li class=aui-list-item style="padding:0;background-size:92% 1px" tapmode @click=mulityy()> <div class=aui-list-item-inner style="padding:.65rem 1rem"> <div class=aui-list-item-title style=margin-left:-.3rem> <p class="aui-margin-b-5 tea-text-title" style=font-weight:700>预约报餐</p> <p class=tea-text-gray>多天一起预约丨最多预约未来七天内</p> </div> <div class=aui-list-item-right> <i class="aui-iconfont tea-icon-addfood" style=font-size:1.5rem></i> </div> </div> </li> <li v-for="list in msg" class=aui-list-item style=padding:0> <div class=aui-list-item-inner style="padding:.65rem 1rem"> <div class="aui-list-item-title dot" :class='[list.zt==1? "dot-blue" : "dot-red"]'> <p class="aui-margin-b-5 tea-text-title">{{ list.dctime }}</p> <p v-if="list.zt==1 && list.ky==1" class=tea-text-gray>{{ list.dctype }}已预约</p> <p v-else-if="list.zt==0 && list.ky==1" class=tea-text-gray>{{ list.dctype }}</p> <p v-else-if="list.ky==0" class=tea-text-gray>{{ list.ok==1 ? list.dctype+'已使用' : list.dctype}}</p> </div> <div v-if="list.zt==1 && list.ky==1" class="aui-list-item-right aui-btn tea-bg-gray btn" tapmode @click=cancelyy(list.ID)>取消</div> <div v-else-if="list.zt==0 && list.ky==1" class="aui-list-item-right aui-btn aui-text-white tea-bg-blue btn" tapmode @click=recancelyy(list.ID)>重订</div> <div v-else-if="list.ky==0"></div> </div> </li> </ul> </section> </div> </body> <script src=../../script/api.js></script> <script src=../../script/aui-toast.js></script> <script src=../../script/tea.js></script> <script src=../../script/conn.js></script> <script src=../../script/vue.min.js></script> <script type=text/template id=template> </script> <script>function loaddate(){showp("数据加载中",""),api.ajax({url:website+"fantang/sm/fantang.php?action=getuserinfo",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{userid:userid}}},function(a,e){a&&(bumen=a.bumen,com=a.com,checkzc(),checkwc(),showyylist(),api.hideProgress())})}function checkzc(){api.ajax({url:website+"fantang/sm/junmafantang.php?action=checkdc",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{userid:userid,dctype:"1"}}},function(a,e){a&&("1"==a.succ?vm.checkBreakfast=!0:vm.checkBreakfast=!1)})}function checkwc(){api.ajax({url:website+"fantang/sm/junmafantang.php?action=checkdc",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{userid:userid,dctype:"2"}}},function(a,e){a&&("1"==a.succ?vm.checkLunch=!0:vm.checkLunch=!1)})}function showyylist(){api.ajax({url:website+"fantang/sm/junmafantang.php?action=showyylist",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{userid:userid}}},function(a,e){if(a){a.sort(function(a,e){return a.dctime>e.dctime?1:-1});for(i in a){var t=(new Date(a[i].dctime)-new Date)/1e3/60/60/24-1/3;1==Math.ceil(t)?a[i].dctime="明天":2==Math.ceil(t)?a[i].dctime="后天":0==Math.ceil(t)&&(a[i].dctime="今天")}vm.msg=a,checkzc(),checkwc()}})}function showok(){toast.success({title:"提交成功",duration:2e3})}var telphone=null,userid=null,nickname=null,bumen=null,com=null,vm=null;apiready=function(){userid=$api.getStorage("ID"),telphone=$api.getStorage("telphone"),nickname=$api.getStorage("nickname"),api.parseTapmode(),loaddate(),api.addEventListener({name:"reflash"},function(a,e){loaddate()}),vm=new Vue({el:"#app",data:{msg:"",checkBreakfast:!0,checkLunch:!0},methods:{mulityy:function(){api.openWin({name:"mulityy",url:"./mulityy_win.html",pageParam:{com:com,bumen:bumen},vScrollBarEnabled:!1})},yycan:function(a){3!=a?api.ajax({url:website+"fantang/sm/junmafantang.php?action=diancan",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{userid:userid,telphone:telphone,nickname:nickname,dctype:a,bumen:bumen,com:com}}},function(e,t){e&&(1==e.succ?(showok(),1==a&&(vm.checkBreakfast=!0,loaddate()),2==a&&(vm.checkLunch=!0,loaddate())):loaddate())}):api.alert({msg:"您已预约过了，无需重复预约"})},cancelyy:function(a){api.confirm({title:"取消订餐",msg:"请您确定是否要取消预约",buttons:["取消","确定"]},function(e,t){1!=e.buttonIndex&&api.ajax({url:website+"fantang/sm/junmafantang.php?action=cancelyy",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{userid:userid,ID:a}}},function(a,e){a&&showyylist()})})},recancelyy:function(a){api.ajax({url:website+"fantang/sm/junmafantang.php?action=recancelyy",method:"post",timeout:30,dataType:"json",returnAll:!1,data:{values:{userid:userid,ID:a}}},function(a,e){a&&1==a.succ&&showyylist()})}}})};var toast=new auiToast({})</script> </html>