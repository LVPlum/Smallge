<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="teletel=no,email=no,date=no,aItemress=no">
    <title></title>
    <!-- api样式 -->
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <!-- aui样式 -->
    <link rel="stylesheet" type="text/css" href="../../css/aui.css" />
    <link rel="stylesheet" type="text/css" href="../../css/aui-skin.css" />
    <!-- 小马哥通用样式 -->
    <link rel="stylesheet" type="text/css" href="../../css/tea.css" />
    <style type="text/css">

        /*如页面需要动态滚动到底部请去除height:100%*/
        html,body {
            height: 100%;
            overflow: auto;
        }
        /*针对此页面的框架重写*/
        .aui-list .aui-list-item{
            padding: 0rem;
            margin: 0.75rem;
        }
        .aui-list .aui-list-item-media{
            width: 5rem;
            height: 5rem;
            padding: 0;
        }

        .tea-column{
            flex-direction: column !important;
            align-items: start !important;
            -webkit-align-items: flex-start !important;
        }
        .tea-flex-center{
            display: flex;
            justify-content: center !important;
            align-items: center !important;
        }
        .tea-font-size-max {
            font-size: 2.2rem !important;
        }
        .tea-bg-deep-orange{
            background-color: #FF6633;
        }
        .tea-bg-purple{
            background-color: #5c78cd;
        }
        /*div边框的半圆形状，通用*/
        .tea-content-semicircle:before,.tea-content-semicircle:after{
            content: "";
            width: 0.375rem;
            height: 0.75rem;
            position: absolute;
            margin-top: -0.375rem;
            background: #f2f5f8;
            z-index: 1;
        }
        /*右半圆*/
        .tea-content-semicircle:before{
            left: -1px;
            top: 50%;
            border-radius: 0 100% 100% 0/50%;
        }
        /*左半圆*/
        .tea-content-semicircle:after{
            right: -1px;
            top: 50%;
            border-radius: 100% 0 0 100%/50%;
        }
        /*div边框虚线*/
        .tea-content-border-dotted:before{
            content: "";
            width: 2px;
            height: 5rem;
            background-position: left;
            background-image: linear-gradient(0,#ededed 50%,#fff 50%,transparent 50%);
            background-size: 1px 8px;
            position: absolute;
            left: 0;
        }
        /*div边框锯齿状波纹线*/
        .tea-content-border-sawtooth:after{
            content: "";
            width: 3px;
            height: 5rem;
            background-size: 3px 5px;
            background-repeat: repeat-y;
            background-position: 0 100%;
            position: absolute;
            right: 0;
        }
        .tea-content-border-sawtooth-blue:after{
            background-image: -webkit-gradient(radial,0 40%,1,0 50% ,5,from(#3399ff),color-stop(50%, #3399ff),color-stop(50%, #FFF),to(#FFF));
        }
        .tea-content-border-sawtooth-yellow:after{
            background-image: -webkit-gradient(radial,0 40%,1,0 50% ,5,from(#ffcc33),color-stop(50%, #ffcc33),color-stop(50%, #FFF),to(#FFF));
        }
        .tea-content-border-sawtooth-deep-orange:after{
            background-image: -webkit-gradient(radial,0 40%,1,0 50% ,5,from(#FF6633),color-stop(50%, #FF6633),color-stop(50%, #FFF),to(#FFF));
        }
        .tea-content-border-sawtooth-purple:after{
            background-image: -webkit-gradient(radial,0 40%,1,0 50% ,5,from(#5c78cd),color-stop(50%, #5c78cd),color-stop(50%, #FFF),to(#FFF));
        }
        /*￥符号前缀*/
        .tea-text-white-money{
            margin-left: 1.2rem;
        }
        .tea-text-white-money:before {
            content: '￥';
            color: white;
            font-size: 0.8rem;
            margin-left: -1.8rem;
            font-weight: normal;
        }
        /*签到的头部，以及签到板*/
        .banner{
            height: 6.5rem;
            background-image: url(../../image/benefit/benefit_img@2x.png);
            background-size: 100% 100%;
            margin: 0.5rem;
            position: relative;
        }
        .block{
            width: 3.975rem;
            height: 3.975rem;
            text-align: center;
            background-size: 100% 100%;
            position: absolute;
            right: 1rem;
            top: -0.5rem;
        }
        .sign{
            background-image: url(../../image/benefit/benefit_sign@2x.png);
        }
        .unsign{
            background-image: url(../../image/benefit/benefit_unsign@2x.png);
        }
        .tips{
            position: absolute;
            right: 3px;
            bottom: 3px;
            font-size: 0.6rem;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="app" class="aui-content aui-margin-b-15" v-cloak>
        <div class="banner" tapmode @click="openFrm">
            <div :class="lastCheck == 0 ? 'sign' : 'unsign' " class="block"></div>
            <p v-if="isApple()" class="tips aui-text-white">本活动与苹果公司无关</p>
        </div>
        <ul class="aui-list aui-media-list tea-bg-default aui-list-noborder" id="benefit_list">
            <li v-for="(value,index) in list" class="aui-list-item tea-bg-white" tapmode @click="goApply(value.coupon_type,value)">
                <div class="aui-media-list-item-inner tea-content-semicircle">
                    <div v-if="value.coupon_type == 'vip' " class="aui-list-item-media tea-bg-yellow tea-flex-center tea-content-border-sawtooth tea-content-border-sawtooth-yellow">
                        <div class="aui-text-white tea-text-white-money tea-font-size-max" style="width:2rem; font-weight:bold; text-align: center;">{{ parseFloat(value.coupon_m) }}</div>
                    </div>
                    <div v-else-if="value.coupon_type == 'bx'" class="aui-list-item-media tea-bg-deep-orange tea-flex-center tea-content-border-sawtooth tea-content-border-sawtooth-deep-orange">
                        <div class="aui-text-white tea-text-white-money tea-font-size-max" style="width:2rem; font-weight:bold; text-align: center;">{{ parseFloat(value.coupon_m) }}</div>
                    </div>
                    <div v-else-if="value.coupon_type == 'hf'" class="aui-list-item-media tea-bg-purple tea-flex-center tea-content-border-sawtooth tea-content-border-sawtooth-purple">
                        <div class="aui-text-white tea-text-white-money tea-font-size-max" style="width:2rem; font-weight:bold; text-align: center;">{{ parseFloat(value.coupon_m) }}</div>
                    </div>
                    <div v-else class="aui-list-item-media tea-bg-blue tea-flex-center tea-content-border-sawtooth tea-content-border-sawtooth-blue">
                        <div class="aui-text-white tea-text-white-money tea-font-size-max" style="width:2rem; font-weight:bold; text-align: center;">{{ parseFloat(value.coupon_m) }}</div>
                        <!--<div class="aui-text-white aui-font-size-18" style="width:2rem;font-weight:bold;">{{ list.test_value }}</div> //免费审车的值样式-->
                    </div>
                    <div class="aui-list-item-inner" style="padding: 0.75rem 0.75rem 0rem 0.75rem;">
                        <div class="aui-list-item-text">
                            <div class="aui-list-item-title aui-font-size-14 tea-text-title">{{ value.readme }}</div>
                        </div>
                        <div class="aui-list-item-text tea-column">
                            <p v-for="(val,i) in value.content" class="aui-ellipsis aui-font-size-12 tea-text-gray">{{ val }}</p>
                        </div>
                        <div class="aui-list-item-text">
                            <p class="aui-ellipsis aui-font-size-12 tea-text-gray">有效期至：{{ value.end_time.split(" ")[0] }}</p>
                        </div>
                    </div>
                    <div class="aui-list-item-media tea-content-border-dotted tea-flex-center" style="width:2.2rem;">
                        <div class="tea-text-blue aui-font-size-12" style="width:0.6rem;">立即使用</div>
                    </div>
                </div>
            </li>
            <!--<li class="aui-list-item tea-bg-white">
                <div class="aui-media-list-item-inner tea-content-semicircle">
                    <div class="aui-list-item-media tea-bg-yellow tea-flex-center tea-content-border-sawtooth tea-content-border-sawtooth-yellow">
                        <div class="aui-text-white tea-text-white-money tea-font-size-max" style="width:2rem; font-weight:bold;">50</div>
                    </div>
                    <div class="aui-list-item-inner" style="padding:1rem;">
                        <div class="aui-list-item-text">
                            <div class="aui-list-item-title aui-font-size-14 tea-text-title">免费审车券</div>
                            &lt;!&ndash;<div class="aui-list-item-right">08:00</div>&ndash;&gt;
                        </div>
                        <div class="aui-list-item-text">
                            <p class="aui-ellipsis-1 aui-font-size-12 tea-text-gray">仅限小马哥网约审车使用</p>
                        </div>
                        <div class="aui-list-item-text">
                            <p class="aui-ellipsis-1 aui-font-size-12 tea-text-gray">有效期至：2017.08.08</p>
                        </div>
                    </div>
                    <div class="aui-list-item-media tea-content-border-dotted tea-flex-center" style="width:2.2rem;">
                        <div class="tea-text-blue aui-font-size-12" style="width:0.6rem;">立即使用</div>
                    </div>
                </div>
            </li>-->
        </ul>
        <p class="tea-text-blue aui-font-size-14 aui-pull-right" style="margin-right: .75rem" tapmode onclick="openWinPastdata()">已过期失效的券></p>
        <section v-if="list.length == 0" id="nothing" class="tea-nothing" style="margin-top: 5rem">
            <img src="../../image/nothing.png">
            <p>您还没有任何现金券哦~</p>
        </section>
    </div>
</body>

<script type="text/javascript" src="../../script/api.js" ></script>
<!-- aui toast -->
<script type="text/javascript" src="../../script/aui-toast.js"></script>
<!-- 小马哥通用函数库 -->
<script type="text/javascript" src="../../script/tea.js"></script>
<!-- ajax相关 -->
<script type="text/javascript" src="../../script/conn.js"></script>

<script type="text/javascript" src="../../script/vue.min.js"></script>

<script type="text/javascript">

/**********************************声明全局变量**********************************/
// 声明DOM对象
var dom = {};

// 声明全局变量
var data = {}, values = {}, vm = null;

/**********************************apiready**********************************/
apiready = function(){



    // 初始化变量
    initVar();

    // 初始化模块
    initModule();

    // 初始化监听
    initEventListener();

    // ajax请求数据
    getData();

    //获取今天是否签到
    getCheck();
};

/**********************************初始化变量**********************************/
function initVar(){

    dom = {
    };

    data = {
    };

    values = {
    };

    vm = new Vue({
        el: '#app',
        data: {
            lastCheck: 0, //今天是否签过到，0否，1是
            list: [],
        },
        methods: {
            openFrm: function(){
                if(getCheck() == 0){
                    this.openFrmDial();
                }else {
                    this.openWinIntegral();
                }
            },
            //打开转盘的frm
            openFrmDial : function(){
                api.openFrame({
                    name: 'dial_frm',
                    url: './dial_frm.html',
                    rect: {
                        x: 0,
                        y: 0,
                        w: 'auto',
                        h: 'auto'
                    },
                    pageParam: {
                        name: 'dial_frm'
                    },
                    bgColor: 'rgba(0,0,0,0.6)',
                    vScrollBarEnabled: false,
                    hScrollBarEnabled: false
                });
            },
            //签到后打开签到积分详情页面
            openWinIntegral : function(){
                api.openWin({
                    name: 'integral_win',
                    url: '../me/integral_win.html',
                    pageParam: {
                        name: 'pageparamname'
                    }
                });
            },
            //现金券的跳转路径
            goApply : function(type,value){
                switch (type){
                    case 'vip':
                        tea.openWin({
                            name: 'vip_win',
                            url: '../vip/vip_win.html',
                            pageParam: {
                                name: 'pageparamname'
                            }
                        });
                        break;
                    case 'bx':
                        tea.openWin({
                            name: 'vip_win',
                            url: '../vip/vip_win.html',
                            pageParam: {
                                name: 'pageparamname'
                            }
                        });
                        break;
                    case 'hf':
                        tea.openWin({
                            name: 'phone_pay_win',
                            url: '../wallet/phone_pay_win.html',
                            pageParam: {
                                name: 'pageparamname'
                            }
                        });
                        break;
                    case 'sc':
                        api.openFrame({
                            name: 'coupon_sc_code_frm',
                            url: './coupon_sc_code_frm.html',
                            rect: {
                                x: 0,
                                y: 0,
                                w: 'auto',
                                h: 'auto'
                            },
                            pageParam: {
                                coupon: value
                            },
                            bgColor: 'rgba(0,0,0,0.6)',
                            vScrollBarEnabled: false,
                            hScrollBarEnabled: false
                        });
                        break;
                    default:
                        api.toast({
                            msg: '您的版本较低，请升级到最新版本后使用',
                            duration: 2000,
                            location: 'middle'
                        });
                }
            },
            isApple: function(){
                return api.systemType == "ios" ? true : false;
            }
        }
    });

    updateHTML();


};

/**********************************初始化模块**********************************/
function initModule(){



}

/**********************************初始化监听**********************************/
function initEventListener(){
    /*监听每日抽奖更新现金券列表，进行签到*/
    api.addEventListener({
        name: 'lotteryOK'
    }, function(ret, err) {

        getCheck();
        getData();
    });

}

/**********************************ajax请求数据**********************************/
function getData(){
    showp('数据加载中···');
    api.ajax({
        url:  website + 'api_cj.php?action=my_coupon',
        method: 'post',
        data: {
            values: {
                userid: $api.getStorage('ID'),
                state: '2', //2 为可用现金券列表
            }
        }
    }, function (ret, err) {
        api.hideProgress();
        if(!ret){
//            tea.toast('ajax');
            return false;
        }
        if(ret){
            vm.list = ret;
        }
    });

}

function getCheck(){
    showp('加载中');
    api.ajax({
        url: website + 'api_cj.php?action=check',
        method: 'post',
        timeout: 30,
        data: {
            values: {
                userid: $api.getStorage('ID'),
            }
        }
    }, function (ret, err) {
        api.hideProgress();
        if(!ret){
            tea.toast('ajax');
            return false;
        }
        if(ret){
            vm.lastCheck = ret.lastcheck; //传值过来lastcheck是全小写，页面内驼峰写法
        }
    });
//    _alert(vm.lastCheck);
    return vm.lastCheck;
}

/**********************************更新变量**********************************/
function updateVar(){


}

function updateDom(){



}
/**********************************更新HTML**********************************/
function updateHTML(){

}

/**********************************DOM响应**********************************/

/**********************************打开Frame**********************************/
// 打开转盘Frame
/*function openFrmDial(){
    api.openFrame({
        name: 'dial_frm',
        url: './dial_frm.html',
        rect: {
            x: 0,
            y: 0,
            w: 'auto',
            h: 'auto'
        },
        pageParam: {
            name: 'dial_frm'
        },
        bgColor: 'rgba(0,0,0,0.2)',
        vScrollBarEnabled: false,
        hScrollBarEnabled: false
    });
}*/

function openWinPastdata(){
    api.openWin({
        name: 'benefit_pastdata_win',
        url: './benefit_pastdata_win.html',
        pageParam: {
            name: 'benefit_pastdata_win'
        }
    });
}
/**********************************其他函数**********************************/

/*/!*抽奖完成时进行签到操作*!/
function checkIn(){
    api.ajax({
        url: website + 'inteinfo.php?action=checkin',
        method: 'post',
        timeout: 30,
        data: {
            values: {
                nickname: $api.getStorage('nickname'),
                userid: $api.getStorage('ID'),
                deviceId: api.deviceId,
            }
        }
    }, function (ret, err) {
        if(!ret){
            tea.toast('ajax');
            return false;
        }
        if(ret.succ == 1){
            vm.lastCheck = 1;
        }
    });
}*/

/*function test(){
    var ret = {
        list: [{
                "ID" : "5",
                "userid" : "10000",
                "readme" : "特权卡现金劵50元",
                "star_time" : "2017-07-13 19:48:07",
                "end_time" : "2017-08-13 19:48:07",
                "coupon_type" : "vip",
                "coupon_m" : "50.00",
                "ly" : "每日签到转盘",
                "ok" : "0",
                "test_title": "特权卡现金券",
                "test_id": "7",
                "test_value": "50",
                "test_text": "仅限小马哥平台特权卡使用",
                "test_time": "2017.08.08"
            },{
                "ID" : "6",
                "userid" : "10000",
                "readme" : "审车现金劵10元",
                "star_time" : "2017-07-13 19:48:14",
                "end_time" : "2017-08-13 19:48:14",
                "coupon_type" : "sc",
                "coupon_m" : "10.00",
                "ly" : "每日签到转盘",
                "ok" : "0",
                "test_title": "审车现金劵",
                "test_id": "4",
                "test_value": "10",
                "test_text": "仅限小马哥平台网约审车使用",
                "test_time": "2017.08.08"
            },{
                "ID" : "7",
                "userid" : "10000",
                "readme" : "特权卡现金劵50元",
                "star_time" : "2017-07-13 19:48:15",
                "end_time" : "2017-08-13 19:48:15",
                "coupon_type" : "vip",
                "coupon_m" : "50.00",
                "ly" : "每日签到转盘",
                "ok" : "0",
                "test_title": "汽车保险现金券",
                "test_id": "5",
                "test_value": "66",
                "test_text": "仅限小马哥平台使用",
                "test_limit": "满1200元可用，不含汽车税",
                "test_time": "2017.08.08"
            }],
        sign: 1,
    };

    var vm = new Vue({
        el: "#app",
        data:{
            lists: ret.list,
            mask: ret.sign
        }
    });

    /!*var data = {
    "1" : {
        "ID" : "5",
        "userid" : "10000",
        "readme" : "特权卡现金劵50元",
        "star_time" : "2017-07-13 19:48:07",
        "end_time" : "2017-08-13 19:48:07",
        "coupon_type" : "vip",
        "coupon_m" : "50.00",
        "ly" : "每日签到转盘",
        "ok" : "0",
        "test_title": "特权卡现金券",
        "test_id": "7",
        "test_value": "50",
        "test_text": "仅限小马哥平台特权卡使用",
        "test_time": "2017.08.08"
    },
    "2" : {
        "ID" : "6",
        "userid" : "10000",
        "readme" : "审车现金劵10元",
        "star_time" : "2017-07-13 19:48:14",
        "end_time" : "2017-08-13 19:48:14",
        "coupon_type" : "sc",
        "coupon_m" : "10.00",
        "ly" : "每日签到转盘",
        "ok" : "0",
        "test_title": "审车现金劵",
        "test_id": "4",
        "test_value": "10",
        "test_text": "仅限小马哥平台网约审车使用",
        "test_time": "2017.08.08"
    },
    "3" : {
        "ID" : "7",
        "userid" : "10000",
        "readme" : "特权卡现金劵50元",
        "star_time" : "2017-07-13 19:48:15",
        "end_time" : "2017-08-13 19:48:15",
        "coupon_type" : "vip",
        "coupon_m" : "50.00",
        "ly" : "每日签到转盘",
        "ok" : "0",
        "test_title": "汽车保险现金券",
        "test_id": "5",
        "test_value": "66",
        "test_text": "仅限小马哥平台使用",
        "test_limit": "满1200元可用，不含汽车税",
        "test_time": "2017.08.08"
    }
};
    tea.doT(data, 'template', 'benefit_list');*!/
    /!*var temp = document.getElementById('template');
    var texthtml = document.getElementById('test');
    var evalText = doT.template(temp.innerText);
    console.log(temp.innerText)
    console.log(evalText(data));
    texthtml.innerHTML = evalText(data);*!/
}*/
//test();
</script>
</html>