<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,aItemress=no">
    <title>title</title>
    <!-- 手淘移动端自适应方案 iPhone6下兼容aui 1rem=设计稿40px -->
    <!--<script type="text/javascript" src="../../script/flexible.js"></script>-->
    <!-- api样式 -->
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <!-- aui样式 -->
    <link rel="stylesheet" type="text/css" href="../../css/aui.css" />
    <link rel="stylesheet" type="text/css" href="../../css/aui-skin.css" />
    <link rel="stylesheet" type="text/css" href="../../css/aui-slide.css" />
    <!-- 小马哥通用样式 -->
    <link rel="stylesheet" type="text/css" href="../../css/tea.css" />
    <style type="text/css">

        /*如页面需要动态滚动到底部请去除height:100%*/
		html,body {
            height: 100%;
            width: 100%;
            overflow-x: hidden;
            overflow-y: auto;
		}

        section ~ section {
            margin-top: 0.5rem;
        }
        .title {
            width: 100%;
            height: 30px;
            line-height: 30px;
            position: absolute;
            padding: 0 1.5rem 0 0.75rem;
            left: 0;
            right: 0;
            bottom: 5px;
            z-index: 9999;
            text-align: left;
        }
        .page {
            padding: 0 0.75rem;
            text-align: right;
        }
        .close {
            position: fixed;
            padding: 0;
            width: 1.3rem;
            height: 1.3rem;
            top: 0.75rem;
            left: 0.75rem;
            background: #999999;
            color: #FFF;
            border-radius: 50%;
            z-index: 9999;
            text-align: center;
        }

        .tea-list-item-media {
            width: 3.5rem;
            position: relative;
            padding: 0.5rem 0;
            display: inherit;
            justify-content: space-around;
            flex-direction: column;
            align-items: center;
            font-size: 0.55rem;
        }

        .aui-list-item.show {
            border-bottom: 1px solid #ededed;
        }

        .aui-border-t {
            border-top: 1px solid #ededed !important;
        }
    </style>
</head>
<body>
    <div id ="content">
    <header id="pic">
        <div class="aui-slide-wrap" >
            <div class="aui-slide-node aui-slide-node-center ">
                <img src="../../image/holder_car.png" />
            </div>
            <div class="aui-slide-node aui-slide-node-center ">
                <img src="../../image/holder_car.png" />
            </div>
            <div class="aui-slide-node aui-slide-node-center ">
                <img src="../../image/holder_car.png" />
            </div>
        </div>
        <div class="close" tapmode onclick="closeWin()">
            <span class="aui-iconfont aui-icon-left aui-text-white aui-font-size-14"></span>
        </div>
        <div class="aui-slide-page-wrap aui-hide"><!--分页容器--></div>
        <div class="title aui-text-white aui-font-size-16">北海阳光城市中心审车代办点</div>
        <div id="page" class="title page aui-text-white aui-font-size-12"></div>
    </header>
    <section>
        <ul class="aui-list aui-media-list aui-list-noborder aui-list-in">
            <li class="aui-list-item">
                <div class="aui-media-list-item-inner">
                    <div class="aui-list-item-inner">
                        <div class="aui-list-item-title aui-font-size-14">
                            <span class="aui-iconfont tea-text-blue aui-icon-location aui-margin-r-5 aui-margin-b-5"></span>
                            广西北海皇后大道西街37栋B座（麦当劳对面）
                        </div>
                        <div class="aui-list-item-title aui-font-size-14">
                            <span class="aui-iconfont tea-text-blue aui-icon-phone aui-margin-r-5"></span>
                            <span>林先生</span>
                            <span>18719139485</span>
                        </div>
                    </div>
                    <div class="tea-list-item-media aui-border-l">
                        <i class="aui-iconfont aui-icon-paper tea-text-blue aui-font-size-18"></i>
                        <span class="tea-text-blue aui-font-size-14">导航</span>
                    </div>
                </div>
            </li>

         </ul>
         <ul class="aui-list aui-list-noborder aui-list-in aui-border-t">
            <li class="aui-list-item">
                <div class="aui-list-item-inner aui-list-item-arrow">
                    <div class="aui-list-item-title tea-text-orange ">4.8分 非常棒</div>
                    <div class="aui-list-item-right">95%好评 11111条评论</div>
                </div>
            </li>
         </ul>
    </section>

    <section>
        <ul class="aui-list aui-media-list tea-list-in aui-list-noborder ">
            <li class="aui-list-item aui-list-item-arrow tea" tapmode onclick="agencyToggle(this)">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-title">您的选项</div>
                </div>
            </li>
            <li class="aui-list-item">
                <div class="aui-media-list-item-inner">
                    <div class="aui-list-item-media" style="width: 4rem;">
                        <div class="aui-list-title">轿车：</div>
                    </div>
                    <div class="aui-list-item-inner aui-padded-l-0">
                        <div id="businessList" class="aui-row tea-text-title ">
                            <div class="aui-col-xs-6 aui-ellipsis-1">
                                <div class="aui-ellipsis-1 tea-text-blue-point">审车</div>
                            </div>
                            <div class="aui-col-xs-6">
                                <div class="aui-ellipsis-1 tea-text-blue-point">审车</div>
                            </div>
                            <div class="aui-col-xs-6">
                                <div class="aui-ellipsis-1 tea-text-blue-point">审车</div>
                            </div>
                            <div class="aui-col-xs-6">
                                <div class="aui-ellipsis-1 tea-text-blue-point">审车</div>
                            </div>
                        </div>
                    </div>
                </div>
            </li>
        </ul>
    </section>

    <section>
        <ul class="aui-list tea-list-in aui-list-noborder ">
            <li class="aui-list-item aui-list-item-arrow tea" tapmode onclick="agencyToggle(this)">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-title">收费标准和需要手续</div>
                </div>
            </li>
        </ul>
        <ul id="projects" class="aui-list aui-select-list aui-list-in aui-hide">
            <li class="aui-list-item">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-title aui-ellipsis-1">审车 ¥120</div>
                    <div class="aui-list-item-text aui-ellipsis-1">需要手续：审车费用</div>
                </div>
                <div class="tea-list-item-media">
                    <label class="aui-pull-right"><input class="aui-radio" type="radio" name="radio" checked></label>
                </div>
            </li>
            <li class="aui-list-item">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-title aui-ellipsis-1">审车 ¥120</div>
                    <div class="aui-list-item-text aui-ellipsis-1">需要手续：审车费用</div>
                </div>
                <div class="tea-list-item-media">
                    <label class="aui-pull-right"><input class="aui-radio" type="radio" name="radio" checked></label>
                </div>
            </li>
        </ul>
    </section>

    </div>

</body>
<script type="text/javascript" src="../../script/api.js" ></script>
<!-- 轮播组件 -->
<script type="text/javascript" src="../../script/aui-slide.js" ></script>
<!-- 小马哥通用函数库 -->
<script type="text/javascript" src="../../script/tea.js"></script>
<!-- ajax相关 -->
<script type="text/javascript" src="../../script/conn.js"></script>
<!-- JavaScript模板引擎 -->
<script type="text/javascript" src="../../script/doT.min.js"></script>
<!-- HTML模板 -->
<script type="text/template" id="template">
    <header id="pic">
        <div class="aui-slide-wrap" >
            {{~it.picsArr:value:index}}
            <div class="aui-slide-node aui-slide-node-center ">
                <img src="{{= website + 'admin' + value}}" />
            </div>
            {{~}}
        </div>
        <div class="close" tapmode onclick="closeWin()">
            <span class="aui-iconfont aui-icon-left aui-text-white aui-font-size-14"></span>
        </div>
        <div class="aui-slide-page-wrap aui-hide"><!--分页容器--></div>
        <div class="title aui-text-white aui-font-size-16">{{=it.name}}</div>
        <div id="page" class="title page aui-text-white aui-font-size-12"></div>
    </header>
    <section>
        <ul class="aui-list aui-media-list aui-list-noborder aui-list-in">
            <li class="aui-list-item">
                <div class="aui-media-list-item-inner">
                    <div class="aui-list-item-inner">
                        <div class="aui-list-item-title aui-font-size-14">
                            <span class="aui-iconfont tea-text-blue aui-icon-location aui-margin-r-5 aui-margin-b-5"></span>
                            {{=it.complete_address}}
                        </div>
                        <div class="aui-list-item-title aui-font-size-14">
                            <span class="aui-iconfont tea-text-blue aui-icon-phone aui-margin-r-5"></span>
                            <span>{{=it.linker}}</span>
                            <span>{{=it.telphone}}</span>
                        </div>
                    </div>
                    <div class="tea-list-item-media aui-border-l" tapmode onclick="tea.bmapGuide('{{=it.name}}','{{=it.longitude}}','{{=it.latitude}}')">
                        <i class="aui-iconfont aui-icon-paper tea-text-blue aui-font-size-18"></i>
                        <span class="tea-text-blue aui-font-size-14">导航</span>
                    </div>
                </div>
            </li>

         </ul>
         <!-- <ul class="aui-list aui-list-noborder aui-list-in aui-border-t" tapmode onclick="tea.toast('disable')">
            <li class="aui-list-item">
                <div class="aui-list-item-inner aui-list-item-arrow">
                    <div class="aui-list-item-title tea-text-orange ">4.8分 非常棒</div>
                    <div class="aui-list-item-right">95%好评 11111条评论</div>
                </div>
            </li>
         </ul> -->
    </section>

    <section>
        <ul class="aui-list tea-list-in aui-list-noborder ">
            <li class="aui-list-item aui-list-item-arrow tea" tapmode onclick="agencyToggle(this)">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-title">收费标准和需要手续</div>
                </div>
            </li>
        </ul>
        <ul id="projects" class="aui-list aui-select-list aui-list-in">
            {{ for(var prop in it.c_business){ }}
            <li class="aui-list-item" tapmode onclick="selectBusiness(this,{{=prop}})">
                <div class="aui-list-item-inner aui-ellipsis-1">
                    <div class="aui-list-item-title aui-ellipsis-1">{{= it.c_business[prop].name}} <span class="tea-text-orange">¥{{= it.c_business[prop].money}}</span></div>
                    <div class="aui-list-item-title aui-ellipsis-2 tea-text-default aui-font-size-14">{{= it.c_business[prop].condition}}</div>
                </div>
                <div class="tea-list-item-media">
                    <label class="aui-pull-right">
                    <input class="aui-checkbox" type="checkbox" name="checkbox" {{=(isSelect(prop)? 'checked': '')}}
                           tapmode onclick="prevent(event)">
                    </label>
                </div>
            </li>
            {{ } }}
        </ul>
    </section>

    <section id="business">
        <ul class="aui-list aui-media-list tea-list-in aui-list-noborder ">
            <li class="aui-list-item tea">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-title">您的选项</div>
                </div>
            </li>
            <li class="aui-list-item">
                <div class="aui-media-list-item-inner">
                    <div class="aui-list-item-media aui-padded-r-0" style="width: 4rem;">
                        <div class="aui-list-title">{{=(agency.type === 1? '轿车：' : '货车：')}}</div>
                    </div>
                    <div class="aui-list-item-inner aui-padded-l-0">
                        <div id="businessList" class="aui-row tea-text-title">
                            {{ for(var prop in it.c_business){ }}
                            <div class="aui-col-xs-6 aui-ellipsis-1">
                                <div class="aui-ellipsis-1 tea-text-blue-point {{=(isSelect(prop)? '':'aui-hide')}}">
                                    {{= it.c_business[prop].name}}
                                </div>
                            </div>
                            {{ } }}
                        </div>
                    </div>
                </div>
            </li>
        </ul>
    </section>




</script>

<script type="text/template" id="b-template">

    {{ for(var prop in it.c_business){ }}
    <div class="aui-col-xs-6 aui-ellipsis-1">
        <div class="aui-ellipsis-1 tea-text-blue-point {{=(isSelect(prop)? '':'aui-hide')}}">
            {{= it.c_business[prop].name}}
        </div>
    </div>
    {{ } }}

</script>
<script type="text/javascript">

/**********************************apiready**********************************/
apiready = function(){

    // 初始化DOM对象
    initDOM();

    // 初始化变量
    initVar();

    // 更新HTML
    initHTML();

    // 初始化监听
    initEventListener();

    updateDOM();

    // 初始化其他模块
    initUIScrollPicture();

    // ajax请求数据
    getData();



};

/**********************************声明全局变量**********************************/
// 声明全局变量
var data = {}, values = {}, agency = {}, flag = false;
// 声明DOM对象
var pic, page, business;

/**********************************初始化全局变量**********************************/
// 初始化DOM对象
function initDOM(){


};

// 初始化变量
function initVar(){

    data = api.pageParam.data;
    data.picsArr = data.pics.split(',');
    agency = $api.getStorage('agency');
    values.type = agency.type;
    if (values.type != 1) {
        data.c_business = data.v_business;
    }
    values.idArr = agency.business;

};

function initHTML(){

    var content = $api.byId('content');
    tea.doT(data, 'template', content);

}

/**********************************ajax请求数据**********************************/
function getData(){


}


/**********************************更新全局变量**********************************/
// 更新DOM对象
function updateDOM(){

    // 轮播图
    pic = $api.byId('pic');
    page = $api.byId('page');
    business = $api.byId('business');

}

// 更新变量
function updateVar(){



}

/**********************************更新HTML**********************************/
function updateHTML(){

    var business = $api.byId('businessList');
    tea.doT(data, 'b-template', business);

}


/**********************************初始化监听**********************************/
function initEventListener(){



}

/**********************************初始化其他模块**********************************/
function init(){



}

function initUIScrollPicture() {

    var slide = new auiSlide({
        container:pic,
        // "width":300,
        "height":240,
        "speed":500,
        "autoPlay": 3000, //自动播放
        "loop":true,
        "pageShow":true,
        "pageStyle":'line',
        'dotPosition':'center',
        currentPage:currentFun
    })

    var pages = slide.pageCount();
    page.innerHTML = 1  + '/' + pages + '张';
    function currentFun(index) {
        //console.log(index);
        page.innerHTML = index + 1  + '/' + pages + '张';
    }
}

/**********************************广播消息**********************************/
function addEvent(){



}

/**********************************DOM响应**********************************/
function closeWin(){

    api.execScript({
        name: 'agencies_detail_win',
        script: 'closeWin();'
    });

}

function agencyToggle(el_){

    tea.toggle(el_,'show');
    tea.toggle('projects');


}

function selectBusiness(el_, id_){

    var checkbox = $api.dom(el_, 'input');
    var id_ = parseInt(id_);
    var index = values.idArr.indexOf(id_);
    if (index > -1) {
        if (values.idArr.length > 1){
            values.idArr.splice(index, 1);
            checkbox.click();
        }
        else {
            api.toast({
                msg: '请至少选择一个项目',
                duration: 2000,
                location: 'middle'
            });
        }
    }
    else {
        values.idArr.push(id_);
        checkbox.click();
    }

    updateHTML();
}

function prevent(event){
    event.preventDefault();
}
/**********************************其他函数**********************************/
function postAgency(){

    values.user_id = $api.getStorage('ID');
    values.car_type = agency.type;
    values.telphone = agency.telphone;
    values.agency_id = data.id;
    values.business = values.idArr.join(',');
    values.book_time = agency.book_time;

    var order = api.pageParam.order;
    //_alert(values);
    if (typeof order != "undefined") {
        values.id = order.id;
        values.able = 1;
    }
    //_alert(values);
    api.ajax({
        url: website + 'api_q.php?action=book_agency',
        method: 'post',
        data: {
            values: values
        }
    },function(ret, err){
        if (ret) {
            if(ret.succ == 1){
                api.openWin({
                    name: 'success',
                    url: '../unit/success_win.html',
                    pageParam: {
                        title: '找代办',
                        result: '提交成功',
                        data: {
                            '0': ['在您提交的代办时间内','工作人员会联系您，请保持手机畅通']
                        }
                    }
                });
            }
            else{
                api.toast({
                    msg: ret.msg,
                    duration: 2000,
                    location: 'middle'
                });
            }
        } else {
            tea.toast('ajax');
        }
    });




}


/**********************************功能模块1**********************************/
function isSelect(id_){

    var id_ = parseInt(id_);
    var index = values.idArr.indexOf(id_);

    if (index > -1){
        return true;
    }
    else {
        return false;
    }

}

</script>
</html>